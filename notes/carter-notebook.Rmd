---
title: "Data Analysis Notebook"
output: html_notebook
---

```{r}
#Authors: [Carter Zborowski]
#Author Date: 07/09/2025
#Purpose: The purpose of this notebook is to house all data set transformation, cleansing, visualization, statistical analysis, and note-taking for the 2025 CU Athletic Department Sports Science Internship Program

#LAST UPDATED: 07/10/2025

#Including helpful libraries
library(tidyverse)
library(readxl)
library(aod)
library(tidyr)
library(dplyr)
library(ggplot2)
library(lubridate)
```


# Loading Datasets


```{r}
#Womens basketball datasets
Incident_B <- read.csv("data-sets/Incident Report WBB.csv")
Dynamo_B <- read.csv("data-sets/VALD - Dynamo WBB.csv")
Forcedecks_B <- read.csv("data-sets/VALD - ForceDecks WBB.csv")
Performance_B <- read.csv("data-sets/VALD - Performance Test WBB.csv")

#womens soccer datasets
Incident_S <- read.csv("data-sets/Incident Report WSOC.csv")
Dynamo_S <- read.csv("data-sets/VALD - Dynamo WSOC.csv")
Forcedecks_S <- read.csv("data-sets/VALD - ForceDecks WSOC.csv")
Performance_S <- read.csv("data-sets/VALD - Performance Test WSOC.csv")

#womens lacrosse datasets
Incident_L <- read.csv("data-sets/Incident Report WLAX.csv")
Dynamo_L <- read.csv("data-sets/VALD - Dynamo WLAX.csv")
Forcedecks_L <- read.csv("data-sets/VALD - ForceDecks WLAX.csv")
Performance_L <- read.csv("data-sets/VALD - Performance Test WLAx (1).csv")

#womens volleyball datasets 
Incident_V <- read.csv("data-sets/Incident Report WVB.csv")
Dynamo_V <- read.csv("data-sets/VALD - Dynamo WVB.csv")
Forcedecks_L <- read.csv("data-sets/VALD - ForceDecks WVB.csv")
Performance_V <- read.csv("data-sets/VALD - Performance Test WVB.csv")
```


# Data Cleaning


## Incident Report


### 1. Basketball

```{r}
#BASKETBALL Incident dataset
incident_B <- Incident_B %>%                    #189 -> 128 obs.
filter(Incident.Type=="Injury") %>%
filter(Status %in% c("Out", "As Tolerated")) %>%
filter(Result.of.Sport.Participation=="Yes")  %>%
dplyr::select(-Result.of.Sport.Participation)

incident_B <- subset(incident_B,select=c("anon_id","Date","Sport", "Position", "Date.of.Injury...Onset.of.symptoms", "Side", "Body.Part.", "Tissue.Type","OSICS14.Code","OSICS10.Diagnosis","Final.Diagnosis", "Recurrence.of.Injury", "Injury.Prognosis", "General.mechanism","Specific.Mechanism","Injured.Position", "Month", "Year","Status","Season.","Start.of.Status", "End.Date", "Total.Time.Injured"))  #add,"Injured.Position",
        #53 obs. + 27 vars.

#Lower body injuries 
lower_body <- c("Thigh", "Ankle", "Lower leg", "Knee", "Foot", "Groin/hip")
incident_B$LB.Injury <- ifelse(incident_B$Body.Part. %in% c("Thigh", "Ankle", "Lower leg", "Knee", "Foot", "Groin/hip"),1,0) #lower body Injury Binary
sum(incident_B$LB.Injury)

#ACL injury (most intense LB injury)
incident_B$ACL <- ifelse(incident_B$OSICS14.Code %in% c("KL1","KLA"),1,0)
sum(incident_B$ACL)
#HSI injury (overuse injury)
incident_B$HSI <- ifelse(incident_B$OSICS14.Code %in% c("TM1","TMB","TMS"),1,0)
sum(incident_B$HSI)

#12/5/23-1/2/25 DATE RANGE (2 years)

#converting all dates
incident_b <- incident_B %>%
mutate(Total.Time.Injured = sum(Total.Time.Injured, na.rm = TRUE),
       Date = as.Date(Date, format = '%m/%d/%Y'),
       Start.of.Status=as.Date(Start.of.Status,format='%m/%d/%Y'),
       End.Date= as.Date(End.Date, format='%m/%d/%Y'),
       Date.of.Injury...Onset.of.symptoms= as.Date(Date.of.Injury...Onset.of.symptoms, format='%m/%d/%Y'))

#create a length of status variable (Out, limited,as tolerated, full go)
incident_b$Length.of.Status <- difftime(incident_b$End.Date, incident_b$Start.of.Status,units=c("days"))

#rename one datapoint from position
incident_b <- incident_b %>%
  mutate(Position=case_when(
    str_detect(Position, "Primary: Forward")~ "Forward",
    str_detect(Position, "Forward")~ "Forward",
    str_detect(Position, "Center")~ "Center",
    str_detect(Position, "Guard")~ "Guard",
    TRUE~Position
  ))
#rename sport column to better compare when joining datasets
incident_b <- incident_b %>%
  mutate(Sport=case_when(
    str_detect(Sport, "Primary: BASKETBALL")~ "Basketball",
    str_detect(Sport, "BASKETBALL")~ "Basketball"
  ))
```

In womens basketball we have 91 total lower body injuries, 3 of those injuries are ACL injuries, and none are HSI injuries.

### 2. Soccer

```{r}
#SOCCER INCIDENT dataset
incident_S <- Incident_S %>%                    #361 -> 288 obs.
filter(Incident.Type=="Injury") %>%
filter(Status %in% c("Out", "As Tolerated")) %>%
filter(Result.of.Sport.Participation=="Yes") %>%
dplyr::select(-Result.of.Sport.Participation)

incident_S <- subset(incident_S,select=c("anon_id","Date","Sport", "Position", "Date.of.Injury...Onset.of.symptoms", "Side", "Body.Part.", "Total.Time.Injured", "Tissue.Type","OSICS14.Code","OSICS10.Diagnosis", "Final.Diagnosis", "Recurrence.of.Injury", "Injury.Prognosis", "General.mechanism","Specific.Mechanism","Injured.While.", "Month", "Year","Incident.Type","Status", "Season.","Start.of.Status", "End.Date"))
        #88 obs. + 27 vars.

#Lower body injuriy Binary
incident_S$LB.Injury <- ifelse(incident_S$Body.Part. %in% c("Thigh", "Ankle", "Lower leg", "Knee", "Foot", "Groin/hip"),1,0)
sum(incident_S$LB.Injury)

#ACL injury (most intense LB injury)
incident_S$ACL <- ifelse(incident_S$OSICS14.Code %in% c("KL1","KLA"),1,0)
sum(incident_S$ACL)
#HSI injury (overuse injury)
incident_S$HSI <- ifelse(incident_S$OSICS14.Code %in% c("TM1","TMB","TMS"),1,0)
sum(incident_S$HSI)

#5/8/23- 1/15/25 (year and a half ish)

#converting all dates
incident_s <- incident_S %>%
mutate(Total.Time.Injured = sum(Total.Time.Injured, na.rm = TRUE),
       Date = as.Date(Date, format = '%m/%d/%Y'),
       Start.of.Status=as.Date(Start.of.Status,format='%m/%d/%Y'),
       End.Date= as.Date(End.Date, format='%m/%d/%Y'),
       Date.of.Injury...Onset.of.symptoms= as.Date(Date.of.Injury...Onset.of.symptoms, format='%m/%d/%Y'),
       Sport=case_when(
    str_detect(Sport, "SOCCER")~ "Soccer"   #rename sport column to better compare when joining datasets
  ))

#create a length of status variable (Out, limited,as tolerated, full go)
incident_s$Length.of.Status <- difftime(incident_s$End.Date, incident_s$Start.of.Status,units=c("days"))
```

In women's soccer there is a total of 259 lower body injuries, with 4 of them being ACL injuries, and 7 being HSI injuries.

### 3. Lacrosse

```{r}
#LACROSSE incident dataset 
incident_L <- Incident_L %>%                    #139 -> 86 obs.
filter(Incident.Type=="Injury") %>%
filter(Status %in% c("Out", "As Tolerated")) %>%
filter(Result.of.Sport.Participation=="Yes") %>%
dplyr::select(-Result.of.Sport.Participation)

incident_L <- subset(incident_L,select=c("anon_id","Date","Sport", "Position", "Date.of.Injury...Onset.of.symptoms", "Side", "Body.Part.", "Tissue.Type","OSICS14.Code","OSICS10.Diagnosis", "Final.Diagnosis", "Recurrence.of.Injury", "Injury.Prognosis", "General.mechanism","Specific.Mechanism", "Injured.While.", "Month", "Year","Incident.Type","Status", "Season.","Start.of.Status", "End.Date", "Total.Time.Injured"))  #34obs 

#Lower body injury binary
incident_L$LB.Injury <- ifelse(incident_L$Body.Part. %in% c("Thigh", "Ankle", "Lower leg", "Knee", "Foot", "Groin/hip"),1,0)
sum(incident_L$LB.Injury)

#ACL injury (most intense LB injury)
incident_L$ACL <- ifelse(incident_L$OSICS14.Code %in% c("KL1","KLA"),1,0)
sum(incident_L$ACL)
#HSI injury (overuse injury)
incident_L$HSI <- ifelse(incident_L$OSICS14.Code %in% c("TM1","TMB","TMS"),1,0)
sum(incident_L$HSI)

#4/12/23-4/18/25 (2 years)

#converting all dates
incident_l <- incident_L %>%
mutate(Total.Time.Injured = sum(Total.Time.Injured, na.rm = TRUE),
       Date = as.Date(Date, format = '%m/%d/%Y'),
       Start.of.Status=as.Date(Start.of.Status,format='%m/%d/%Y'),
       End.Date= as.Date(End.Date, format='%m/%d/%Y'),
       Date.of.Injury...Onset.of.symptoms= as.Date(Date.of.Injury...Onset.of.symptoms, format='%m/%d/%Y'),
       Sport=case_when(
    str_detect(Sport, "LACROSSE")~ "Lacrosse"
  )
)

#create a length of status variable (Out, limited,as tolerated, full go)
incident_l$Length.of.Status <- difftime(incident_l$End.Date, incident_l$Start.of.Status,units=c("days"))
```

#### 4. Volleyball

```{r}
#VOLLEYBALL incident dataset
incident_V <- Incident_V %>%                    #220 -> 135 obs.
filter(Incident.Type=="Injury") %>%
filter(Status %in% c("Out", "As Tolerated")) %>%
filter(Result.of.Sport.Participation=="Yes") %>%
dplyr::select(-Result.of.Sport.Participation)

incident_V <- subset(incident_V,select=c("anon_id","Date","Sport", "Position", "Date.of.Injury...Onset.of.symptoms", "Side", "Body.Part.", "Tissue.Type","OSICS14.Code","OSICS10.Diagnosis", "Final.Diagnosis", "Recurrence.of.Injury", "Injury.Prognosis", "General.mechanism","Specific.Mechanism","Injured.While.", "Month", "Year","Status", "Season.","Start.of.Status", "End.Date", "Total.Time.Injured"))
        #52 +23 vars.

#Lower body injury binary
incident_V$LB.Injury <- ifelse(incident_V$Body.Part. %in% c("Thigh", "Ankle", "Lower leg", "Knee", "Foot", "Groin/hip"),1,0)
sum(incident_V$LB.Injury)

#ACL injury (most intense LB injury)
incident_V$ACL <- ifelse(incident_V$OSICS14.Code %in% c("KL1","KLA"),1,0)
sum(incident_V$ACL)
#HSI injury (overuse injury)
incident_V$HSI <- ifelse(incident_V$OSICS14.Code %in% c("TM1","TMB","TMS"),1,0)
sum(incident_V$HSI)

#1/16/24-9/8/24 (9 MONTHS)

#converting all dates
incident_v <- incident_V %>%
mutate(Total.Time.Injured = sum(Total.Time.Injured, na.rm = TRUE),
       Date = as.Date(Date, format = '%m/%d/%Y'),
       Start.of.Status=as.Date(Start.of.Status,format='%m/%d/%Y'),
       End.Date= as.Date(End.Date, format='%m/%d/%Y'),
       Date.of.Injury...Onset.of.symptoms= as.Date(Date.of.Injury...Onset.of.symptoms, format='%m/%d/%Y'),
       Sport=case_when(
    str_detect(Sport, "VOLLEYBALL")~ "Volleyball"
  )
)

#create a length of status variable (Out, limited,as tolerated, full go)
incident_v$Length.of.Status <- difftime(incident_v$End.Date, incident_v$Start.of.Status,units=c("days"))
```

In womens lacrosse 72 lower body injuries occurred, 8 being ACL related, 8 being HSI injury related.


## Dynamo Dataset


We need to know the calculations for the asymmetry measures because they seem inconsistent.

### 1. Basketball

```{r}
#selects variables of interest
dynamo_B <- subset(Dynamo_B, select = c('anon_id', 'Date', 'Knee.Ex.Right.Side.Max.Force..N.', 'Knee.Ex.Left.Side.Max.Force..N.', 'Knee.Ex.Max.Force..N..Asymmetry', 'Knee.Ex.Right.Side.Avg.Force..N.', 'Knee.Ex.Left.Side.Avg.Force..N.', 'Knee.Ex.Avg.Force.Asymmetry', 'Knee.Ex.Right.Side.Max.Impulse..Ns.', 'Knee.Ex.Left.Side.Max.Impulse..Ns.', 'Knee.Ex.Max.Impulse.Asymmetry', 'Knee.Ex.Right.Side.Avg.Impulse..Ns.', 'Knee.Ex.Left.Side.Avg.Impulse..Ns.', 'Knee.Ex.Avg.Impulse.Asymmetry', 'Knee.Ex.Right.Side.Max.Rate.of.Force.Development..Ns.', 'Knee.Ex.Left.Side.Max.Rate.of.Force.Development..Ns.', 'Knee.Ex.Max.Rate.of.Force.Development.Asymmetry', 'Knee.Ex.Right.Side.Avg.Rate.of.Force.Development..Ns.', 'Knee.Ex.Left.Side.Avg.Rate.of.Force.Development..Ns.', 'Knee.Ex.Avg.Rate.of.Force.Development.Asymmetry'))

#converts the date to a date object and omits the NAs as well as calculating the Knee.Ex.Max.Force..N..Asymmetry variable for the missing values
dynamo_B <- dynamo_B %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y'),
         Knee.Ex.Max.Force..N..Asymmetry = case_when(
           Knee.Ex.Left.Side.Max.Force..N. > Knee.Ex.Right.Side.Max.Force..N. ~ round(100 * (1 - (Knee.Ex.Right.Side.Max.Force..N. / Knee.Ex.Left.Side.Max.Force..N.)), 1),
           TRUE ~ Knee.Ex.Max.Force..N..Asymmetry
         )) %>%
  na.omit()
```

19 total observations, 3 with NA values in Knee.Ex.Max.Force..N..Asymmetry.

### 2. Soccer

```{r, warning = FALSE}
#selects variables of interest
dynamo_S <- subset(Dynamo_S, select = c('anon_id', 'Date', 'Knee.Ex.Right.Side.Max.Force..N.', 'Knee.Ex.Left.Side.Max.Force..N.', 'Knee.Ex.Max.Force..N..Asymmetry', 'Knee.Ex.Right.Side.Avg.Force..N.', 'Knee.Ex.Left.Side.Avg.Force..N.', 'Knee.Ex.Avg.Force.Asymmetry', 'Knee.Ex.Right.Side.Max.Impulse..Ns.', 'Knee.Ex.Left.Side.Max.Impulse..Ns.', 'Knee.Ex.Max.Impulse.Asymmetry', 'Knee.Ex.Right.Side.Avg.Impulse..Ns.', 'Knee.Ex.Left.Side.Avg.Impulse..Ns.', 'Knee.Ex.Avg.Impulse.Asymmetry', 'Knee.Ex.Right.Side.Max.Rate.of.Force.Development..Ns.', 'Knee.Ex.Left.Side.Max.Rate.of.Force.Development..Ns.', 'Knee.Ex.Max.Rate.of.Force.Development.Asymmetry', 'Knee.Ex.Right.Side.Avg.Rate.of.Force.Development..Ns.', 'Knee.Ex.Left.Side.Avg.Rate.of.Force.Development..Ns.', 'Knee.Ex.Avg.Rate.of.Force.Development.Asymmetry'))

#converts the date to a date object and puts values from different observations together into one observation, then calculates the asymmetry statistics
dynamo_S <- dynamo_S %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y')) %>%
  group_by(anon_id, Date) %>%
  summarise(Knee.Ex.Right.Side.Max.Force..N. = sum(Knee.Ex.Right.Side.Max.Force..N., na.rm = TRUE), 
            Knee.Ex.Left.Side.Max.Force..N. = sum(Knee.Ex.Left.Side.Max.Force..N., na.rm = TRUE), 
            Knee.Ex.Max.Force..N..Asymmetry = sum(Knee.Ex.Max.Force..N..Asymmetry), 
            Knee.Ex.Right.Side.Avg.Force..N. = sum(Knee.Ex.Right.Side.Avg.Force..N., na.rm = TRUE), 
            Knee.Ex.Left.Side.Avg.Force..N. = sum(Knee.Ex.Left.Side.Avg.Force..N., na.rm = TRUE), 
            Knee.Ex.Avg.Force.Asymmetry = sum(Knee.Ex.Avg.Force.Asymmetry), 
            Knee.Ex.Right.Side.Max.Impulse..Ns. = sum(Knee.Ex.Right.Side.Max.Impulse..Ns., na.rm = TRUE), 
            Knee.Ex.Left.Side.Max.Impulse..Ns. = sum(Knee.Ex.Left.Side.Max.Impulse..Ns., na.rm = TRUE), 
            Knee.Ex.Max.Impulse.Asymmetry = sum(Knee.Ex.Max.Impulse.Asymmetry), 
            Knee.Ex.Right.Side.Avg.Impulse..Ns. = sum(Knee.Ex.Right.Side.Avg.Impulse..Ns., na.rm = TRUE), 
            Knee.Ex.Left.Side.Avg.Impulse..Ns. = sum(Knee.Ex.Left.Side.Avg.Impulse..Ns., na.rm = TRUE), 
            Knee.Ex.Avg.Impulse.Asymmetry = sum(Knee.Ex.Avg.Impulse.Asymmetry),
            Knee.Ex.Right.Side.Max.Rate.of.Force.Development..Ns. = sum(Knee.Ex.Right.Side.Max.Rate.of.Force.Development..Ns., na.rm = TRUE),
            Knee.Ex.Left.Side.Max.Rate.of.Force.Development..Ns. = sum(Knee.Ex.Left.Side.Max.Rate.of.Force.Development..Ns., na.rm = TRUE),
            Knee.Ex.Max.Rate.of.Force.Development.Asymmetry = sum(Knee.Ex.Max.Rate.of.Force.Development.Asymmetry),
            Knee.Ex.Right.Side.Avg.Rate.of.Force.Development..Ns. = sum(Knee.Ex.Right.Side.Avg.Rate.of.Force.Development..Ns., na.rm = TRUE),
            Knee.Ex.Left.Side.Avg.Rate.of.Force.Development..Ns. = sum(Knee.Ex.Left.Side.Avg.Rate.of.Force.Development..Ns., na.rm = TRUE),
            Knee.Ex.Avg.Rate.of.Force.Development.Asymmetry = sum(Knee.Ex.Avg.Rate.of.Force.Development.Asymmetry), .groups = "drop") %>%
  mutate(Knee.Ex.Max.Force..N..Asymmetry = round(100 * (1 - (Knee.Ex.Left.Side.Max.Force..N. / Knee.Ex.Right.Side.Max.Force..N.)), 1),
         Knee.Ex.Avg.Force.Asymmetry = round(100 * (1 - (Knee.Ex.Left.Side.Avg.Force..N. / Knee.Ex.Right.Side.Avg.Force..N.)), 1),
         Knee.Ex.Max.Impulse.Asymmetry = round(100 * (1 - (Knee.Ex.Left.Side.Max.Impulse..Ns. / Knee.Ex.Right.Side.Max.Impulse..Ns.)), 1),
         Knee.Ex.Avg.Impulse.Asymmetry = round(100 * (1 - (Knee.Ex.Left.Side.Avg.Impulse..Ns. / Knee.Ex.Right.Side.Avg.Impulse..Ns.)), 1),
         Knee.Ex.Max.Rate.of.Force.Development.Asymmetry = round(100 * (1 - (Knee.Ex.Left.Side.Max.Rate.of.Force.Development..Ns. / Knee.Ex.Right.Side.Max.Rate.of.Force.Development..Ns.)), 1),
         Knee.Ex.Avg.Rate.of.Force.Development.Asymmetry = round(100 * (1 - (Knee.Ex.Left.Side.Avg.Rate.of.Force.Development..Ns. / Knee.Ex.Right.Side.Avg.Rate.of.Force.Development..Ns.)), 1))
```

Only 1 observation, none of the asymmetry statistics are summarized. 

### 3. Lacrosse

```{r}
#selects variables of interest
dynamo_L <- subset(Dynamo_L, select = c('anon_id', 'Date', 'Knee.Ex.Right.Side.Max.Force..N.', 'Knee.Ex.Left.Side.Max.Force..N.', 'Knee.Ex.Max.Force..N..Asymmetry', 'Knee.Ex.Right.Side.Avg.Force..N.', 'Knee.Ex.Left.Side.Avg.Force..N.', 'Knee.Ex.Avg.Force.Asymmetry', 'Knee.Ex.Right.Side.Max.Impulse..Ns.', 'Knee.Ex.Left.Side.Max.Impulse..Ns.', 'Knee.Ex.Max.Impulse.Asymmetry', 'Knee.Ex.Right.Side.Avg.Impulse..Ns.', 'Knee.Ex.Left.Side.Avg.Impulse..Ns.', 'Knee.Ex.Avg.Impulse.Asymmetry', 'Knee.Ex.Right.Side.Max.Rate.of.Force.Development..Ns.', 'Knee.Ex.Left.Side.Max.Rate.of.Force.Development..Ns.', 'Knee.Ex.Max.Rate.of.Force.Development.Asymmetry', 'Knee.Ex.Right.Side.Avg.Rate.of.Force.Development..Ns.', 'Knee.Ex.Left.Side.Avg.Rate.of.Force.Development..Ns.', 'Knee.Ex.Avg.Rate.of.Force.Development.Asymmetry'))

#converts the date to a date object and omits the NAs as well as calculating the Knee.Ex.Max.Force..N..Asymmetry variable for the missing values
dynamo_L <- dynamo_L %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y'),
         Knee.Ex.Max.Force..N..Asymmetry = case_when(
           Knee.Ex.Left.Side.Max.Force..N. > Knee.Ex.Right.Side.Max.Force..N. ~ round(100 * (1 - (Knee.Ex.Right.Side.Max.Force..N. / Knee.Ex.Left.Side.Max.Force..N.)), 1),
           TRUE ~ Knee.Ex.Max.Force..N..Asymmetry
         )) %>%
  na.omit()
```

38 total observations, 23 with NA values in Knee.Ex.Max.Force..N..Asymmetry.

### 4. Volleyball

```{r}
#selects variables of interest
dynamo_V <- subset(Dynamo_V, select = c('anon_id', 'Date', 'Knee.Ex.Right.Side.Max.Force..N.', 'Knee.Ex.Left.Side.Max.Force..N.', 'Knee.Ex.Max.Force..N..Asymmetry', 'Knee.Ex.Right.Side.Avg.Force..N.', 'Knee.Ex.Left.Side.Avg.Force..N.', 'Knee.Ex.Avg.Force.Asymmetry', 'Knee.Ex.Right.Side.Max.Impulse..Ns.', 'Knee.Ex.Left.Side.Max.Impulse..Ns.', 'Knee.Ex.Max.Impulse.Asymmetry', 'Knee.Ex.Right.Side.Avg.Impulse..Ns.', 'Knee.Ex.Left.Side.Avg.Impulse..Ns.', 'Knee.Ex.Avg.Impulse.Asymmetry', 'Knee.Ex.Right.Side.Max.Rate.of.Force.Development..Ns.', 'Knee.Ex.Left.Side.Max.Rate.of.Force.Development..Ns.', 'Knee.Ex.Max.Rate.of.Force.Development.Asymmetry', 'Knee.Ex.Right.Side.Avg.Rate.of.Force.Development..Ns.', 'Knee.Ex.Left.Side.Avg.Rate.of.Force.Development..Ns.', 'Knee.Ex.Avg.Rate.of.Force.Development.Asymmetry'))

#converts the date to a date object and omits the NAs as well as calculating the Knee.Ex.Max.Force..N..Asymmetry variable for the missing values
dynamo_V <- dynamo_V %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y'),
         Knee.Ex.Max.Force..N..Asymmetry = case_when(
           Knee.Ex.Left.Side.Max.Force..N. > Knee.Ex.Right.Side.Max.Force..N. ~ round(100 * (1 - (Knee.Ex.Right.Side.Max.Force..N. / Knee.Ex.Left.Side.Max.Force..N.)), 1),
           TRUE ~ Knee.Ex.Max.Force..N..Asymmetry
         )) %>%
  na.omit()
```

Only has 4 observations from one player.

### Exploratory Plots

```{r}
#adding a column to each dataset describing the sport for exploratory purposes
dynamo_B$Sport <- 'Basketball'
dynamo_S$Sport <- 'Soccer'
dynamo_L$Sport <- 'Lacrosse'
dynamo_V$Sport <- 'Volleyball'

#creating a dataset containing dynamo data accross all sports
dynamo_all <- rbind(dynamo_B, dynamo_S, dynamo_L, dynamo_V) %>%
  mutate(Avg.Max.Force = (Knee.Ex.Right.Side.Max.Force..N. + Knee.Ex.Left.Side.Max.Force..N.) / 2)
```

```{r}
#creates a boxplot of average force asymmetry across the 4 sports
ggplot(dynamo_all, aes(x = Knee.Ex.Avg.Force.Asymmetry, y = Sport)) +
  geom_boxplot(fill = '#CFB87C', color = 'black') + 
  labs(title = 'Distribution of Avgerage Force Asymmetry Across Sports',
       y = 'Sport',
       x = 'Average Force Asymmetry') +
  theme_bw()
```

```{r}
#creates a histogram of dynamo max force across the 4 sports
ggplot(dynamo_all, aes(x = Avg.Max.Force, fill = Sport)) +
  geom_histogram(color = 'black', position = 'identity', bins = 20) +
  scale_fill_manual(values = c('#565A5C', '#CFB87C', '#000000', '#A2A4A3')) +
  labs(title = 'Distribution of Average Dynamo Max Force Across Sports',
       y = 'Sport',
       x = 'Average Max Force (N)') +
  theme_bw()
```

This data will probably not be very useful especially since only two unique players are represented in WBB, and only one in both WVB and WSOC WLAX has 9 unique players but very few comparisons can be made across sports. 


## Forcedecks


### 1. Basketball

```{r}
#TEST TYPE=CMJ
CMJ_B <- subset(Forcedecks_B, select = c("anon_id","Date","Position","Test.Type","Weight..kg.","Countermovement.Depth..cm.","Peak.Power...BM..W.kg.","Landing.RFD..N.s.", "Eccentric.Concentric.Mean.Force.Ratio", "Peak.Landing.Force..Asym...N.", "Peak.Power..W.","Concentric.Maximum.RFD..N.s.","Concentric.Maximum.RFD..Right...N.s.","Concentric.Maximum.RFD..Left...N.s.","Eccentric.Mean.Braking.Force..N.", "Max.Jump.Height..cm.", "Max.Concentric.Peak.Force..N.", "Relative.Concentric.Power.Bilateral","Relative.Eccentric.Power.Bilateral", "Max.Peak.Power...BM", "Max.Eccentric.Peak.Force..N.","Max.RSI.Modified.VALD","Max.Concentric.RPD..N.s.","Max.Concentric.Peak.Velocity..m.s.", "Max.Eccentric.Peak.Velocity..m.s.", "Max.Peak.Landing.Force..N.", "MAX.Concentric.Peak.Power..W.", "Max.CMJ.Jump.Height..cm.","Max.CMJ.RSI.Modified..m.s.", "Max.CMJ.Concentric.RPD..N.s.", "Max.CMJ.Peak.Power..W.", "Max.CMJ.Peak.Landing.Force..N.","CMJ.Concentric.Relative.Peak.Power...Difference.from.First","CMJ.Eccentric.Relative.Peak.Power...Difference.from.First","Eccentric.Asymmetry","Concentric.Asymmetry"
))            #2751 obs & 36 vars.

#possible other final dataset 
cmj_b <- CMJ_B %>%
  na.omit()   #440 obs

#convert empty vectors to NA
CMJ_B[CMJ_B==""] <- NA    #colSums(is.na(forcedecks_B)) look at NAs in columns

#to use in summarise
#function for mode
get_mode <- function(v) {
  uniqv <- unique(v)
  uniqv[which.max(tabulate(match(v, uniqv)))]
}

#set all needed variables to numeric
CMJ_B$Countermovement.Depth..cm. <- as.numeric(CMJ_B$Countermovement.Depth..cm.)
CMJ_B$Peak.Power...BM..W.kg. <- as.numeric(CMJ_B$Peak.Power...BM..W.kg.)

#combining values from different observations into one
CMJ_b <- CMJ_B %>%
mutate(Date = as.Date(Date, format = '%m/%d/%Y')) %>%
  group_by(anon_id, Date,Test.Type) %>%
  summarise(Weight..kg. = mean(Weight..kg., na.rm = TRUE),
            Countermovement.Depth..cm.= mean(Countermovement.Depth..cm., na.rm=TRUE),
            Peak.Power...BM..W.kg.= mean(Peak.Power...BM..W.kg., na.rm=TRUE),
            Landing.RFD..N.s.= mean(Landing.RFD..N.s.,na.rm=TRUE),
            Eccentric.Concentric.Mean.Force.Ratio= mean(Eccentric.Concentric.Mean.Force.Ratio,na.rm=TRUE),
            Peak.Landing.Force..Asym...N.= mean(Peak.Landing.Force..Asym...N.,na.rm=TRUE),
            Peak.Power..W.= mean(Peak.Power..W.,na.rm=TRUE),
            Concentric.Maximum.RFD..N.s.= mean(Concentric.Maximum.RFD..N.s.,na.rm=TRUE),
            Concentric.Maximum.RFD..Right...N.s.= mean(Concentric.Maximum.RFD..Right...N.s.,na.rm=TRUE),
            Concentric.Maximum.RFD..Left...N.s.= mean(Concentric.Maximum.RFD..Left...N.s.,na.rm=TRUE),
            Eccentric.Mean.Braking.Force..N.= mean(Eccentric.Mean.Braking.Force..N.,na.rm=TRUE),
            Max.Jump.Height..cm.= mean(Max.Jump.Height..cm.,na.rm=TRUE),
            Max.Concentric.Peak.Force..N.= mean(Max.Concentric.Peak.Force..N.,na.rm=TRUE),
            Relative.Concentric.Power.Bilateral= mean(Relative.Concentric.Power.Bilateral,na.rm=TRUE),
            Relative.Eccentric.Power.Bilateral= mean(Relative.Eccentric.Power.Bilateral,na.rm=TRUE),
            Max.Peak.Power...BM= mean(Max.Peak.Power...BM,na.rm=TRUE),
            Max.Eccentric.Peak.Force..N.= mean(Max.Eccentric.Peak.Force..N.,na.rm=TRUE),
            Max.RSI.Modified.VALD= mean(Max.RSI.Modified.VALD,na.rm=TRUE),
            Max.Concentric.RPD..N.s.= mean(Max.Concentric.RPD..N.s.,na.rm=TRUE),
            Max.Concentric.Peak.Velocity..m.s.= mean(Max.Concentric.Peak.Velocity..m.s.,na.rm=TRUE),
            Max.Eccentric.Peak.Velocity..m.s.= mean(Max.Eccentric.Peak.Velocity..m.s.,na.rm=TRUE),
            Max.Peak.Landing.Force..N.= mean(Max.Peak.Landing.Force..N.,na.rm=TRUE),
            MAX.Concentric.Peak.Power..W.= mean(MAX.Concentric.Peak.Power..W.,na.rm=TRUE),
            Max.CMJ.Jump.Height..cm.= mean(Max.CMJ.Jump.Height..cm.,na.rm=TRUE),
            Max.CMJ.RSI.Modified..m.s.= mean(Max.CMJ.RSI.Modified..m.s.,na.rm=TRUE),
            Max.CMJ.Concentric.RPD..N.s.= mean(Max.CMJ.Concentric.RPD..N.s.,na.rm=TRUE),
            Max.CMJ.Peak.Power..W.= mean(Max.CMJ.Peak.Power..W.,na.rm=TRUE),
            Max.CMJ.Peak.Landing.Force..N.= mean(Max.CMJ.Peak.Landing.Force..N.,na.rm=TRUE),
            CMJ.Concentric.Relative.Peak.Power...Difference.from.First= mean(CMJ.Concentric.Relative.Peak.Power...Difference.from.First,na.rm=TRUE),
            CMJ.Eccentric.Relative.Peak.Power...Difference.from.First= mean(CMJ.Eccentric.Relative.Peak.Power...Difference.from.First,na.rm=TRUE),
            Position= get_mode(Position),
            Eccentric.Asymmetry= get_mode(Eccentric.Asymmetry),
            Concentric.Asymmetry= get_mode(Concentric.Asymmetry),
            .groups = 'drop'
              )                   #1393 obs & 36 vars
#fix NaN values

CMJ_bb <- CMJ_b %>%
  na.omit()   #196 obs & 36 vars
```

```{r}
#selects counter movement jumps another way with normative information
b <- Forcedecks_B %>%
  filter(Test.Type == 'CMJ') %>%
  dplyr::select("anon_id","Date","Position","Test.Type","Countermovement.Depth..cm.","Peak.Power...BM..W.kg.","Landing.RFD..N.s.", "Eccentric.Concentric.Mean.Force.Ratio", "Peak.Landing.Force..Asym...N.", "Peak.Power..W.", "Concentric.RFD..N.s.", "Concentric.RFD..Left...N.s.","Concentric.RFD..Right...N.s.", "Concentric.Time.to.Peak.Force..s.", "Eccentric.Mean.Braking.Force..N.", "Landing.Net.Peak.Force...BM..N.kg.", "Peak.Net.Takeoff.Force...BM..N.kg.", "Concentric.RPD...BM..W.s.kg.", "Force.at.Peak.Power..N.", "Eccentric.Mean.Deceleration.Force..N.", "Eccentric.Peak.Force..N.", "RSI.Modified..m.s.", "CMJ.Stiffness..Left...N.m.", "CMJ.Stiffness..Right...N.m.", "Eccentric.Asymmetry","Concentric.Asymmetry", "Peak.Landing.Asymmetry", "DSI", "DSI.Bucket", "Eccentric.Peak.Power...BM..W.kg.", "Jump.Height..Imp.Mom...cm.", "Eccentric.Duration..s.", "Eccentric.Deceleration.Impulse..Ns.") %>%
  na.omit()

#calculates differences from norm and makes Date a date object
b <- b %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y'),
         RSI.Modified..m.s. = RSI.Modified..m.s. / 100,
         RSI.Modified.Diff.Norm = (RSI.Modified..m.s. - 0.417) / 0.417,
         Ecc.Peak.Power.Rel.Diff.Norm = (Eccentric.Peak.Power...BM..W.kg. - 18) / 18,
         Jump.Heigh.Diff.Norm = (Jump.Height..Imp.Mom...cm. - 30) / 30,
         Ecc.Duration.Diff.Norm = (Eccentric.Duration..s. - 0.51) / 0.51,
         Ecc.Deceleration.Impulse.Diff.Norm = (Eccentric.Deceleration.Impulse..Ns. - 98.4) / 98.4,
         Sport = 'Basketball'
  )
```


```{r}
#2 TEST TYPE=HJ
HJ_B <- Forcedecks_B %>%
  filter(Test.Type=="HJ")  %>% #424 obs
  dplyr::select("anon_id", "Date", "Corrected.Standing.Weight..Kg.", "Mean.RSI..Flight.Contact.Time.", "Active.Stiffness..N.m.", "Best.Average.Force..N.", "Best.Average.Force..Asym...N.", "Best.Time.to.Peak.Force..ms.", "Best.Contact.Time..ms.", "Best.Flight.Time..ms.", "Best.Impulse..N.s.", "Best.Peak.Force..N.", "Best.Peak.Force..Asym...N.", "Mean.Average.Force..N.", "Mean.Average.Force..Asym...N.", "Mean.Landing.RFD..N.s.", "Mean.Landing.RFD..Asym...N.s.", "Stiffness.Fatigue....", "Stiffness.Fatigue..Asym.....", "Max.Jump.Height..cm.", "HJ.RSI", "Mean.Flight.Time..ms.", "Mean.Contact.Time..ms.") %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y')) %>%
  na.omit() %>%
  mutate(Sport = 'Basketball')
                 #409 obs & 20 vars
```

```{r}
#3: TEST TYPE= IMTP
IMTP_B <- Forcedecks_B %>%
  filter(Test.Type=="IMTP") %>% #162 
  dplyr::select("anon_id", "Date", "Baseline.Force..N.","Baseline.Force..Asym...N.", "Peak.Vertical.Force..N.", "Peak.Vertical.Force...BM..N.kg.", "Peak.Vertical.Force..Asym...N.", "RFD...50ms..N.s.", "RFD...50ms..Asym...N.s.", "RFD...100ms..N.s.", "RFD...100ms..Asym...N.s.", "RFD...150ms..N.s.", "RFD...150ms..Asym...N.s.", "RFD...200ms..N.s.", "RFD...200ms..Asym...N.s.", "Net.Peak.Vertical.Force..N.s.", "Net.Peak.Vertical.Force..Asym...N.s.", "Force.at.200ms...BM..N.kg.", "Absolute.Impulse.50ms..Ns.", "Absolute.Impulse.50ms..Asym...Ns.", "Absolute.Impulse.100ms..Ns.", "Absolute.Impulse.100ms..Asym...Ns.", "Absolute.Impulse.150ms..Ns.", "Absolute.Impulse.150ms..Asym...Ns.", "Absolute.Impulse.200ms..Ns.", "Absolute.Impulse.200ms..Asym...Ns."
) %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y')) %>%
  na.omit() %>%
  mutate(Sport = 'Basketball')   #50 obs & 30 vars
```

### 2. Soccer

```{r}
#1: TEST TYPE==CMJ
#selects variables of interest
CMJ_S <- subset(Forcedecks_S, select = c("anon_id","Date","Position","Test.Type","Weight..kg.","Countermovement.Depth..cm.","Peak.Power...BM..W.kg.","Landing.RFD..N.s.", "Eccentric.Concentric.Mean.Force.Ratio", "Peak.Landing.Force..Asym...N.", "Peak.Power..W.","Concentric.Maximum.RFD..N.s.","Concentric.Maximum.RFD..Right...N.s.","Concentric.Maximum.RFD..Left...N.s.","Eccentric.Mean.Braking.Force..N.", "Max.Jump.Height..cm.", "Max.Concentric.Peak.Force..N.", "Relative.Concentric.Power.Bilateral",
"Relative.Eccentric.Power.Bilateral","Max.Peak.Power...BM", "Max.Eccentric.Peak.Force..N.",
"Max.RSI.Modified.VALD","Max.Concentric.RPD..N.s.", "Max.Concentric.Peak.Velocity..m.s.", "Max.Eccentric.Peak.Velocity..m.s.", "Max.Peak.Landing.Force..N.", "MAX.Concentric.Peak.Power..W.","Max.CMJ.Jump.Height..cm.",
"Max.CMJ.RSI.Modified..m.s.","Max.CMJ.Concentric.RPD..N.s.","Max.CMJ.Peak.Power..W.","Max.CMJ.Peak.Landing.Force..N.","CMJ.Concentric.Relative.Peak.Power...Difference.from.First","CMJ.Eccentric.Relative.Peak.Power...Difference.from.First","Eccentric.Asymmetry","Concentric.Asymmetry"
))        #3443 obs & 36 vars 

#OTHER POSSIBLE FINAL DATASET
cmj_s <- CMJ_S %>%
na.omit()  #562 obs & 36 vars
cmj_s[cmj_s==""] <- NA

CMJ_S[CMJ_S==""] <- NA

#combining values from different observations into one
CMJ_s <- CMJ_S %>%
mutate(Date = as.Date(Date, format = '%m/%d/%Y')) %>%
  group_by(anon_id, Date, Test.Type) %>%
  summarise(Weight..kg. = mean(Weight..kg., na.rm = TRUE),
            Countermovement.Depth..cm.= mean(Countermovement.Depth..cm., na.rm=TRUE),
            Peak.Power...BM..W.kg.= mean(Peak.Power...BM..W.kg., na.rm=TRUE),
            Landing.RFD..N.s.= mean(Landing.RFD..N.s.,na.rm=TRUE),
            Eccentric.Concentric.Mean.Force.Ratio= mean(Eccentric.Concentric.Mean.Force.Ratio,na.rm=TRUE),
            Peak.Landing.Force..Asym...N.= mean(Peak.Landing.Force..Asym...N.,na.rm=TRUE),
            Peak.Power..W.= mean(Peak.Power..W.,na.rm=TRUE),
            Concentric.Maximum.RFD..N.s.= mean(Concentric.Maximum.RFD..N.s.,na.rm=TRUE),
            Concentric.Maximum.RFD..Right...N.s.= mean(Concentric.Maximum.RFD..Right...N.s.,na.rm=TRUE),
            Concentric.Maximum.RFD..Left...N.s.= mean(Concentric.Maximum.RFD..Left...N.s.,na.rm=TRUE),
            Eccentric.Mean.Braking.Force..N.= mean(Eccentric.Mean.Braking.Force..N.,na.rm=TRUE),
            Max.Jump.Height..cm.= mean(Max.Jump.Height..cm.,na.rm=TRUE),
            Max.Concentric.Peak.Force..N.= mean(Max.Concentric.Peak.Force..N.,na.rm=TRUE),
            Relative.Concentric.Power.Bilateral= mean(Relative.Concentric.Power.Bilateral,na.rm=TRUE),
            Relative.Eccentric.Power.Bilateral= mean(Relative.Eccentric.Power.Bilateral,na.rm=TRUE),
            Max.Peak.Power...BM= mean(Max.Peak.Power...BM,na.rm=TRUE),
            Max.Eccentric.Peak.Force..N.= mean(Max.Eccentric.Peak.Force..N.,na.rm=TRUE),
            Max.RSI.Modified.VALD= mean(Max.RSI.Modified.VALD,na.rm=TRUE),
            Max.Concentric.RPD..N.s.= mean(Max.Concentric.RPD..N.s.,na.rm=TRUE),
            Max.Concentric.Peak.Velocity..m.s.= mean(Max.Concentric.Peak.Velocity..m.s.,na.rm=TRUE),
            Max.Eccentric.Peak.Velocity..m.s.= mean(Max.Eccentric.Peak.Velocity..m.s.,na.rm=TRUE),
            Max.Peak.Landing.Force..N.= mean(Max.Peak.Landing.Force..N.,na.rm=TRUE),
            MAX.Concentric.Peak.Power..W.= mean(MAX.Concentric.Peak.Power..W.,na.rm=TRUE),
            Max.CMJ.Jump.Height..cm.= mean(Max.CMJ.Jump.Height..cm.,na.rm=TRUE),
            Max.CMJ.RSI.Modified..m.s.= mean(Max.CMJ.RSI.Modified..m.s.,na.rm=TRUE),
            Max.CMJ.Concentric.RPD..N.s.= mean(Max.CMJ.Concentric.RPD..N.s.,na.rm=TRUE),
            Max.CMJ.Peak.Power..W.= mean(Max.CMJ.Peak.Power..W.,na.rm=TRUE),
            Max.CMJ.Peak.Landing.Force..N.= mean(Max.CMJ.Peak.Landing.Force..N.,na.rm=TRUE),
            CMJ.Concentric.Relative.Peak.Power...Difference.from.First= mean(CMJ.Concentric.Relative.Peak.Power...Difference.from.First,na.rm=TRUE),
            CMJ.Eccentric.Relative.Peak.Power...Difference.from.First= mean(CMJ.Eccentric.Relative.Peak.Power...Difference.from.First,na.rm=TRUE),
            Position= get_mode(Position),
            Eccentric.Asymmetry= get_mode(Eccentric.Asymmetry),
            Concentric.Asymmetry= get_mode(Concentric.Asymmetry),
            .groups = 'drop'
              )               # 1077 obs & 32 vars -> 1571

CMJ_soc <- CMJ_s %>%
  na.omit()   #621 obs & 32 vars -> 600 -> 257 obs & 36 vars 
```

```{r}
#selects counter movement jumps another way with normative information
s <- Forcedecks_S %>%
  filter(Test.Type == 'CMJ') %>%
  dplyr::select("anon_id","Date","Position","Test.Type","Countermovement.Depth..cm.","Peak.Power...BM..W.kg.","Landing.RFD..N.s.", "Eccentric.Concentric.Mean.Force.Ratio", "Peak.Landing.Force..Asym...N.", "Peak.Power..W.", "Concentric.RFD..N.s.", "Concentric.RFD..Left...N.s.","Concentric.RFD..Right...N.s.", "Concentric.Time.to.Peak.Force..s.", "Eccentric.Mean.Braking.Force..N.", "Landing.Net.Peak.Force...BM..N.kg.", "Peak.Net.Takeoff.Force...BM..N.kg.", "Concentric.RPD...BM..W.s.kg.", "Force.at.Peak.Power..N.", "Eccentric.Mean.Deceleration.Force..N.", "Eccentric.Peak.Force..N.", "RSI.Modified..m.s.", "CMJ.Stiffness..Left...N.m.", "CMJ.Stiffness..Right...N.m.", "Eccentric.Asymmetry","Concentric.Asymmetry", "Peak.Landing.Asymmetry", "DSI", "DSI.Bucket", "Eccentric.Peak.Power...BM..W.kg.", "Jump.Height..Imp.Mom...cm.", "Eccentric.Duration..s.", "Eccentric.Deceleration.Impulse..Ns.") %>%
  na.omit()

#calculates differences from norm and makes Date a date object
s <- s %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y'),
         RSI.Modified..m.s. = RSI.Modified..m.s. / 100,
         RSI.Modified.Diff.Norm = (RSI.Modified..m.s. - 0.416) / 0.416,
         Ecc.Peak.Power.Rel.Diff.Norm = (Eccentric.Peak.Power...BM..W.kg. - 18) / 18,
         Jump.Heigh.Diff.Norm = (Jump.Height..Imp.Mom...cm. - 30) / 30,
         Ecc.Duration.Diff.Norm = (Eccentric.Duration..s. - 0.49) / 0.49,
         Ecc.Deceleration.Impulse.Diff.Norm = (Eccentric.Deceleration.Impulse..Ns. - 81.5) / 81.5,
         Sport = 'Soccer'
  )
```

```{r}
#2 TEST TYPE= HJ
HJ_S <- Forcedecks_S %>%
  filter(Test.Type=="HJ")  %>%  #575 obs
  dplyr::select("anon_id", "Date", "Corrected.Standing.Weight..Kg.", "Mean.RSI..Flight.Contact.Time.", "Active.Stiffness..N.m.", "Best.Average.Force..N.", "Best.Average.Force..Asym...N.", "Best.Time.to.Peak.Force..ms.", "Best.Contact.Time..ms.", "Best.Flight.Time..ms.", "Best.Impulse..N.s.", "Best.Peak.Force..N.", "Best.Peak.Force..Asym...N.", "Mean.Average.Force..N.", "Mean.Average.Force..Asym...N.", "Mean.Landing.RFD..N.s.", "Mean.Landing.RFD..Asym...N.s.", "Stiffness.Fatigue....", "Stiffness.Fatigue..Asym.....", "Max.Jump.Height..cm.", "HJ.RSI", "Mean.Flight.Time..ms.", "Mean.Contact.Time..ms.") %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y')) %>%
  na.omit() %>%
  mutate(Sport = 'Soccer')
                 #556 obs & 20 vars
```

```{r}
#3: TEST TYPE= IMTP
IMTP_S <- Forcedecks_S %>%
  filter(Test.Type=="IMTP") %>% #162 
  dplyr::select("anon_id", "Date", "Baseline.Force..N.","Baseline.Force..Asym...N.", "Peak.Vertical.Force..N.", "Peak.Vertical.Force...BM..N.kg.", "Peak.Vertical.Force..Asym...N.", "RFD...50ms..N.s.", "RFD...50ms..Asym...N.s.", "RFD...100ms..N.s.", "RFD...100ms..Asym...N.s.", "RFD...150ms..N.s.", "RFD...150ms..Asym...N.s.", "RFD...200ms..N.s.", "RFD...200ms..Asym...N.s.", "Net.Peak.Vertical.Force..N.s.", "Net.Peak.Vertical.Force..Asym...N.s.", "Force.at.200ms...BM..N.kg.", "Absolute.Impulse.50ms..Ns.", "Absolute.Impulse.50ms..Asym...Ns.", "Absolute.Impulse.100ms..Ns.", "Absolute.Impulse.100ms..Asym...Ns.", "Absolute.Impulse.150ms..Ns.", "Absolute.Impulse.150ms..Asym...Ns.", "Absolute.Impulse.200ms..Ns.", "Absolute.Impulse.200ms..Asym...Ns."
) %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y')) %>%
  na.omit() %>%
  mutate(Sport = 'Soccer')  #196 obs & 26 vars
```

```{r}
#3 TEST TYPE- SLJ
SLJ_S <- Forcedecks_S %>%
  filter(Test.Type=="SLJ")  # 455 obs

#important variables 
SLJ_S <- subset(SLJ_S, select = c("anon_id", "Date", "Position", "Weight..kg.", "Jump.Height..Flight.Time...cm.",  "Jump.Height..Imp.Mom...cm.", "Max.Jump.Height..cm.", "Max.Single.Leg.Jump.Height.Left", "Max.Single.Leg.Jump.Height.Right", "First.SLJ.Jump.Height", "Max.Concentric.Peak.Velocity..m.s.", "Max.Eccentric.Peak.Velocity..m.s.", "RSI.Modified..m.s.", "Max.RSI.Modified..m.s.", "Max.RSI.Modified.VALD", "Eccentric.Mean.Braking.Force..N.", "Landing.RFD..N.s.","Concentric.Maximum.RFD..N.s.", "Concentric.Maximum.RFD..Right...N.s.","Concentric.Maximum.RFD..Left...N.s.", "Concentric.Impulse..Ns.", "Concentric.Impulse..Left...Ns.", "Concentric.Impulse..Right...Ns.", "Max.Concentric.Peak.Force..N.", "Max.Eccentric.Peak.Force..N."
))                        #455 obs & 25 vars

SLJ_S[SLJ_S==""] <- NA

#combining values from different observations into one
SLJ_s <- SLJ_S %>%
mutate(Date = as.Date(Date, format = '%m/%d/%Y')) %>%
  group_by(anon_id, Date) %>%
  summarise(Weight..kg. = mean(Weight..kg., na.rm = TRUE),
            Jump.Height..Flight.Time...cm.= mean(Jump.Height..Flight.Time...cm., na.rm=TRUE),
            Jump.Height..Imp.Mom...cm.= mean(Jump.Height..Imp.Mom...cm.,na.rm=TRUE),
            Max.Jump.Height..cm.= mean(Max.Jump.Height..cm. ,na.rm=TRUE),
            Max.Single.Leg.Jump.Height.Left= mean(Max.Single.Leg.Jump.Height.Left ,na.rm=TRUE),
            Max.Single.Leg.Jump.Height.Right= mean(Max.Single.Leg.Jump.Height.Right ,na.rm=TRUE),
            First.SLJ.Jump.Height= mean(First.SLJ.Jump.Height, na.rm=TRUE),
            Max.Concentric.Peak.Velocity..m.s.= mean(Max.Concentric.Peak.Velocity..m.s., na.rm=TRUE),
            Max.Eccentric.Peak.Velocity..m.s.= mean(Max.Eccentric.Peak.Velocity..m.s., na.rm=TRUE),
            RSI.Modified..m.s.= mean(RSI.Modified..m.s., na.rm=TRUE),
            Max.RSI.Modified..m.s.= mean(Max.RSI.Modified..m.s., na.rm=TRUE),
            Max.RSI.Modified.VALD= mean(Max.RSI.Modified.VALD, na.rm=TRUE),
            Eccentric.Mean.Braking.Force..N.= mean(Eccentric.Mean.Braking.Force..N., na.rm=TRUE),
            Landing.RFD..N.s.= mean(Landing.RFD..N.s., na.rm=TRUE),
            Concentric.Maximum.RFD..N.s.= mean(Concentric.Maximum.RFD..N.s., na.rm=TRUE),
            Concentric.Maximum.RFD..Right...N.s.= mean(Concentric.Maximum.RFD..Right...N.s.,na.rm=TRUE),
            Concentric.Maximum.RFD..Left...N.s.= mean(Concentric.Maximum.RFD..Left...N.s.,na.rm=TRUE),
            Concentric.Impulse..Ns.= mean(Concentric.Impulse..Ns.,na.rm=TRUE),
            Concentric.Impulse..Left...Ns.= mean(Concentric.Impulse..Left...Ns.,na.rm=TRUE),
            Concentric.Impulse..Right...Ns.= mean(Concentric.Impulse..Right...Ns.,na.rm=TRUE),
            Max.Concentric.Peak.Force..N.= mean(Max.Concentric.Peak.Force..N.,na.rm=TRUE),
            Max.Eccentric.Peak.Force..N.= mean(Max.Eccentric.Peak.Force..N.,na.rm=TRUE),
            Position= get_mode(Position),
            .groups = 'drop'
              )   #83 obs 25 vars
```

### 3. Lacrosse

```{r}
#1 : TEST TYPE= CMJ
#selects variables of interest
CMJ_L <- subset(Forcedecks_L, select = c("anon_id","Date","Position","Test.Type","Weight..kg.","Countermovement.Depth..cm.","Peak.Power...BM..W.kg.","Landing.RFD..N.s.", "Eccentric.Concentric.Mean.Force.Ratio", "Peak.Landing.Force..Asym...N.", "Peak.Power..W.","Concentric.Maximum.RFD..N.s.","Concentric.Maximum.RFD..Right...N.s.","Concentric.Maximum.RFD..Left...N.s.","Eccentric.Mean.Braking.Force..N.", "Max.Jump.Height..cm.", "Max.Concentric.Peak.Force..N.", "Relative.Concentric.Power.Bilateral",
"Relative.Eccentric.Power.Bilateral","Max.Peak.Power...BM", "Max.Eccentric.Peak.Force..N.",
"Max.RSI.Modified.VALD","Max.Concentric.RPD..N.s.", "Max.Concentric.Peak.Velocity..m.s.", "Max.Eccentric.Peak.Velocity..m.s.", "Max.Peak.Landing.Force..N.", "MAX.Concentric.Peak.Power..W.","Max.CMJ.Jump.Height..cm.",
"Max.CMJ.RSI.Modified..m.s.","Max.CMJ.Concentric.RPD..N.s.","Max.CMJ.Peak.Power..W.","Max.CMJ.Peak.Landing.Force..N.","CMJ.Concentric.Relative.Peak.Power...Difference.from.First","CMJ.Eccentric.Relative.Peak.Power...Difference.from.First","Eccentric.Asymmetry","Concentric.Asymmetry"
))        #1939 obs & 36 vars 

#possible other final dataset
cmj_l <- CMJ_L %>%
  na.omit()      #377 obs 

CMJ_L[CMJ_L==""] <- NA

#combining values from different observations into one
CMJ_l <- CMJ_L %>%
mutate(Date = as.Date(Date, format = '%m/%d/%Y')) %>%
  group_by(anon_id, Date, Test.Type) %>%
  summarise(Weight..kg. = mean(Weight..kg., na.rm = TRUE),
            Countermovement.Depth..cm.= mean(Countermovement.Depth..cm., na.rm=TRUE),
            Peak.Power...BM..W.kg.= mean(Peak.Power...BM..W.kg., na.rm=TRUE),
            Landing.RFD..N.s.= mean(Landing.RFD..N.s.,na.rm=TRUE),
            Eccentric.Concentric.Mean.Force.Ratio= mean(Eccentric.Concentric.Mean.Force.Ratio,na.rm=TRUE),
            Peak.Landing.Force..Asym...N.= mean(Peak.Landing.Force..Asym...N.,na.rm=TRUE),
            Peak.Power..W.= mean(Peak.Power..W.,na.rm=TRUE),
            Concentric.Maximum.RFD..N.s.= mean(Concentric.Maximum.RFD..N.s.,na.rm=TRUE),
            Concentric.Maximum.RFD..Right...N.s.= mean(Concentric.Maximum.RFD..Right...N.s.,na.rm=TRUE),
            Concentric.Maximum.RFD..Left...N.s.= mean(Concentric.Maximum.RFD..Left...N.s.,na.rm=TRUE),
            Eccentric.Mean.Braking.Force..N.= mean(Eccentric.Mean.Braking.Force..N.,na.rm=TRUE),
            Max.Jump.Height..cm.= mean(Max.Jump.Height..cm.,na.rm=TRUE),
            Max.Concentric.Peak.Force..N.= mean(Max.Concentric.Peak.Force..N.,na.rm=TRUE),
            Relative.Concentric.Power.Bilateral= mean(Relative.Concentric.Power.Bilateral,na.rm=TRUE),
            Relative.Eccentric.Power.Bilateral= mean(Relative.Eccentric.Power.Bilateral,na.rm=TRUE),
            Max.Peak.Power...BM= mean(Max.Peak.Power...BM,na.rm=TRUE),
            Max.Eccentric.Peak.Force..N.= mean(Max.Eccentric.Peak.Force..N.,na.rm=TRUE),
            Max.RSI.Modified.VALD= mean(Max.RSI.Modified.VALD,na.rm=TRUE),
            Max.Concentric.RPD..N.s.= mean(Max.Concentric.RPD..N.s.,na.rm=TRUE),
            Max.Concentric.Peak.Velocity..m.s.= mean(Max.Concentric.Peak.Velocity..m.s.,na.rm=TRUE),
            Max.Eccentric.Peak.Velocity..m.s.= mean(Max.Eccentric.Peak.Velocity..m.s.,na.rm=TRUE),
            Max.Peak.Landing.Force..N.= mean(Max.Peak.Landing.Force..N.,na.rm=TRUE),
            MAX.Concentric.Peak.Power..W.= mean(MAX.Concentric.Peak.Power..W.,na.rm=TRUE),
            Max.CMJ.Jump.Height..cm.= mean(Max.CMJ.Jump.Height..cm.,na.rm=TRUE),
            Max.CMJ.RSI.Modified..m.s.= mean(Max.CMJ.RSI.Modified..m.s.,na.rm=TRUE),
            Max.CMJ.Concentric.RPD..N.s.= mean(Max.CMJ.Concentric.RPD..N.s.,na.rm=TRUE),
            Max.CMJ.Peak.Power..W.= mean(Max.CMJ.Peak.Power..W.,na.rm=TRUE),
            Max.CMJ.Peak.Landing.Force..N.= mean(Max.CMJ.Peak.Landing.Force..N.,na.rm=TRUE),
            CMJ.Concentric.Relative.Peak.Power...Difference.from.First= mean(CMJ.Concentric.Relative.Peak.Power...Difference.from.First,na.rm=TRUE),
            CMJ.Eccentric.Relative.Peak.Power...Difference.from.First= mean(CMJ.Eccentric.Relative.Peak.Power...Difference.from.First,na.rm=TRUE),
            Position= get_mode(Position),
            Eccentric.Asymmetry= get_mode(Eccentric.Asymmetry),
            Concentric.Asymmetry= get_mode(Concentric.Asymmetry),
            .groups = 'drop'
              )               # 1238 obs & 36 vars

CMJ_lax <- CMJ_l %>%
  na.omit()   #277 obs & 36 vars
```

```{r}
#selects counter movement jumps another way with normative information
l <- Forcedecks_L %>%
  filter(Test.Type == 'CMJ') %>%
  dplyr::select("anon_id","Date","Position","Test.Type","Countermovement.Depth..cm.","Peak.Power...BM..W.kg.","Landing.RFD..N.s.", "Eccentric.Concentric.Mean.Force.Ratio", "Peak.Landing.Force..Asym...N.", "Peak.Power..W.", "Concentric.RFD..N.s.", "Concentric.RFD..Left...N.s.","Concentric.RFD..Right...N.s.", "Concentric.Time.to.Peak.Force..s.", "Eccentric.Mean.Braking.Force..N.", "Landing.Net.Peak.Force...BM..N.kg.", "Peak.Net.Takeoff.Force...BM..N.kg.", "Concentric.RPD...BM..W.s.kg.", "Force.at.Peak.Power..N.", "Eccentric.Mean.Deceleration.Force..N.", "Eccentric.Peak.Force..N.", "RSI.Modified..m.s.", "CMJ.Stiffness..Left...N.m.", "CMJ.Stiffness..Right...N.m.", "Eccentric.Asymmetry","Concentric.Asymmetry", "Peak.Landing.Asymmetry", "DSI", "DSI.Bucket", "Eccentric.Peak.Power...BM..W.kg.", "Jump.Height..Imp.Mom...cm.", "Eccentric.Duration..s.", "Eccentric.Deceleration.Impulse..Ns.") %>%
  na.omit()

#calculates differences from norm and makes Date a date object
l <- l %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y'),
         RSI.Modified..m.s. = RSI.Modified..m.s. / 100,
         RSI.Modified.Diff.Norm = (RSI.Modified..m.s. - 0.359) / 0.359,
         Ecc.Peak.Power.Rel.Diff.Norm = (Eccentric.Peak.Power...BM..W.kg. - 16) / 16,
         Jump.Heigh.Diff.Norm = (Jump.Height..Imp.Mom...cm. - 29) / 29,
         Ecc.Duration.Diff.Norm = (Eccentric.Duration..s. - 0.55) / 0.55,
         Ecc.Deceleration.Impulse.Diff.Norm = (Eccentric.Deceleration.Impulse..Ns. - 81.5) / 81.5,
         Sport = 'Lacrosse'
  )
```

```{r}
#2: TEST TYPE= HJ
HJ_L <- Forcedecks_L %>%
  filter(Test.Type=="HJ")  %>%  #582 obs
  dplyr::select("anon_id", "Date", "Corrected.Standing.Weight..Kg.", "Mean.RSI..Flight.Contact.Time.", "Active.Stiffness..N.m.", "Best.Average.Force..N.", "Best.Average.Force..Asym...N.", "Best.Time.to.Peak.Force..ms.", "Best.Contact.Time..ms.", "Best.Flight.Time..ms.", "Best.Impulse..N.s.", "Best.Peak.Force..N.", "Best.Peak.Force..Asym...N.", "Mean.Average.Force..N.", "Mean.Average.Force..Asym...N.", "Mean.Landing.RFD..N.s.", "Mean.Landing.RFD..Asym...N.s.", "Stiffness.Fatigue....", "Stiffness.Fatigue..Asym.....", "Max.Jump.Height..cm.", "HJ.RSI", "Mean.Flight.Time..ms.", "Mean.Contact.Time..ms.") %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y')) %>%
  na.omit() %>%
  mutate(Sport = 'Lacrosse')
                 #573 obs & 20 vars
```

```{r}
#3: TEST TYPE= IMTP
IMTP_L <- Forcedecks_L %>%
  filter(Test.Type=="IMTP") %>% #162 
  dplyr::select("anon_id", "Date", "Baseline.Force..N.","Baseline.Force..Asym...N.", "Peak.Vertical.Force..N.", "Peak.Vertical.Force...BM..N.kg.", "Peak.Vertical.Force..Asym...N.", "RFD...50ms..N.s.", "RFD...50ms..Asym...N.s.", "RFD...100ms..N.s.", "RFD...100ms..Asym...N.s.", "RFD...150ms..N.s.", "RFD...150ms..Asym...N.s.", "RFD...200ms..N.s.", "RFD...200ms..Asym...N.s.", "Net.Peak.Vertical.Force..N.s.", "Net.Peak.Vertical.Force..Asym...N.s.", "Force.at.200ms...BM..N.kg.", "Absolute.Impulse.50ms..Ns.", "Absolute.Impulse.50ms..Asym...Ns.", "Absolute.Impulse.100ms..Ns.", "Absolute.Impulse.100ms..Asym...Ns.", "Absolute.Impulse.150ms..Ns.", "Absolute.Impulse.150ms..Asym...Ns.", "Absolute.Impulse.200ms..Ns.", "Absolute.Impulse.200ms..Asym...Ns."
) %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y')) %>%
  na.omit() %>%
  mutate(Sport = 'Lacrosse') #96 obs & 26 vars
```

```{r}
#3: TEST TYPE: SLJ
SLJ_L <- Forcedecks_L %>%
  filter(Test.Type=="SLJ")  #190 obs

#important variables 
SLJ_L <- subset(SLJ_L, select = c("anon_id", "Date", "Position", "Weight..kg.", "Jump.Height..Flight.Time...cm.",  "Jump.Height..Imp.Mom...cm.", "Max.Jump.Height..cm.", "Max.Single.Leg.Jump.Height.Left", "Max.Single.Leg.Jump.Height.Right", "First.SLJ.Jump.Height", "Max.Concentric.Peak.Velocity..m.s.", "Max.Eccentric.Peak.Velocity..m.s.", "RSI.Modified..m.s.", "Max.RSI.Modified..m.s.", "Max.RSI.Modified.VALD", "Eccentric.Mean.Braking.Force..N.", "Landing.RFD..N.s.","Concentric.Maximum.RFD..N.s.", "Concentric.Maximum.RFD..Right...N.s.","Concentric.Maximum.RFD..Left...N.s.", "Concentric.Impulse..Ns.", "Concentric.Impulse..Left...Ns.", "Concentric.Impulse..Right...Ns.", "Max.Concentric.Peak.Force..N.", "Max.Eccentric.Peak.Force..N."
))                        #190 obs & 25 vars

SLJ_L[SLJ_L==""] <- NA

#combining values from different observations into one
SLJ_l <- SLJ_L %>%
mutate(Date = as.Date(Date, format = '%m/%d/%Y')) %>%
  group_by(anon_id, Date) %>%
  summarise(Weight..kg. = mean(Weight..kg., na.rm = TRUE),
            Jump.Height..Flight.Time...cm.= mean(Jump.Height..Flight.Time...cm., na.rm=TRUE),
            Jump.Height..Imp.Mom...cm.= mean(Jump.Height..Imp.Mom...cm.,na.rm=TRUE),
            Max.Jump.Height..cm.= mean(Max.Jump.Height..cm. ,na.rm=TRUE),
            Max.Single.Leg.Jump.Height.Left= mean(Max.Single.Leg.Jump.Height.Left ,na.rm=TRUE),
            Max.Single.Leg.Jump.Height.Right= mean(Max.Single.Leg.Jump.Height.Right ,na.rm=TRUE),
            First.SLJ.Jump.Height= mean(First.SLJ.Jump.Height, na.rm=TRUE),
            Max.Concentric.Peak.Velocity..m.s.= mean(Max.Concentric.Peak.Velocity..m.s., na.rm=TRUE),
            Max.Eccentric.Peak.Velocity..m.s.= mean(Max.Eccentric.Peak.Velocity..m.s., na.rm=TRUE),
            RSI.Modified..m.s.= mean(RSI.Modified..m.s., na.rm=TRUE),
            Max.RSI.Modified..m.s.= mean(Max.RSI.Modified..m.s., na.rm=TRUE),
            Max.RSI.Modified.VALD= mean(Max.RSI.Modified.VALD, na.rm=TRUE),
            Eccentric.Mean.Braking.Force..N.= mean(Eccentric.Mean.Braking.Force..N., na.rm=TRUE),
            Landing.RFD..N.s.= mean(Landing.RFD..N.s., na.rm=TRUE),
            Concentric.Maximum.RFD..N.s.= mean(Concentric.Maximum.RFD..N.s., na.rm=TRUE),
            Concentric.Maximum.RFD..Right...N.s.= mean(Concentric.Maximum.RFD..Right...N.s.,na.rm=TRUE),
            Concentric.Maximum.RFD..Left...N.s.= mean(Concentric.Maximum.RFD..Left...N.s.,na.rm=TRUE),
            Concentric.Impulse..Ns.= mean(Concentric.Impulse..Ns.,na.rm=TRUE),
            Concentric.Impulse..Left...Ns.= mean(Concentric.Impulse..Left...Ns.,na.rm=TRUE),
            Concentric.Impulse..Right...Ns.= mean(Concentric.Impulse..Right...Ns.,na.rm=TRUE),
            Max.Concentric.Peak.Force..N.= mean(Max.Concentric.Peak.Force..N.,na.rm=TRUE),
            Max.Eccentric.Peak.Force..N.= mean(Max.Eccentric.Peak.Force..N.,na.rm=TRUE),
            Position= get_mode(Position),
            .groups = 'drop'
              )   #60 obs 25 vars
```

### 4. Volleyball

```{r}
#1: TEST TYPE=CMJ
CMJ_V <- subset(Forcedecks_V, select = c("anon_id","Date","Position","Test.Type","Weight..kg.","Countermovement.Depth..cm.","Peak.Power...BM..W.kg.","Landing.RFD..N.s.", "Eccentric.Concentric.Mean.Force.Ratio", "Peak.Landing.Force..Asym...N.", "Peak.Power..W.","Concentric.Maximum.RFD..N.s.","Concentric.Maximum.RFD..Right...N.s.","Concentric.Maximum.RFD..Left...N.s.","Eccentric.Mean.Braking.Force..N.", "Max.Jump.Height..cm.", "Max.Concentric.Peak.Force..N.", "Relative.Concentric.Power.Bilateral",
"Relative.Eccentric.Power.Bilateral","Max.Peak.Power...BM", "Max.Eccentric.Peak.Force..N.",
"Max.RSI.Modified.VALD","Max.Concentric.RPD..N.s.", "Max.Concentric.Peak.Velocity..m.s.", "Max.Eccentric.Peak.Velocity..m.s.", "Max.Peak.Landing.Force..N.", "MAX.Concentric.Peak.Power..W.","Max.CMJ.Jump.Height..cm.",
"Max.CMJ.RSI.Modified..m.s.","Max.CMJ.Concentric.RPD..N.s.","Max.CMJ.Peak.Power..W.","Max.CMJ.Peak.Landing.Force..N.","CMJ.Concentric.Relative.Peak.Power...Difference.from.First","CMJ.Eccentric.Relative.Peak.Power...Difference.from.First","Eccentric.Asymmetry","Concentric.Asymmetry"
))        #5332 obs & 36 vars 

#possible different final dataset 
cmj_v <- CMJ_V %>%
  na.omit()  #457 obs

CMJ_V[CMJ_V==""] <- NA

#combining values from different observations into one
CMJ_v <- CMJ_V %>%
mutate(Date = as.Date(Date, format = '%m/%d/%Y')) %>%
  filter(Test.Type=="CMJ") %>%   #add to others even tho might not need
  group_by(anon_id, Date) %>%
  summarise(Weight..kg. = mean(Weight..kg., na.rm = TRUE),
            Countermovement.Depth..cm.= mean(Countermovement.Depth..cm., na.rm=TRUE),
            Peak.Power...BM..W.kg.= mean(Peak.Power...BM..W.kg., na.rm=TRUE),
            Landing.RFD..N.s.= mean(Landing.RFD..N.s.,na.rm=TRUE),
            Eccentric.Concentric.Mean.Force.Ratio= mean(Eccentric.Concentric.Mean.Force.Ratio,na.rm=TRUE),
            Peak.Landing.Force..Asym...N.= mean(Peak.Landing.Force..Asym...N.,na.rm=TRUE),
            Peak.Power..W.= mean(Peak.Power..W.,na.rm=TRUE),
            Concentric.Maximum.RFD..N.s.= mean(Concentric.Maximum.RFD..N.s.,na.rm=TRUE),
            Concentric.Maximum.RFD..Right...N.s.= mean(Concentric.Maximum.RFD..Right...N.s.,na.rm=TRUE),
            Concentric.Maximum.RFD..Left...N.s.= mean(Concentric.Maximum.RFD..Left...N.s.,na.rm=TRUE),
            Eccentric.Mean.Braking.Force..N.= mean(Eccentric.Mean.Braking.Force..N.,na.rm=TRUE),
            Max.Jump.Height..cm.= mean(Max.Jump.Height..cm.,na.rm=TRUE),
            Max.Concentric.Peak.Force..N.= mean(Max.Concentric.Peak.Force..N.,na.rm=TRUE),
            Relative.Concentric.Power.Bilateral= mean(Relative.Concentric.Power.Bilateral,na.rm=TRUE),
            Relative.Eccentric.Power.Bilateral= mean(Relative.Eccentric.Power.Bilateral,na.rm=TRUE),
            Max.Peak.Power...BM= mean(Max.Peak.Power...BM,na.rm=TRUE),
            Max.Eccentric.Peak.Force..N.= mean(Max.Eccentric.Peak.Force..N.,na.rm=TRUE),
            Max.RSI.Modified.VALD= mean(Max.RSI.Modified.VALD,na.rm=TRUE),
            Max.Concentric.RPD..N.s.= mean(Max.Concentric.RPD..N.s.,na.rm=TRUE),
            Max.Concentric.Peak.Velocity..m.s.= mean(Max.Concentric.Peak.Velocity..m.s.,na.rm=TRUE),
            Max.Eccentric.Peak.Velocity..m.s.= mean(Max.Eccentric.Peak.Velocity..m.s.,na.rm=TRUE),
            Max.Peak.Landing.Force..N.= mean(Max.Peak.Landing.Force..N.,na.rm=TRUE),
            MAX.Concentric.Peak.Power..W.= mean(MAX.Concentric.Peak.Power..W.,na.rm=TRUE),
            Max.CMJ.Jump.Height..cm.= mean(Max.CMJ.Jump.Height..cm.,na.rm=TRUE),
            Max.CMJ.RSI.Modified..m.s.= mean(Max.CMJ.RSI.Modified..m.s.,na.rm=TRUE),
            Max.CMJ.Concentric.RPD..N.s.= mean(Max.CMJ.Concentric.RPD..N.s.,na.rm=TRUE),
            Max.CMJ.Peak.Power..W.= mean(Max.CMJ.Peak.Power..W.,na.rm=TRUE),
            Max.CMJ.Peak.Landing.Force..N.= mean(Max.CMJ.Peak.Landing.Force..N.,na.rm=TRUE),
            CMJ.Concentric.Relative.Peak.Power...Difference.from.First= mean(CMJ.Concentric.Relative.Peak.Power...Difference.from.First,na.rm=TRUE),
            CMJ.Eccentric.Relative.Peak.Power...Difference.from.First= mean(CMJ.Eccentric.Relative.Peak.Power...Difference.from.First,na.rm=TRUE),
            Position= get_mode(Position),
            Eccentric.Asymmetry= get_mode(Eccentric.Asymmetry),
            Concentric.Asymmetry= get_mode(Concentric.Asymmetry),
            .groups = 'drop'
            
              )         # 1416 obs & 32 vars -> 1801 obs w/ Position Eccentric + Concentric Asymmetry

CMJ_vb <- CMJ_v %>%
  na.omit()   #508 obs & 32 vars  -> 173 obs w/ Position Eccentric + Concentric Asymmetry
```

```{r}
#selects counter movement jumps another way with normative information
v <- Forcedecks_V %>%
  filter(Test.Type == 'CMJ') %>%
  dplyr::select("anon_id","Date","Position","Test.Type","Countermovement.Depth..cm.","Peak.Power...BM..W.kg.","Landing.RFD..N.s.", "Eccentric.Concentric.Mean.Force.Ratio", "Peak.Landing.Force..Asym...N.", "Peak.Power..W.", "Concentric.RFD..N.s.", "Concentric.RFD..Left...N.s.","Concentric.RFD..Right...N.s.", "Concentric.Time.to.Peak.Force..s.", "Eccentric.Mean.Braking.Force..N.", "Landing.Net.Peak.Force...BM..N.kg.", "Peak.Net.Takeoff.Force...BM..N.kg.", "Concentric.RPD...BM..W.s.kg.", "Force.at.Peak.Power..N.", "Eccentric.Mean.Deceleration.Force..N.", "Eccentric.Peak.Force..N.", "RSI.Modified..m.s.", "CMJ.Stiffness..Left...N.m.", "CMJ.Stiffness..Right...N.m.", "Eccentric.Asymmetry","Concentric.Asymmetry", "Peak.Landing.Asymmetry", "DSI", "DSI.Bucket", "Eccentric.Peak.Power...BM..W.kg.", "Jump.Height..Imp.Mom...cm.", "Eccentric.Duration..s.", "Eccentric.Deceleration.Impulse..Ns.") %>%
  na.omit()

#calculates differences from norm and makes Date a date object
v <- v %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y'),
         RSI.Modified..m.s. = RSI.Modified..m.s. / 100,
         RSI.Modified.Diff.Norm = (RSI.Modified..m.s. - 0.417) / 0.417,
         Ecc.Peak.Power.Rel.Diff.Norm = (Eccentric.Peak.Power...BM..W.kg. - 18) / 18,
         Jump.Heigh.Diff.Norm = (Jump.Height..Imp.Mom...cm. - 30) / 30,
         Ecc.Duration.Diff.Norm = (Eccentric.Duration..s. - 0.51) / 0.51,
         Ecc.Deceleration.Impulse.Diff.Norm = (Eccentric.Deceleration.Impulse..Ns. - 98.4) / 98.4,
         Sport = 'Volleyball'
  )
```

```{r}
#3: TEST TYPE= IMTP
IMTP_V <- Forcedecks_V %>%
  filter(Test.Type=="IMTP") %>% #162 
  dplyr::select("anon_id", "Date", "Baseline.Force..N.","Baseline.Force..Asym...N.", "Peak.Vertical.Force..N.", "Peak.Vertical.Force...BM..N.kg.", "Peak.Vertical.Force..Asym...N.", "RFD...50ms..N.s.", "RFD...50ms..Asym...N.s.", "RFD...100ms..N.s.", "RFD...100ms..Asym...N.s.", "RFD...150ms..N.s.", "RFD...150ms..Asym...N.s.", "RFD...200ms..N.s.", "RFD...200ms..Asym...N.s.", "Net.Peak.Vertical.Force..N.s.", "Net.Peak.Vertical.Force..Asym...N.s.", "Force.at.200ms...BM..N.kg.", "Absolute.Impulse.50ms..Ns.", "Absolute.Impulse.50ms..Asym...Ns.", "Absolute.Impulse.100ms..Ns.", "Absolute.Impulse.100ms..Asym...Ns.", "Absolute.Impulse.150ms..Ns.", "Absolute.Impulse.150ms..Asym...Ns.", "Absolute.Impulse.200ms..Ns.", "Absolute.Impulse.200ms..Asym...Ns."
) %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y')) %>%
  na.omit() %>%
  mutate(Sport = 'Volleyball')  #1240 obs & 30 vars
```

```{r}
#3: TEST TYPE= HJ
HJ_V <- Forcedecks_V %>%
  filter(Test.Type=="HJ")  %>%  #367 obs
  dplyr::select("anon_id", "Date", "Corrected.Standing.Weight..Kg.", "Mean.RSI..Flight.Contact.Time.", "Active.Stiffness..N.m.", "Best.Average.Force..N.", "Best.Average.Force..Asym...N.", "Best.Time.to.Peak.Force..ms.", "Best.Contact.Time..ms.", "Best.Flight.Time..ms.", "Best.Impulse..N.s.", "Best.Peak.Force..N.", "Best.Peak.Force..Asym...N.", "Mean.Average.Force..N.", "Mean.Average.Force..Asym...N.", "Mean.Landing.RFD..N.s.", "Mean.Landing.RFD..Asym...N.s.", "Stiffness.Fatigue....", "Stiffness.Fatigue..Asym.....", "Max.Jump.Height..cm.", "HJ.RSI", "Mean.Flight.Time..ms.", "Mean.Contact.Time..ms.") %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y')) %>%
  na.omit() %>%
  mutate(Sport = 'Volleyball')
                 #352 obs & 20 vars
```


## Performance


Of all performance datasets, only basketball and volleyball have positional norm information but are also missing a lot of positional information which makes this column sparse. None of the datasets contain rotational data or razor data. Contain small amounts of iso prone data. 

### 1. Basketball

```{r}
#selects variables of interest, nordic and hip data, and cleans up position variable
performance_B <- subset(Performance_B, select = c('anon_id', 'Date', 'Athlete.Bodyweight..kg.','Sport.Position', 'Side', 'Repetitions', 'Maximum.Force', 'Average.Force', 'Impulse', 'Nordic.Left.MEAN', 'Nordic.Right.MEAN', 'Nordic.MEAN.Imbalance', 'Nordic.Left.MAX', 'Nordic.Right.MAX', 'Nordic.MAX.Imbalance', 'Trend', 'Nordic...Difference.from.First.Test', 'Maximum.Nordic.Bilateral.Mean', 'Relative.Maximum.Nordic.Bilateral.Mean', 'Hip.Abd.Left.MEAN', 'Hip.Abd.Right.MEAN', 'Hip.Abduction.MEAN.Imbalance', 'Hip.Abd.Left.MAX', 'Hip.Abd.Right.MAX', 'Hip.Abduction.MAX.Imbalance', 'Hip.Add.Left.MEAN', 'Hip.Add.Right.MEAN', 'Hip.Adduction.MEAN.Imbalance', 'Hip.Add.Left.MAX', 'Hip.Add.Right.MAX', 'Hip.Adduction.MAX.Imbalance', 'Bilateral.Hip.Abduction.Adduction.Ratio')) %>%
  mutate(Position = case_when(
    Sport.Position == '' ~ 'None',
    Sport.Position == '|Guard' ~ 'Guard',
    str_detect(Sport.Position, "Primary:") ~ 'Forward',
    TRUE ~ Sport.Position
  )) %>%
  dplyr::select(-Sport.Position)

#makes the date column a 'date' object for later and omits NA values for nordic dataset
performance_B_nordic <- performance_B %>%
  dplyr::select(-c('Hip.Abd.Left.MEAN', 'Hip.Abd.Right.MEAN', 'Hip.Abduction.MEAN.Imbalance', 'Hip.Abd.Left.MAX', 'Hip.Abd.Right.MAX', 'Hip.Abduction.MAX.Imbalance', 'Hip.Add.Left.MEAN', 'Hip.Add.Right.MEAN', 'Hip.Adduction.MEAN.Imbalance', 'Hip.Add.Left.MAX', 'Hip.Add.Right.MAX', 'Hip.Adduction.MAX.Imbalance', 'Bilateral.Hip.Abduction.Adduction.Ratio')) %>%
  filter(Athlete.Bodyweight..kg. > 5) %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y'),
         Force.Diff.Norm = (Maximum.Nordic.Bilateral.Mean - 308) / 308,
         Imbalance.Diff.Norm = (Nordic.MEAN.Imbalance - 6.3) / 6.3,
         Sport = 'Basketball') %>%
  na.omit()

#makes the date column a 'date' object for later and omits NA values for hip dataset
performance_B_hip <- performance_B %>%
  dplyr::select(-c('Nordic.Left.MEAN', 'Nordic.Right.MEAN', 'Nordic.MEAN.Imbalance', 'Nordic.Left.MAX', 'Nordic.Right.MAX', 'Nordic.MAX.Imbalance', 'Trend', 'Nordic...Difference.from.First.Test', 'Maximum.Nordic.Bilateral.Mean', 'Relative.Maximum.Nordic.Bilateral.Mean')) %>%
  filter(Athlete.Bodyweight..kg. > 5) %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y'),
         Abd.Add.Ratio.Diff.Norm = (Bilateral.Hip.Abduction.Adduction.Ratio - 1) / 1,
         Sport = 'Basketball') %>%
  na.omit()
```

Need to either get more data on positions of players or get rid of percent difference from norm since it has a lot of NAs. Could consider athlete bodyweight as well to put strength relatively but also has missing data and has negative values? Also missing a decent amount of z-score observations. 147 observations with percent difference norm and z-scores. 550 with only z-scores. 592 with neither percent difference norm or z-scores. If we include athlete bodyweight and exclude percent difference norm and z-scores there are 521 observations. 

Hip dataset contains 109 observations including the bodyweight variable, 129 otherwise. 

```{r}
#summarizes the number of unique athletes per position group
performance_B_nordic %>%
  group_by(Position) %>%
  summarize(`Unique Athletes` = n_distinct(anon_id))
```

There are only 4 unique centers represented with most of the observations being ID_40 and ID_51, ID_15 and ID_30 each only have one observation. Forwards only have 8 unique players but the split between these players is more even with the exception of ID_24 who only has one observation. Guards has 10 unique players with ID_55 making up a large proportion of these observations and ID_5, ID_54, and ID_63 only being represented once. 

```{r}
#creates a boxplot of maximum relative bilateral force across the basketball positions
ggplot(performance_B_nordic, aes(x = Relative.Maximum.Nordic.Bilateral.Mean, y = Position)) +
  geom_boxplot(fill = '#CFB87C', color = 'black') + 
  labs(title = 'Distribution of Maximum Relative Bilateral Force Across Basketball Postions',
       y = 'Position',
       x = 'Maximum Relative Bilateral Force (N / kg)') +
  theme_bw()
```

Centers appear to have a far greater variability in force along with a lower median of force in comparison to forwards and guards. The same appears to be true for the relative force. Interestingly when plotting the athlete bodyweight vs position there is no signifiant differences and the median weight for centers is less than the median weight of guards and forwards. 

```{r}
#creates a correlation matrix of all numerical values
cor(performance_B_nordic[,-c(1, 2, 4, 5, 15, 19, 20)])
```

Interestingly bodyweight is most correlated with maximum force. Also interestingly Maximum.Force is equal to Nordic.Left.MAX and Average.Force is equal to Nordic.Left.MEAn, is this supposed to be the case? Not a whole lot of colinearity otherwise.

### 2. Soccer

```{r}
#selects variables of interest, nordic and hip data, and cleans up position variable
performance_S <- subset(Performance_S, select = c('anon_id', 'Date', 'Athlete.Bodyweight..kg.','Sport.Position', 'Side', 'Repetitions', 'Maximum.Force', 'Average.Force', 'Impulse', 'Nordic.Left.MEAN', 'Nordic.Right.MEAN', 'Nordic.MEAN.Imbalance', 'Nordic.Left.MAX', 'Nordic.Right.MAX', 'Nordic.MAX.Imbalance', 'Trend', 'Nordic...Difference.from.First.Test', 'Maximum.Nordic.Bilateral.Mean', 'Relative.Maximum.Nordic.Bilateral.Mean', 'Hip.Abd.Left.MEAN', 'Hip.Abd.Right.MEAN', 'Hip.Abduction.MEAN.Imbalance', 'Hip.Abd.Left.MAX', 'Hip.Abd.Right.MAX', 'Hip.Abduction.MAX.Imbalance', 'Hip.Add.Left.MEAN', 'Hip.Add.Right.MEAN', 'Hip.Adduction.MEAN.Imbalance', 'Hip.Add.Left.MAX', 'Hip.Add.Right.MAX', 'Hip.Adduction.MAX.Imbalance', 'Bilateral.Hip.Abduction.Adduction.Ratio')) %>%
  mutate(Position = case_when(
    Sport.Position == '' ~ 'None',
    TRUE ~ Sport.Position
  )) %>%
  dplyr::select(-Sport.Position)

#makes the date column a 'date' object for later and omits NA values for nordic dataset
performance_S_nordic <- performance_S %>%
  dplyr::select(-c('Hip.Abd.Left.MEAN', 'Hip.Abd.Right.MEAN', 'Hip.Abduction.MEAN.Imbalance', 'Hip.Abd.Left.MAX', 'Hip.Abd.Right.MAX', 'Hip.Abduction.MAX.Imbalance', 'Hip.Add.Left.MEAN', 'Hip.Add.Right.MEAN', 'Hip.Adduction.MEAN.Imbalance', 'Hip.Add.Left.MAX', 'Hip.Add.Right.MAX', 'Hip.Adduction.MAX.Imbalance', 'Bilateral.Hip.Abduction.Adduction.Ratio')) %>%
  filter(Athlete.Bodyweight..kg. > 5) %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y'),
         Force.Diff.Norm = (Maximum.Nordic.Bilateral.Mean - 298) / 298,
         Imbalance.Diff.Norm = (Nordic.MEAN.Imbalance - 6.5) / 6.5,
         Sport = 'Soccer') %>%
  na.omit()

#makes the date column a 'date' object for later and omits NA values for hip dataset
performance_S_hip <- performance_S %>%
  dplyr::select(-c('Nordic.Left.MEAN', 'Nordic.Right.MEAN', 'Nordic.MEAN.Imbalance', 'Nordic.Left.MAX', 'Nordic.Right.MAX', 'Nordic.MAX.Imbalance', 'Trend', 'Nordic...Difference.from.First.Test', 'Maximum.Nordic.Bilateral.Mean', 'Relative.Maximum.Nordic.Bilateral.Mean')) %>%
  filter(Athlete.Bodyweight..kg. > 5) %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y'),
         Abd.Add.Ratio.Diff.Norm = (Bilateral.Hip.Abduction.Adduction.Ratio - 0.98) / 0.98,
         Sport = 'Soccer') %>%
  na.omit()
```

Does not contain any information about positional norms so there are no percent differences from norm. 421 observations with z-scores. 483 observations without z-scores. There are 400 observations if bodyweight is included.  

Hip dataset contains only 39 observations with body weight included and without it included. 

```{r}
#summarizes the number of unique athletes per position group
performance_S_nordic %>%
  group_by(Position) %>%
  summarize(`Unique Athletes` = n_distinct(anon_id))
```

There are only one unique outside back and center back players. Only 4 defense midfield players with ID_32 only having one observation. Only 3 goalies, relatively even distribution of observations. 7 forwards, also pretty even distribution of observations. 7 midfeilders with ID_94 and ID_32 only representing one observation each. 

```{r}
#creates a boxplot of maximum relative bilateral force across the basketball positions
ggplot(performance_S_nordic, aes(x = Relative.Maximum.Nordic.Bilateral.Mean, y = Position)) +
  geom_boxplot(fill = '#CFB87C', color = 'black') + 
  labs(title = 'Distribution of Maximum Relative Bilateral Force Across Basketball Postions',
       y = 'Position',
       x = 'Maximum Relative Bilateral Force (N / kg)') +
  theme_bw()
```

There is a big outlier in ID_3 whos mean maximum bilateral force in newtons was less than her bodyweight in kg.

```{r}
#creates a correlation matrix of all numerical values
cor(performance_S_nordic[,-c(1, 2, 4, 5, 15, 19, 20)])
```

Athlete bodyweight is less correlated with any strength measures. 

### 3. Lacrosse

```{r}
#selects variables of interest, nordic and hip data, and cleans up position variable
performance_L <- subset(Performance_L, select = c('anon_id', 'Date', 'Athlete.Bodyweight..kg.','Sport.Position', 'Side', 'Repetitions', 'Maximum.Force', 'Average.Force', 'Impulse', 'Nordic.Left.MEAN', 'Nordic.Right.MEAN', 'Nordic.MEAN.Imbalance', 'Nordic.Left.MAX', 'Nordic.Right.MAX', 'Nordic.MAX.Imbalance', 'Trend', 'Nordic...Difference.from.First.Test', 'Maximum.Nordic.Bilateral.Mean', 'Relative.Maximum.Nordic.Bilateral.Mean', 'Hip.Abd.Left.MEAN', 'Hip.Abd.Right.MEAN', 'Hip.Abduction.MEAN.Imbalance', 'Hip.Abd.Left.MAX', 'Hip.Abd.Right.MAX', 'Hip.Abduction.MAX.Imbalance', 'Hip.Add.Left.MEAN', 'Hip.Add.Right.MEAN', 'Hip.Adduction.MEAN.Imbalance', 'Hip.Add.Left.MAX', 'Hip.Add.Right.MAX', 'Hip.Adduction.MAX.Imbalance', 'Bilateral.Hip.Abduction.Adduction.Ratio')) %>%
  mutate(Position = case_when(
    Sport.Position == '' ~ 'None',
    TRUE ~ Sport.Position
  )) %>%
  dplyr::select(-Sport.Position)

#makes the date column a 'date' object for later and omits NA values for nordic dataset
performance_L_nordic <- performance_L %>%
  dplyr::select(-c('Hip.Abd.Left.MEAN', 'Hip.Abd.Right.MEAN', 'Hip.Abduction.MEAN.Imbalance', 'Hip.Abd.Left.MAX', 'Hip.Abd.Right.MAX', 'Hip.Abduction.MAX.Imbalance', 'Hip.Add.Left.MEAN', 'Hip.Add.Right.MEAN', 'Hip.Adduction.MEAN.Imbalance', 'Hip.Add.Left.MAX', 'Hip.Add.Right.MAX', 'Hip.Adduction.MAX.Imbalance', 'Bilateral.Hip.Abduction.Adduction.Ratio')) %>%
  filter(Athlete.Bodyweight..kg. > 5) %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y'),
         Force.Diff.Norm = (Maximum.Nordic.Bilateral.Mean - 277) / 277,
         Imbalance.Diff.Norm = (Nordic.MEAN.Imbalance - 5.8) / 5.8,
         Sport = 'Lacrosse') %>%
  na.omit()

#makes the date column a 'date' object for later and omits NA values for hip dataset
performance_L_hip <- performance_L %>%
  dplyr::select(-c('Nordic.Left.MEAN', 'Nordic.Right.MEAN', 'Nordic.MEAN.Imbalance', 'Nordic.Left.MAX', 'Nordic.Right.MAX', 'Nordic.MAX.Imbalance', 'Trend', 'Nordic...Difference.from.First.Test', 'Maximum.Nordic.Bilateral.Mean', 'Relative.Maximum.Nordic.Bilateral.Mean')) %>%
  filter(Athlete.Bodyweight..kg. > 5) %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y'),
         Abd.Add.Ratio.Diff.Norm = (Bilateral.Hip.Abduction.Adduction.Ratio - 0.99) / 0.99,
         Sport = 'Lacrosse') %>%
  na.omit()
```

Also does not contain any information about positional norms so there are no percent differences from norm. 855 observations with z-scores. 929 observations without z-scores. 810 observations if bodyweight is included.  

Hip dataset contains 100 observations with bodyweight included and excluded. 

```{r}
#summarizes the number of unique athletes per position group
performance_L_nordic %>%
  group_by(Position) %>%
  summarize(`Unique Athletes` = n_distinct(anon_id))
```

This dataset seems to have a better amount of unique players per position. 

```{r}
#creates a boxplot of maximum relative bilateral force across the basketball positions
ggplot(performance_L_nordic, aes(x = Relative.Maximum.Nordic.Bilateral.Mean, y = Position)) +
  geom_boxplot(fill = '#CFB87C', color = 'black') + 
  labs(title = 'Distribution of Maximum Relative Bilateral Force Across Basketball Postions',
       y = 'Position',
       x = 'Maximum Relative Bilateral Force (N / kg)') +
  theme_bw()
```

All the positions seem to have a similar distribution of maximum relative bilateral force. 

```{r}
#creates a correlation matrix of all numerical values
cor(performance_L_nordic[,-c(1, 2, 4, 5, 15, 19, 20)])
```

Bodyweight is pretty correlated with Maximum.Force.

### 4. Volleyball

```{r}
#selects variables of interest, nordic and hip data
performance_V <- subset(Performance_V, select = c('anon_id', 'Date', 'Athlete.Bodyweight..kg.','Sport.Position', 'Side', 'Repetitions', 'Maximum.Force', 'Average.Force', 'Impulse', 'Nordic.Left.MEAN', 'Nordic.Right.MEAN', 'Nordic.MEAN.Imbalance', 'Nordic.Left.MAX', 'Nordic.Right.MAX', 'Nordic.MAX.Imbalance', 'Trend', 'Nordic...Difference.from.First.Test', 'Maximum.Nordic.Bilateral.Mean', 'Relative.Maximum.Nordic.Bilateral.Mean', 'Hip.Abd.Left.MEAN', 'Hip.Abd.Right.MEAN', 'Hip.Abduction.MEAN.Imbalance', 'Hip.Abd.Left.MAX', 'Hip.Abd.Right.MAX', 'Hip.Abduction.MAX.Imbalance', 'Hip.Add.Left.MEAN', 'Hip.Add.Right.MEAN', 'Hip.Adduction.MEAN.Imbalance', 'Hip.Add.Left.MAX', 'Hip.Add.Right.MAX', 'Hip.Adduction.MAX.Imbalance', 'Bilateral.Hip.Abduction.Adduction.Ratio')) %>%
  mutate(Position = case_when(
    Sport.Position == '' ~ 'None',
    TRUE ~ Sport.Position
  )) %>%
  dplyr::select(-Sport.Position)

#makes the date column a 'date' object for later and omits NA values for nordic dataset
performance_V_nordic <- performance_V %>%
  dplyr::select(-c('Hip.Abd.Left.MEAN', 'Hip.Abd.Right.MEAN', 'Hip.Abduction.MEAN.Imbalance', 'Hip.Abd.Left.MAX', 'Hip.Abd.Right.MAX', 'Hip.Abduction.MAX.Imbalance', 'Hip.Add.Left.MEAN', 'Hip.Add.Right.MEAN', 'Hip.Adduction.MEAN.Imbalance', 'Hip.Add.Left.MAX', 'Hip.Add.Right.MAX', 'Hip.Adduction.MAX.Imbalance', 'Bilateral.Hip.Abduction.Adduction.Ratio')) %>%
  filter(Athlete.Bodyweight..kg. > 5) %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y'),
         Force.Diff.Norm = (Maximum.Nordic.Bilateral.Mean - 287) / 287,
         Imbalance.Diff.Norm = (Nordic.MEAN.Imbalance - 6.2) / 6.2,
         Sport = 'Volleyball') %>%
  na.omit()

#makes the date column a 'date' object for later and omits NA values for hip dataset
performance_V_hip <- performance_V %>%
  dplyr::select(-c('Nordic.Left.MEAN', 'Nordic.Right.MEAN', 'Nordic.MEAN.Imbalance', 'Nordic.Left.MAX', 'Nordic.Right.MAX', 'Nordic.MAX.Imbalance', 'Trend', 'Nordic...Difference.from.First.Test', 'Maximum.Nordic.Bilateral.Mean', 'Relative.Maximum.Nordic.Bilateral.Mean')) %>%
  filter(Athlete.Bodyweight..kg. > 5) %>%
  mutate(Date = as.Date(Date, format = '%m/%d/%Y'),
         Abd.Add.Ratio.Diff.Norm = (Bilateral.Hip.Abduction.Adduction.Ratio - 1.04) / 1.04,
         Sport = 'Volleyball') %>%
  na.omit()
```

There are a lot of observations with the player playing multiple positions, need to figure out how to filter down when analyzing data by positions. 

Does have positional norm information but a lot of missing values. Only 33 observations with percent difference norm and z-scores. 356 observations with only z-scores. 393 observations without either percent difference norm or z-scores. 325 observations if bodyweight is included.

Hip data contains 180 observations with bodyweight included, 220 otherwise.

```{r}
#summarizes the number of unique athletes per position group
performance_V_nordic %>%
  group_by(Position) %>%
  summarize(`Unique Athletes` = n_distinct(anon_id))
```

There are very few unique athletes per position in this dataset, need to figure out how we can assign two position athletes into one for better analysis of positions.  

```{r}
#creates a boxplot of maximum relative bilateral force across the basketball positions
ggplot(performance_V_nordic, aes(x = Relative.Maximum.Nordic.Bilateral.Mean, y = Position)) +
  geom_boxplot(fill = '#CFB87C', color = 'black') + 
  labs(title = 'Distribution of Maximum Relative Bilateral Force Across Basketball Postions',
       y = 'Position',
       x = 'Maximum Relative Bilateral Force (N / kg)') +
  theme_bw()
```

Middle Blocker|Opposite looks like it would fit more into Middle Blocker, Libero|Defensive specialist looks like it could fit inot Libero. Opposite|Outside Hitter is harder to tell. 

```{r}
#creates a correlation matrix of all numerical values
cor(performance_V_nordic[,-c(1, 2, 4, 5, 15, 19, 20)])
```


# Question 1: Thresholds for Lower Body Risk


## All Time


### 1. Basketball 

```{r}
#creating lists of athletes that suffered any lower body injuries, acl injury, HSI
lb_injury_B <- incident_B %>%
  filter(LB.Injury == 1) %>%
  distinct(anon_id) %>%
  pull(anon_id)
acl_injury_B <- incident_B %>%
  filter(ACL == 1) %>%
  distinct(anon_id) %>%
  pull(anon_id)
hsi_injury_B <- incident_B %>%
  filter(HSI == 1) %>%
  distinct(anon_id) %>%
  pull(anon_id)
ankle_injury_B <- incident_B %>%
  filter(Body.Part. == 'Ankle') %>%
  distinct(anon_id) %>%
  pull(anon_id)
```

```{r}
#creating new columns in the nordic performance dataset that are binary indicators of the different injury focuses
performance_B_nordic['LB'] <- ifelse(performance_B_nordic$anon_id %in% lb_injury_B, 'Yes', 'No')
performance_B_nordic['ACL'] <- ifelse(performance_B_nordic$anon_id %in% acl_injury_B, 'Yes', 'No')
performance_B_nordic['HSI'] <- ifelse(performance_B_nordic$anon_id %in% hsi_injury_B, 'Yes', 'No')

#summarising the 
performance_B_nordic %>%
  group_by(LB) %>%
  summarise(Avg.Max.Force = mean(Maximum.Force),
            Avg.Imbalance = mean(Nordic.MEAN.Imbalance),
            Avg.Rel.Force = mean(Relative.Maximum.Nordic.Bilateral.Mean))
```

```{r}
#creating a boxplot displaying distribution of relative maximum bilateral mean in those who experienced lower body injury vs those that did not
ggplot(data = performance_B_nordic %>% filter(Position == 'Forward'), aes(x = Maximum.Force, y = LB)) + 
  geom_boxplot(fill = '#CFB87C', color = 'black') + 
  labs(title = 'Distribution of Maximum Force vs Lower Body Injury (All Time)',
       y = 'Did Player Suffer Lower Body Injury',
       x = 'Maximum Force (N)',
       caption = 'Womens Basketball Forwards') +
  theme_bw()
```

```{r}
#creating new columns in the cmj dataset that are binary indicators of the different injury focuses
b['LB'] <- ifelse(b$anon_id %in% lb_injury_B, 'Yes', 'No')
b['ACL'] <- ifelse(b$anon_id %in% acl_injury_B, 'Yes', 'No')
b['HSI'] <- ifelse(b$anon_id %in% hsi_injury_B, 'Yes', 'No')
b['Sport'] <- 'Basketball'
```

```{r}
#creating a boxplot displaying distribution of relative maximum bilateral mean in those who experienced lower body injury vs those that did not
ggplot(data = b, aes(x = Concentric.RPD...BM..W.s.kg., fill = LB)) + 
  geom_density(alpha = 0.5) + 
  scale_fill_manual(values = c('#CFB87C', 'black')) + 
  labs(title = 'Distribution of Absolute Impulse at 200 ms vs Lower Body Injury (All Time)',
       y = 'Density',
       x = 'Absolute Impulse at 200 ms (Ns)',
       fill = 'Lower Body Injury',
       caption = 'Womens Basketball') +
  theme_bw()
```

```{r}
#creating new columns in the imtp dataset that are binary indicators of the different injury focuses
IMTP_B['LB'] <- ifelse(IMTP_B$anon_id %in% lb_injury_B, 'Yes', 'No')
IMTP_B['ACL'] <- ifelse(IMTP_B$anon_id %in% acl_injury_B, 'Yes', 'No')
IMTP_B['HSI'] <- ifelse(IMTP_B$anon_id %in% hsi_injury_B, 'Yes', 'No')
IMTP_B['Sport'] <- 'Basketball'
```

```{r}
#creating a boxplot displaying distribution of relative maximum bilateral mean in those who experienced lower body injury vs those that did not
ggplot(data = IMTP_B, aes(x = RFD...200ms..N.s., fill = LB)) + 
  geom_density(alpha = 0.5) + 
  scale_fill_manual(values = c('#CFB87C', 'black')) + 
  labs(title = 'Distribution of Absolute Impulse at 200 ms vs Lower Body Injury (All Time)',
       y = 'Density',
       x = 'Absolute Impulse at 200 ms (Ns)',
       fill = 'Lower Body Injury',
       caption = 'Womens Basketball') +
  theme_bw()
```

```{r}
#creating new columns in the hj dataset that are binary indicators of the different injury focuses
HJ_B['LB'] <- ifelse(HJ_B$anon_id %in% lb_injury_B, 'Yes', 'No')
HJ_B['ACL'] <- ifelse(HJ_B$anon_id %in% acl_injury_B, 'Yes', 'No')
HJ_B['HSI'] <- ifelse(HJ_B$anon_id %in% hsi_injury_B, 'Yes', 'No')
HJ_B['Ankle'] <- ifelse(HJ_B$anon_id %in% ankle_injury_B, 'Yes', 'No')
```

```{r}
#creating a boxplot displaying distribution of relative maximum bilateral mean in those who experienced lower body injury vs those that did not
ggplot(data = HJ_B, aes(x = Mean.Flight.Time..ms., fill = Ankle)) + 
  geom_density(alpha = 0.5) + 
  scale_fill_manual(values = c('#CFB87C', 'black')) + 
  labs(title = 'Distribution of Mean Flight Time vs Ankle Injury (All Time)',
       y = 'Density',
       x = 'Mean Flight Time (ms)',
       fill = 'Ankle Injury',
       caption = 'CU Womens Basketball') +
  scale_x_continuous(breaks = seq(from = 0, to = 7, by = 0.05)) + 
  theme_bw()
```

### 2. Soccer 

```{r}
#creating lists of athletes that suffered any lower body injuries, acl injury, HSI
lb_injury_S <- incident_S %>%
  filter(LB.Injury == 1) %>%
  distinct(anon_id) %>%
  pull(anon_id)
acl_injury_S <- incident_S %>%
  filter(ACL == 1) %>%
  distinct(anon_id) %>%
  pull(anon_id)
hsi_injury_S <- incident_S %>%
  filter(HSI == 1) %>%
  distinct(anon_id) %>%
  pull(anon_id)
ankle_injury_S <- incident_S %>%
  filter(Body.Part. == 'Ankle') %>%
  distinct(anon_id) %>%
  pull(anon_id)
```

```{r}
#creating new columns in the nordic performance dataset that are binary indicators of the different injury focuses
performance_S_nordic['LB'] <- ifelse(performance_S_nordic$anon_id %in% lb_injury_S, 'Yes', 'No')
performance_S_nordic['ACL'] <- ifelse(performance_S_nordic$anon_id %in% acl_injury_S, 'Yes', 'No')
performance_S_nordic['HSI'] <- ifelse(performance_S_nordic$anon_id %in% hsi_injury_S, 'Yes', 'No')
```

```{r}
#creating a boxplot displaying distribution of relative maximum bilateral mean in those who experienced lower body injury vs those that did not
ggplot(performance_S_nordic, aes(x = Relative.Maximum.Nordic.Bilateral.Mean, y = LB)) + 
  geom_boxplot(fill = '#CFB87C', color = 'black') + 
  labs(title = 'Distribution of Maximum Relative Bilateral Force vs Lower Body Injury',
       y = 'Was the Player Injured',
       x = 'Maximum Relative Bilateral Force (N / kg)') +
  theme_bw()
```

```{r}
#creating new columns in the cmj dataset that are binary indicators of the different injury focuses
s['LB'] <- ifelse(s$anon_id %in% lb_injury_S, 'Yes', 'No')
s['ACL'] <- ifelse(s$anon_id %in% acl_injury_S, 'Yes', 'No')
s['HSI'] <- ifelse(s$anon_id %in% hsi_injury_S, 'Yes', 'No')
s['Sport'] <- 'Soccer'
```

```{r}
#creating new columns in the imtp dataset that are binary indicators of the different injury focuses
IMTP_S['LB'] <- ifelse(IMTP_S$anon_id %in% lb_injury_S, 'Yes', 'No')
IMTP_S['ACL'] <- ifelse(IMTP_S$anon_id %in% acl_injury_S, 'Yes', 'No')
IMTP_S['HSI'] <- ifelse(IMTP_S$anon_id %in% hsi_injury_S, 'Yes', 'No')
IMTP_S['Sport'] <- 'Soccer'
```

```{r}
#creating new columns in the hj dataset that are binary indicators of the different injury focuses
HJ_S['LB'] <- ifelse(HJ_S$anon_id %in% lb_injury_S, 'Yes', 'No')
HJ_S['ACL'] <- ifelse(HJ_S$anon_id %in% acl_injury_S, 'Yes', 'No')
HJ_S['HSI'] <- ifelse(HJ_S$anon_id %in% hsi_injury_S, 'Yes', 'No')
HJ_S['Ankle'] <- ifelse(HJ_S$anon_id %in% ankle_injury_S, 'Yes', 'No')
```

```{r}
#creating a boxplot displaying distribution of relative maximum bilateral mean in those who experienced lower body injury vs those that did not
ggplot(data = HJ_S, aes(x = Mean.Contact.Time..ms., fill = Ankle)) + 
  geom_density(alpha = 0.5) + 
  scale_fill_manual(values = c('#CFB87C', 'black')) + 
  labs(title = 'Distribution of Mean Contact Time vs Ankle Injury (All Time)',
       y = 'Density',
       x = 'Mean Contact Time (ms)',
       fill = 'Ankle Injury',
       caption = 'CU Womens Soccer') +
  scale_x_continuous(breaks = seq(from = 0, to = 7, by = 0.05)) + 
  theme_bw()
```

### 3. Lacrosse 

```{r}
#creating lists of athletes that suffered any lower body injuries, acl injury, HSI
lb_injury_L <- incident_L %>%
  filter(LB.Injury == 1) %>%
  distinct(anon_id) %>%
  pull(anon_id)
acl_injury_L <- incident_L %>%
  filter(ACL == 1) %>%
  distinct(anon_id) %>%
  pull(anon_id)
hsi_injury_L <- incident_L %>%
  filter(HSI == 1) %>%
  distinct(anon_id) %>%
  pull(anon_id)
ankle_injury_L <- incident_L %>%
  filter(Body.Part. == 'Ankle') %>%
  distinct(anon_id) %>%
  pull(anon_id)
```

```{r}
#creating new columns in the nordic performance dataset that are binary indicators of the different injury focuses
performance_L_nordic['LB'] <- ifelse(performance_L_nordic$anon_id %in% lb_injury_L, 'Yes', 'No')
performance_L_nordic['ACL'] <- ifelse(performance_L_nordic$anon_id %in% acl_injury_L, 'Yes', 'No')
performance_L_nordic['HSI'] <- ifelse(performance_L_nordic$anon_id %in% hsi_injury_L, 'Yes', 'No')
```

```{r}
#creating a boxplot displaying distribution of relative maximum bilateral mean in those who experienced lower body injury vs those that did not
ggplot(performance_L_nordic, aes(x = Relative.Maximum.Nordic.Bilateral.Mean, y = LB)) + 
  geom_boxplot(fill = '#CFB87C', color = 'black') + 
  labs(title = 'Distribution of Maximum Relative Bilateral Force vs Lower Body Injury',
       y = 'Was the Player Injured',
       x = 'Maximum Relative Bilateral Force (N / kg)') +
  theme_bw()
```

```{r}
#creating new columns in the cmj dataset that are binary indicators of the different injury focuses
l['LB'] <- ifelse(l$anon_id %in% lb_injury_L, 'Yes', 'No')
l['ACL'] <- ifelse(l$anon_id %in% acl_injury_L, 'Yes', 'No')
l['HSI'] <- ifelse(l$anon_id %in% hsi_injury_L, 'Yes', 'No')
l['Sport'] <- 'Lacrosse'
```

```{r}
#creating new columns in the imtp dataset that are binary indicators of the different injury focuses
IMTP_L['LB'] <- ifelse(IMTP_L$anon_id %in% lb_injury_L, 'Yes', 'No')
IMTP_L['ACL'] <- ifelse(IMTP_L$anon_id %in% acl_injury_L, 'Yes', 'No')
IMTP_L['HSI'] <- ifelse(IMTP_L$anon_id %in% hsi_injury_L, 'Yes', 'No')
IMTP_L['Sport'] <- 'Lacrosse'
```

```{r}
#creating new columns in the hj dataset that are binary indicators of the different injury focuses
HJ_L['LB'] <- ifelse(HJ_L$anon_id %in% lb_injury_L, 'Yes', 'No')
HJ_L['ACL'] <- ifelse(HJ_L$anon_id %in% acl_injury_L, 'Yes', 'No')
HJ_L['HSI'] <- ifelse(HJ_L$anon_id %in% hsi_injury_L, 'Yes', 'No')
HJ_L['Ankle'] <- ifelse(HJ_L$anon_id %in% ankle_injury_L, 'Yes', 'No')
```

```{r}
#creating a boxplot displaying distribution of relative maximum bilateral mean in those who experienced lower body injury vs those that did not
ggplot(data = HJ_L, aes(x = Mean.Flight.Time..ms., fill = Ankle)) + 
  geom_density(alpha = 0.5) + 
  scale_fill_manual(values = c('#CFB87C', 'black')) + 
  labs(title = 'Distribution of Mean Flight Time vs Ankle Injury (All Time)',
       y = 'Density',
       x = 'Mean Flight Time (ms)',
       fill = 'Ankle Injury',
       caption = 'CU Womens Lacrosse') +
  scale_x_continuous(breaks = seq(from = 0, to = 7, by = 0.05)) + 
  theme_bw()
```

### 4. Volleyball 

```{r}
#creating lists of athletes that suffered any lower body injuries, acl injury, HSI
lb_injury_V <- incident_V %>%
  filter(LB.Injury == 1) %>%
  distinct(anon_id) %>%
  pull(anon_id)
acl_injury_V <- incident_V %>%
  filter(ACL == 1) %>%
  distinct(anon_id) %>%
  pull(anon_id)
hsi_injury_V <- incident_V %>%
  filter(HSI == 1) %>%
  distinct(anon_id) %>%
  pull(anon_id)
ankle_injury_V <- incident_V %>%
  filter(Body.Part. == 'Ankle') %>%
  distinct(anon_id) %>%
  pull(anon_id)
```

```{r}
#creating new columns in the nordic performance dataset that are binary indicators of the different injury focuses
performance_V_nordic['LB'] <- ifelse(performance_V_nordic$anon_id %in% lb_injury_V, 'Yes', 'No')
performance_V_nordic['ACL'] <- ifelse(performance_V_nordic$anon_id %in% acl_injury_V, 'Yes', 'No')
performance_V_nordic['HSI'] <- ifelse(performance_V_nordic$anon_id %in% hsi_injury_V, 'Yes', 'No')
```

```{r}
#creating a boxplot displaying distribution of relative maximum bilateral mean in those who experienced lower body injury vs those that did not
ggplot(performance_V_nordic, aes(x = Relative.Maximum.Nordic.Bilateral.Mean, y = LB)) + 
  geom_boxplot(fill = '#CFB87C', color = 'black') + 
  labs(title = 'Distribution of Maximum Relative Bilateral Force vs Lower Body Injury',
       y = 'Was the Player Injured',
       x = 'Maximum Relative Bilateral Force (N / kg)') +
  theme_bw()
```

```{r}
#creating new columns in the cmj dataset that are binary indicators of the different injury focuses
v['LB'] <- ifelse(v$anon_id %in% lb_injury_V, 'Yes', 'No')
v['ACL'] <- ifelse(v$anon_id %in% acl_injury_V, 'Yes', 'No')
v['HSI'] <- ifelse(v$anon_id %in% hsi_injury_V, 'Yes', 'No')
v['Sport'] <- 'Volleyball'
```

```{r}
#creating new columns in the imtp dataset that are binary indicators of the different injury focuses
IMTP_V['LB'] <- ifelse(IMTP_V$anon_id %in% lb_injury_V, 'Yes', 'No')
IMTP_V['ACL'] <- ifelse(IMTP_V$anon_id %in% acl_injury_V, 'Yes', 'No')
IMTP_V['HSI'] <- ifelse(IMTP_V$anon_id %in% hsi_injury_V, 'Yes', 'No')
IMTP_V['Sport'] <- 'Volleyball'
```

```{r}
#creating new columns in the hj dataset that are binary indicators of the different injury focuses
HJ_V['LB'] <- ifelse(HJ_V$anon_id %in% lb_injury_V, 'Yes', 'No')
HJ_V['ACL'] <- ifelse(HJ_V$anon_id %in% acl_injury_V, 'Yes', 'No')
HJ_V['HSI'] <- ifelse(HJ_V$anon_id %in% hsi_injury_V, 'Yes', 'No')
HJ_V['Ankle'] <- ifelse(HJ_V$anon_id %in% ankle_injury_V, 'Yes', 'No')
```

```{r}
#creating a boxplot displaying distribution of relative maximum bilateral mean in those who experienced lower body injury vs those that did not
ggplot(data = HJ_V, aes(x = Mean.Contact.Time..ms., fill = Ankle)) + 
  geom_density(alpha = 0.5) + 
  scale_fill_manual(values = c('#CFB87C', 'black')) + 
  labs(title = 'Distribution of Mean Contact Time vs Ankle Injury (All Time)',
       y = 'Density',
       x = 'Mean Contact Time (ms)',
       fill = 'Ankle Injury',
       caption = 'CU Womens Volleyball') +
  scale_x_continuous(breaks = seq(from = 0, to = 7, by = 0.2)) + 
  theme_bw()
```

### Joining Data

```{r}
#joining nordic data
perf_nordic <- rbind(performance_B_nordic, performance_S_nordic, performance_L_nordic, performance_V_nordic) %>%
  mutate(Thresh = ifelse(Relative.Maximum.Nordic.Bilateral.Mean >= 5, 'Yes', 'No'),
         Sport.2 = ifelse(Sport == 'Basketball' | Sport == 'Volleyball', 'Court', 'Field'))

#joining cmj data
nordbord_cmj <- rbind(b, s, l, v) %>%
  mutate(Sport.2 = ifelse(Sport == 'Basketball' | Sport == 'Volleyball', 'Court', 'Field'))

#joining hj data
nordbord_hj <- rbind(HJ_B, HJ_S, HJ_L, HJ_V) %>%
  mutate(Sport.2 = ifelse(Sport == 'Basketball' | Sport == 'Volleyball', 'Court', 'Field'))

#joining imtp data
nordbord_imtp <- rbind(IMTP_B, IMTP_S, IMTP_L, IMTP_V) %>%
  mutate(Sport.2 = ifelse(Sport == 'Basketball' | Sport == 'Volleyball', 'Court', 'Field'))
```

```{r}
ggplot(data = perf_nordic, aes(x = Impulse, fill = LB)) + 
  geom_density(alpha = 0.5) + 
  scale_fill_manual(values = c('#CFB87C', 'black')) + 
  labs(title = 'Distribution of Landing Net Peak Force vs Lower Body Injury (All Time)',
       y = 'Density',
       x = 'Landing Net Peak Force (N/kg)',
       fill = 'Lower Body Injury') +
  theme_bw()
```

```{r}
library(MASS)

perf_nordic2 <- perf_nordic %>%
  mutate(LB = ifelse(LB == 'Yes', 1, 0)) %>%
  dplyr::select(-c(anon_id, Date, Side, Repetitions, Sport, ACL, HSI, Sport.2, Position))

model_null_smote <- glm(LB ~ 1, data = perf_nordic2, family = 'binomial')
model_step_smote <- glm(LB ~ ., data = perf_nordic2, family = 'binomial')

model_forward_step <- stepAIC(model_null_smote, 
                              scope = list(lower = model_null_smote, upper = model_step_smote), direction = "forward")

summary(model_forward_step)
```

When creating a forward stepwise model the model selects Nordic.MAX.Imbalance, trend, nordic right mean and max, athlete bodyweight and impulse. 

```{r}
ggplot(data = nordbord_hj, aes(x = HJ.RSI, fill = Ankle)) + 
  geom_density(alpha = 0.5) + 
  scale_fill_manual(values = c('#CFB87C', 'black')) + 
  labs(title = 'Distribution of Hop Jump RSI vs Ankle Injury (All Time)',
       y = 'Density',
       x = 'Hop Jump RSI',
       fill = 'Ankle Injury') + 
# facet_wrap(~Sport.2) +
  scale_x_continuous(breaks = seq(0, 7, 0.2)) + 
  theme_bw()
```


## In Relation to Injury Timelines


Looking 6 months in the past may be way too long need to figure out what window works best depending on which injuries. Also want to discuss if want to group by player and group and condense observations or just leave observations as is. 

### 1. Basketball

```{r}
#selects variables of interest, filters for lower body injuries, and gets rid of duplicate observations
incid_b <- Incident_B %>%
  filter(Body.Part %in% lower_body) %>%
  dplyr::select("anon_id", "Position", "Date.of.Injury...Onset.of.symptoms", "Side", "Body.Part", "Tissue.Type", "Pathology.Type", "OSICS14.Code", "OSICS10.Code", "OSICS10.Diagnosis", "Final.Diagnosis", "Result.of.Sport.Participation", "Recurrence.of.Injury", "Injury.Prognosis", "General.Mechanism", "Specific.Mechanism", "FinalDiagnosisIncidentDate", "Total.Time.Injured", "Season.", "End.Date", "Start.of.Status") %>%
  mutate(Start.of.Status = as.Date(Start.of.Status, format = '%m/%d/%Y'),
         End.Date = as.Date(End.Date, format = '%m/%d/%Y'),
         Time = as.numeric(End.Date - Start.of.Status)) %>%
  group_by(anon_id, Date.of.Injury...Onset.of.symptoms) %>%
  mutate(Total.Time.Injured = sum(Total.Time.Injured, na.rm = TRUE),
         Total.Time = sum(Time, na.rm = TRUE),
         Season. = ifelse(Season. == 'Pre-Season' | Season. == 'Summer Workouts' | Season. == 'Post-Season', 'Off-Season', Season.),
         Date = as.Date(Date.of.Injury...Onset.of.symptoms, format = '%m/%d/%Y')) %>%
  ungroup() %>%
  dplyr::select(-c('End.Date', 'Start.of.Status', 'Time')) %>%
  group_by(across(everything())) %>%
  summarise(.groups = 'drop')
```

```{r, warning = FALSE}
#creates a dataset from the incident report that separates out all the dates for lower body injuries to classify observations based on their relation to lower body injuries: within 3 months prior to first injury, between first and second injury, ect.
last_injury_B <- incid_b %>%
  arrange(Date) %>%
  group_by(anon_id) %>%
  summarize(Dates.Final = paste0(Date, collapse = " and "),
            Mechanism = paste0(General.Mechanism, collapse = " and "),
            Injury = paste0(Final.Diagnosis, collapse = " and "),
            Area = paste0(Body.Part, collapse = " and "),
            Time.Injured = paste0(Total.Time.Injured, collapse = " and ")) %>%
  separate(Dates.Final, c('Injury.1', 'Injury.2', 'Injury.3', 'Injury.4'), sep = ' and ') %>%
  mutate(Injury.1.Start = as.Date(Injury.1) - months(3),
         Injury.2.Start = ifelse(is.na(Injury.2), NA, Injury.1),
         Injury.3.Start = ifelse(is.na(Injury.3), NA, Injury.2),
         Injury.4.Start = ifelse(is.na(Injury.4), NA, Injury.3)) %>%
  separate(Mechanism, c('Injury.1.Mech', 'Injury.2.Mech', 'Injury.3.Mech', 'Injury.4.Mech'), sep = ' and ') %>%
  separate(Injury, c('Injury.1.Diagnosis', 'Injury.2.Diagnosis', 'Injury.3.Diagnosis', 'Injury.4.Diagnosis'), sep = ' and ') %>%
  separate(Time.Injured, c('Injury.1.Time', 'Injury.2.Time', 'Injury.3.Time', 'Injury.4.Time'), sep = ' and ') %>%
  separate(Area, c('Injury.1.Area', 'Injury.2.Area', 'Injury.3.Area', 'Injury.4.Area'), sep = ' and ')
```

#### Performance Data

**Nordic Data**

```{r}
#merges the last_injury_B to the performance_B_nordic by anon_id
merge_performance_B <- merge(last_injury_B, performance_B_nordic, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_performance_B <- merge_performance_B %>%
  mutate(Trend = ifelse(Trend == 'Neutral', 0, ifelse(Trend == 'Up', 1, -1)),
         Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_performance_B <- merge_performance_B %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Athlete.Bodyweight..kg., Maximum.Force, Average.Force, Impulse, Nordic.Left.MEAN, Nordic.Right.MEAN, Nordic.MEAN.Imbalance, Nordic.Left.MAX, Nordic.Right.MAX, Nordic.MAX.Imbalance, Trend, Nordic...Difference.from.First.Test, Maximum.Nordic.Bilateral.Mean, Relative.Maximum.Nordic.Bilateral.Mean, Position, Sport, Injury, Area, Was.Injured, Force.Diff.Norm, Imbalance.Diff.Norm)
```

```{r}
#creates a boxplot of maximum relative bilateral force across the basketball players
ggplot(merge_performance_B, aes(x = Relative.Maximum.Nordic.Bilateral.Mean, y = Was.Injured)) +
  geom_boxplot(fill = '#CFB87C', color = 'black') + 
  labs(title = 'Distribution of Maximum Relative Bilateral Force Across Basketball Players',
       y = 'Was the Player Injured',
       x = 'Maximum Relative Bilateral Force (N / kg)') +
  theme_bw()
```

```{r}
id_2 <- merge_performance_B %>%
  filter(anon_id == 'ID_2') %>%
  arrange(Date)

ggplot(id_2, aes(x = Date, y = Relative.Maximum.Nordic.Bilateral.Mean)) + 
  geom_line() + 
  geom_vline(xintercept = as.Date('2025-01-24'), color = 'red') + 
  scale_x_date(limits = as.Date(c('2023-10-01', '2025-01-31')),
               date_breaks = '3 months') +
  labs(title = 'Player ID_2 Relative Strength Trend Before Ankle Sprain',
       x = 'Date',
       y = 'Relative Maximum Nordic Bilateral Mean (N / kg)') + 
  theme_bw()
```

```{r}
id_46 <- merge_performance_B %>%
  filter(anon_id == 'ID_46') %>%
  arrange(Date)

ggplot(id_46, aes(x = Date, y = Relative.Maximum.Nordic.Bilateral.Mean)) + 
  geom_point() + 
  geom_line() +
  geom_vline(xintercept = as.Date(c('2024-12-05', '2025-01-07')), color = 'red') + 
  scale_x_date(limits = as.Date(c('2024-07-01', '2025-01-31')),
               date_breaks = '3 months') +
  labs(title = 'Player ID_46 Relative Strength Trend Before Ankle Sprain',
       x = 'Date',
       y = 'Relative Maximum Nordic Bilateral Mean (N / kg)') + 
  theme_bw()
```

In the Womens basketball dataset there is no performance data in the time prior to the only athlete to suffer an ACL rupture.

**Hip Data**

```{r}
#merges the last_injury_B to the performance_B_nordic by anon_id
merge_hip_B <- merge(last_injury_B, performance_B_hip, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_hip_B <- merge_hip_B %>%
  mutate(Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_hip_B <- merge_hip_B %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Athlete.Bodyweight..kg., Maximum.Force, Average.Force, Impulse, Hip.Abd.Left.MEAN, Hip.Abd.Right.MEAN, Hip.Abduction.MEAN.Imbalance, Hip.Abd.Left.MAX, Hip.Abd.Right.MAX, Hip.Abduction.MAX.Imbalance, Hip.Add.Left.MEAN, Hip.Add.Right.MEAN, Hip.Adduction.MEAN.Imbalance, Hip.Add.Left.MAX, Hip.Add.Right.MAX, Hip.Adduction.MAX.Imbalance, Bilateral.Hip.Abduction.Adduction.Ratio, Position, Sport, Injury, Area, Was.Injured)
```

```{r}
#creates a boxplot of maximum hip force across the basketball players
ggplot(merge_hip_B, aes(x = Hip.Abd.Left.MAX, y = Was.Injured)) +
  geom_boxplot(fill = '#CFB87C', color = 'black') + 
  labs(title = 'Distribution of Maximum Force vs Lower Body Injury',
       y = 'Was the Player Injured',
       x = 'Maximum Force (N)',
       caption = 'Womens Basketball') +
  theme_bw()
```

Appears to be small associations in hip strength and injury status in 1 month window

#### Nordbord Data

**CMJ Data**

```{r}
#merges the last_injury_B to the HJ_B by anon_id
merge_cmj_B <- merge(last_injury_B, b, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_cmj_B <- merge_cmj_B %>%
  mutate(Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_cmj_B <- merge_cmj_B %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Countermovement.Depth..cm., Peak.Power...BM..W.kg., Landing.RFD..N.s., Eccentric.Concentric.Mean.Force.Ratio, Peak.Landing.Force..Asym...N., Peak.Power..W., Concentric.RFD..N.s., Eccentric.Mean.Braking.Force..N., Concentric.Time.to.Peak.Force..s., Landing.Net.Peak.Force...BM..N.kg., Peak.Net.Takeoff.Force...BM..N.kg., Concentric.RPD...BM..W.s.kg., Force.at.Peak.Power..N., Eccentric.Mean.Deceleration.Force..N., Eccentric.Peak.Force..N., RSI.Modified..m.s., CMJ.Stiffness..Left...N.m., CMJ.Stiffness..Right...N.m., Eccentric.Asymmetry, Concentric.Asymmetry, Peak.Landing.Asymmetry, Injury, Area, Was.Injured, Sport, DSI, DSI.Bucket)
```

```{r}
#creates a boxplot of maximum relative bilateral force across the basketball players
ggplot(merge_cmj_B, aes(x = DSI, fill = Was.Injured)) +
  geom_density(alpha = 0.5) + 
  scale_fill_manual(values = c('#CFB87C', '#000000')) +
  labs(title = 'Eccentric to Concentric Mean Force Ratio vs Injury',
       x = 'Eccentric to Concentric Mean Force Ration',
       y = 'Density') + 
  theme_bw()
```

```{r}
table(merge_cmj_B$DSI.Bucket, merge_cmj_B$Was.Injured)
```

```{r}
id_2_cmj <- merge_cmj_B %>%
  filter(anon_id == 'ID_2') %>%
  arrange(Date)

ggplot(id_2_cmj, aes(x = Date, y = Force.at.Peak.Power..N.)) + 
  geom_line() + 
  geom_vline(xintercept = as.Date('2025-01-24'), color = 'red') + 
  scale_x_date(limits = as.Date(c('2023-09-01', '2025-01-31')),
               date_breaks = '3 months') +
  labs(title = 'Player ID_2 Force at Peak Power Trend Before Ankle Sprain',
       x = 'Date',
       y = 'Force at Peak Power (N)') + 
  theme_bw()
```

```{r}
id_46_cmj <- merge_cmj_B %>%
  filter(anon_id == 'ID_46') %>%
  arrange(Date)

ggplot(id_46_cmj, aes(x = Date, y = Force.at.Peak.Power..N.)) + 
  geom_line() +
  geom_vline(xintercept = as.Date(c('2024-12-05', '2025-01-07')), color = 'red') + 
  scale_x_date(limits = as.Date(c('2024-07-01', '2025-01-31')),
               date_breaks = '3 months') +
  labs(title = 'Player ID_46 Force at Peak Power Trend Before Ankle Sprain',
       x = 'Date',
       y = 'Force at Peak Power (N)') + 
  theme_bw()
```

**HJ Data**

```{r}
#merges the last_injury_B to the HJ_B by anon_id
merge_hj_B <- merge(last_injury_B, HJ_B, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_hj_B <- merge_hj_B %>%
  mutate(Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_hj_B <- merge_hj_B %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Corrected.Standing.Weight..Kg., Mean.RSI..Flight.Contact.Time., Active.Stiffness..N.m., Best.Average.Force..N., Best.Average.Force..Asym...N., Best.Time.to.Peak.Force..ms., Best.Contact.Time..ms., Best.Flight.Time..ms., Best.Impulse..N.s., Best.Peak.Force..N., Best.Peak.Force..Asym...N., Mean.Average.Force..N., Mean.Average.Force..Asym...N., Mean.Landing.RFD..N.s., Mean.Landing.RFD..Asym...N.s., Stiffness.Fatigue...., Stiffness.Fatigue..Asym....., Max.Jump.Height..cm., Injury, Area, Was.Injured, Sport, HJ.RSI, Mean.Flight.Time..ms., Mean.Contact.Time..ms.)
```

Need to check code, only finding 4 observations in the 3 months prior to an injury and only one player. Of the 17 unique players who suffered lower body injury in basketball players only 8 are represented in the HJ dataset. All injuries with exception of ID_40 occur at least 265 days after the observation; not very helpful.  

**IMTP Data**

```{r}
#merges the last_injury_B to the HJ_B by anon_id
merge_imtp_B <- merge(last_injury_B, IMTP_B, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_imtp_B <- merge_imtp_B %>%
  mutate(Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_imtp_B <- merge_imtp_B %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Baseline.Force..N., Baseline.Force..Asym...N., Peak.Vertical.Force..N., Peak.Vertical.Force...BM..N.kg., Peak.Vertical.Force..Asym...N., RFD...50ms..N.s., RFD...50ms..Asym...N.s., RFD...100ms..N.s., RFD...100ms..Asym...N.s., RFD...150ms..N.s., RFD...150ms..Asym...N.s., RFD...200ms..N.s., RFD...200ms..Asym...N.s., Net.Peak.Vertical.Force..N.s., Net.Peak.Vertical.Force..Asym...N.s., Force.at.200ms...BM..N.kg., Absolute.Impulse.50ms..Ns., Absolute.Impulse.50ms..Asym...Ns., Absolute.Impulse.100ms..Ns., Absolute.Impulse.100ms..Asym...Ns., Absolute.Impulse.150ms..Ns., Absolute.Impulse.150ms..Asym...Ns., Absolute.Impulse.200ms..Ns., Absolute.Impulse.200ms..Asym...Ns., Injury, Area, Was.Injured, Sport)
```

Of the 17 unique players to suffer lower body injury, only 7 are represented in IMTP data. All observations occur at least 99 days prior to injury with only 11 within 180 days.  

**General Forcedeck Information**

```{r}
#merges the last_injury_B to the HJ_B by anon_id
merge_forcedeck_B <- merge(last_injury_B, forcedecks_b, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_forcedeck_B <- merge_forcedeck_B %>%
  mutate(Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_forcedeck_B <- merge_forcedeck_B %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3, 'Yes', Group))
```

Need to check code, only finding 4 observations in the 3 months prior to an injury and only one player. Of the 17 unique players who suffered lower body injury in basketball players only 8 are represented in the HJ dataset. All injuries with exception of ID_40 occur at least 265 days after the observation; not very helpful.  

```{r}
#creates a boxplot of maximum relative bilateral force across the basketball players
ggplot(merge_forcedeck_B, aes(x = MEAN.Peak.Landing.Force.Left, y = Was.Injured)) +
  geom_boxplot(fill = '#CFB87C', color = 'black') + 
  labs(title = 'Distribution of Maximum Relative Bilateral Force Across Basketball Players',
       y = 'Was the Player Injured',
       x = 'Maximum Relative Bilateral Force (N / kg)') +
  theme_bw()
```

### 2. Soccer

```{r}
#selects variables of interest, filters for lower body injuries, and gets rid of duplicate observations
incid_s <- Incident_S %>%
  filter(Body.Part %in% lower_body) %>%
  dplyr::select("anon_id", "Position", "Date.of.Injury...Onset.of.symptoms", "Side", "Body.Part", "Tissue.Type", "Pathology.Type", "OSICS14.Code", "OSICS10.Code", "OSICS10.Diagnosis", "Final.Diagnosis", "Result.of.Sport.Participation", "Recurrence.of.Injury", "Injury.Prognosis", "General.Mechanism", "Specific.Mechanism", "FinalDiagnosisIncidentDate", "Total.Time.Injured", "Season.") %>%
  group_by(anon_id, Date.of.Injury...Onset.of.symptoms) %>%
  mutate(Total.Time.Injured = sum(Total.Time.Injured, na.rm = TRUE),
         Date = as.Date(Date.of.Injury...Onset.of.symptoms, format = '%m/%d/%Y'),
         Season. = ifelse(Season. == 'Pre-Season' | Season. == 'Summer Workouts' | Season. == 'Post-Season', 'Off-Season', Season.)) %>%
  ungroup() %>%
  group_by(across(everything())) %>%
  summarise(.groups = 'drop')

#get rid of duplicate observation with very small diagnosis differences
incid_s <- incid_s[-3,]
```

```{r, warning = FALSE}
#creates a dataset from the incident report that separates out all the dates for lower body injuries to classify observations based on their relation to lower body injuries: within 3 months prior to first injury, between first and second injury, ect.
last_injury_S <- incid_s %>%
  arrange(Date) %>%
  group_by(anon_id) %>%
  summarize(Dates.Final = paste0(Date, collapse = " and "),
            Mechanism = paste0(General.Mechanism, collapse = " and "),
            Injury = paste0(Final.Diagnosis, collapse = " and "),
            Area = paste0(Body.Part, collapse = " and "),
            Time.Injured = paste0(Total.Time.Injured, collapse = " and ")) %>%
  separate(Dates.Final, c('Injury.1', 'Injury.2', 'Injury.3', 'Injury.4', 'Injury.5', 'Injury.6', 'Injury.7'), sep = ' and ') %>%
  mutate(Injury.1.Start = as.Date(Injury.1) - months(3),
         Injury.2.Start = ifelse(is.na(Injury.2), NA, Injury.1),
         Injury.3.Start = ifelse(is.na(Injury.3), NA, Injury.2),
         Injury.4.Start = ifelse(is.na(Injury.4), NA, Injury.3),
         Injury.5.Start = ifelse(is.na(Injury.4), NA, Injury.4),
         Injury.6.Start = ifelse(is.na(Injury.4), NA, Injury.5),
         Injury.7.Start = ifelse(is.na(Injury.4), NA, Injury.6)) %>%
  separate(Mechanism, c('Injury.1.Mech', 'Injury.2.Mech', 'Injury.3.Mech', 'Injury.4.Mech', 'Injury.5.Mech', 'Injury.6.Mech', 'Injury.7.Mech'), sep = ' and ') %>%
  separate(Injury, c('Injury.1.Diagnosis', 'Injury.2.Diagnosis', 'Injury.3.Diagnosis', 'Injury.4.Diagnosis', 'Injury.5.Diagnosis', 'Injury.6.Diagnosis', 'Injury.7.Diagnosis'), sep = ' and ') %>%
  separate(Time.Injured, c('Injury.1.Time', 'Injury.2.Time', 'Injury.3.Time', 'Injury.4.Time', 'Injury.5.Time', 'Injury.6.Time', 'Injury.7.Time'), sep = ' and ') %>%
  separate(Area, c('Injury.1.Area', 'Injury.2.Area', 'Injury.3.Area', 'Injury.4.Area', 'Injury.5.Area', 'Injury.6.Area', 'Injury.7.Area'), sep = ' and ')
```

#### Performance Data

**Nordic Data**

```{r}
#merges the last_injury_S to the performance_S_nordic by anon_id
merge_performance_S <- merge(last_injury_S, performance_S_nordic, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_performance_S <- merge_performance_S %>%
  mutate(Trend = ifelse(Trend == 'Neutral', 0, ifelse(Trend == 'Up', 1, -1)),
         Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    !is.na(Injury.5) & Date >= Injury.5.Start & Date <= Injury.5 ~ '5',
    !is.na(Injury.6) & Date >= Injury.6.Start & Date <= Injury.6 ~ '6',
    !is.na(Injury.7) & Date >= Injury.7.Start & Date <= Injury.7 ~ '7',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_performance_S <- merge_performance_S %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    Group == 5 ~ Injury.5.Diagnosis,
    Group == 6 ~ Injury.6.Diagnosis,
    Group == 7 ~ Injury.7.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    Group == 5 ~ Injury.5.Area,
    Group == 6 ~ Injury.6.Area,
    Group == 7 ~ Injury.7.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3 | Group == 4 | Group == 5 | Group == 6 | Group == 7, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Athlete.Bodyweight..kg., Maximum.Force, Average.Force, Impulse, Nordic.Left.MEAN, Nordic.Right.MEAN, Nordic.MEAN.Imbalance, Nordic.Left.MAX, Nordic.Right.MAX, Nordic.MAX.Imbalance, Trend, Nordic...Difference.from.First.Test, Maximum.Nordic.Bilateral.Mean, Relative.Maximum.Nordic.Bilateral.Mean, Position, Sport, Injury, Area, Was.Injured, Force.Diff.Norm, Imbalance.Diff.Norm)
```

```{r}
#creates a boxplot of maximum relative bilateral force across the soccer players
ggplot(merge_performance_S, aes(x = Maximum.Nordic.Bilateral.Mean, y = Was.Injured)) +
  geom_boxplot(fill = '#CFB87C', color = 'black') + 
  labs(title = 'Distribution of Maximum Relative Bilateral Force Across Soccer Players',
       y = 'Was the Player Injured',
       x = 'Maximum Relative Bilateral Force (N / kg)') +
  theme_bw()
```

It appears from this graph that soccer athletes that were either didn't suffer a lower body injury or at a time before 6 months prior to an injury were, on average, weaker in terms of relative bilateral force in comparison to those who did have a lower body injury occur. 

**Hip Data**

```{r}
#merges the last_injury_S to the performance_S_nordic by anon_id
merge_hip_S <- merge(last_injury_S, performance_S_hip, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_hip_S <- merge_hip_S %>%
  mutate(Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    !is.na(Injury.5) & Date >= Injury.5.Start & Date <= Injury.5 ~ '5',
    !is.na(Injury.6) & Date >= Injury.6.Start & Date <= Injury.6 ~ '6',
    !is.na(Injury.7) & Date >= Injury.7.Start & Date <= Injury.7 ~ '7',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_hip_S <- merge_hip_S %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    Group == 5 ~ Injury.5.Diagnosis,
    Group == 6 ~ Injury.6.Diagnosis,
    Group == 7 ~ Injury.7.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    Group == 5 ~ Injury.5.Area,
    Group == 6 ~ Injury.6.Area,
    Group == 7 ~ Injury.7.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3 | Group == 4 | Group == 5 | Group == 6 | Group == 7, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Athlete.Bodyweight..kg., Maximum.Force, Average.Force, Impulse, Hip.Abd.Left.MEAN, Hip.Abd.Right.MEAN, Hip.Abduction.MEAN.Imbalance, Hip.Abd.Left.MAX, Hip.Abd.Right.MAX, Hip.Abduction.MAX.Imbalance, Hip.Add.Left.MEAN, Hip.Add.Right.MEAN, Hip.Adduction.MEAN.Imbalance, Hip.Add.Left.MAX, Hip.Add.Right.MAX, Hip.Adduction.MAX.Imbalance, Bilateral.Hip.Abduction.Adduction.Ratio, Position, Sport, Injury, Area, Was.Injured)
```

#### Nordbord Data

**CMJ Data**

```{r}
#merges the last_injury_B to the HJ_B by anon_id
merge_cmj_S <- merge(last_injury_S, s, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_cmj_S <- merge_cmj_S %>%
  mutate(Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    !is.na(Injury.5) & Date >= Injury.5.Start & Date <= Injury.5 ~ '5',
    !is.na(Injury.6) & Date >= Injury.6.Start & Date <= Injury.6 ~ '6',
    !is.na(Injury.7) & Date >= Injury.7.Start & Date <= Injury.7 ~ '7',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_cmj_S <- merge_cmj_S %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    Group == 5 ~ Injury.5.Diagnosis,
    Group == 6 ~ Injury.6.Diagnosis,
    Group == 7 ~ Injury.7.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    Group == 5 ~ Injury.5.Area,
    Group == 6 ~ Injury.6.Area,
    Group == 7 ~ Injury.7.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3 | Group == 4 | Group == 5 | Group == 6 | Group == 7, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Countermovement.Depth..cm., Peak.Power...BM..W.kg., Landing.RFD..N.s., Eccentric.Concentric.Mean.Force.Ratio, Peak.Landing.Force..Asym...N., Peak.Power..W., Concentric.RFD..N.s., Eccentric.Mean.Braking.Force..N., Concentric.Time.to.Peak.Force..s., Landing.Net.Peak.Force...BM..N.kg., Peak.Net.Takeoff.Force...BM..N.kg., Concentric.RPD...BM..W.s.kg., Force.at.Peak.Power..N., Eccentric.Mean.Deceleration.Force..N., Eccentric.Peak.Force..N., RSI.Modified..m.s., CMJ.Stiffness..Left...N.m., CMJ.Stiffness..Right...N.m., Eccentric.Asymmetry, Concentric.Asymmetry, Peak.Landing.Asymmetry, Injury, Area, Was.Injured, Sport, DSI, DSI.Bucket)
```

**HJ Data**

```{r}
#merges the last_injury_B to the HJ_B by anon_id
merge_hj_S <- merge(last_injury_S, HJ_S, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_hj_S <- merge_hj_S %>%
  mutate(Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    !is.na(Injury.5) & Date >= Injury.5.Start & Date <= Injury.5 ~ '5',
    !is.na(Injury.6) & Date >= Injury.6.Start & Date <= Injury.6 ~ '6',
    !is.na(Injury.7) & Date >= Injury.7.Start & Date <= Injury.7 ~ '7',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_hj_S <- merge_hj_S %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    Group == 5 ~ Injury.5.Diagnosis,
    Group == 6 ~ Injury.6.Diagnosis,
    Group == 7 ~ Injury.7.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    Group == 5 ~ Injury.5.Area,
    Group == 6 ~ Injury.6.Area,
    Group == 7 ~ Injury.7.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3 | Group == 4 | Group == 5 | Group == 6 | Group == 7, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Corrected.Standing.Weight..Kg., Mean.RSI..Flight.Contact.Time., Active.Stiffness..N.m., Best.Average.Force..N., Best.Average.Force..Asym...N., Best.Time.to.Peak.Force..ms., Best.Contact.Time..ms., Best.Flight.Time..ms., Best.Impulse..N.s., Best.Peak.Force..N., Best.Peak.Force..Asym...N., Mean.Average.Force..N., Mean.Average.Force..Asym...N., Mean.Landing.RFD..N.s., Mean.Landing.RFD..Asym...N.s., Stiffness.Fatigue...., Stiffness.Fatigue..Asym....., Max.Jump.Height..cm., Injury, Area, Was.Injured, Sport, HJ.RSI, Mean.Flight.Time..ms., Mean.Contact.Time..ms.)
```

```{r}
#creates a boxplot of maximum relative bilateral force across the basketball players
ggplot(merge_hj_S, aes(x = Best.Contact.Time..ms., fill = Was.Injured)) +
  geom_density(alpha = 0.5) + 
  scale_fill_manual(values = c('#CFB87C', '#000000')) +
  labs(title = 'Best Contact Time vs Injury',
       x = 'Best Contact Time (ms)',
       y = 'Density',
       caption = 'Womens Soccer') + 
  theme_bw()
```

```{r}
t.test(Best.Contact.Time..ms. ~ Was.Injured, data = merge_hj_S, alternative = 'greater')
```

**IMTP Data**

```{r}
#merges the last_injury_B to the HJ_B by anon_id
merge_imtp_S <- merge(last_injury_S, IMTP_S, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_imtp_S <- merge_imtp_S %>%
  mutate(Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    !is.na(Injury.5) & Date >= Injury.5.Start & Date <= Injury.5 ~ '5',
    !is.na(Injury.6) & Date >= Injury.6.Start & Date <= Injury.6 ~ '6',
    !is.na(Injury.7) & Date >= Injury.7.Start & Date <= Injury.7 ~ '7',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_imtp_S <- merge_imtp_S %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    Group == 5 ~ Injury.5.Diagnosis,
    Group == 6 ~ Injury.6.Diagnosis,
    Group == 7 ~ Injury.7.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    Group == 5 ~ Injury.5.Area,
    Group == 6 ~ Injury.6.Area,
    Group == 7 ~ Injury.7.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3 | Group == 4 | Group == 5 | Group == 6 | Group == 7, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Baseline.Force..N., Baseline.Force..Asym...N., Peak.Vertical.Force..N., Peak.Vertical.Force...BM..N.kg., Peak.Vertical.Force..Asym...N., RFD...50ms..N.s., RFD...50ms..Asym...N.s., RFD...100ms..N.s., RFD...100ms..Asym...N.s., RFD...150ms..N.s., RFD...150ms..Asym...N.s., RFD...200ms..N.s., RFD...200ms..Asym...N.s., Net.Peak.Vertical.Force..N.s., Net.Peak.Vertical.Force..Asym...N.s., Force.at.200ms...BM..N.kg., Absolute.Impulse.50ms..Ns., Absolute.Impulse.50ms..Asym...Ns., Absolute.Impulse.100ms..Ns., Absolute.Impulse.100ms..Asym...Ns., Absolute.Impulse.150ms..Ns., Absolute.Impulse.150ms..Asym...Ns., Absolute.Impulse.200ms..Ns., Absolute.Impulse.200ms..Asym...Ns., Injury, Area, Was.Injured, Sport)
```

### 3. Lacrosse

```{r}
#selects variables of interest, filters for lower body injuries, and gets rid of duplicate observations
incid_l <- Incident_L %>%
  filter(Body.Part %in% lower_body) %>%
  dplyr::select("anon_id", "Position", "Date.of.Injury...Onset.of.symptoms", "Side", "Body.Part", "Tissue.Type", "Pathology.Type", "OSICS14.Code", "OSICS10.Code", "OSICS10.Diagnosis", "Final.Diagnosis", "Result.of.Sport.Participation", "Recurrence.of.Injury", "Injury.Prognosis", "General.Mechanism", "Specific.Mechanism", "FinalDiagnosisIncidentDate", "Total.Time.Injured", "Season.") %>%
  group_by(anon_id, Date.of.Injury...Onset.of.symptoms) %>%
  mutate(Total.Time.Injured = sum(Total.Time.Injured, na.rm = TRUE),
         Date = as.Date(Date.of.Injury...Onset.of.symptoms, format = '%m/%d/%Y'),
         Season. = ifelse(Season. == 'Pre-Season' | Season. == 'Summer Workouts' | Season. == 'Post-Season', 'Off-Season', Season.)) %>%
  ungroup() %>%
  group_by(across(everything())) %>%
  summarise(.groups = 'drop')
```

```{r, warning = FALSE}
#creates a dataset from the incident report that separates out all the dates for lower body injuries to classify observations based on their relation to lower body injuries: within 3 months prior to first injury, between first and second injury, ect.
last_injury_L <- incid_l %>%
  arrange(Date) %>%
  group_by(anon_id) %>%
  summarize(Dates.Final = paste0(Date, collapse = " and "),
            Mechanism = paste0(General.Mechanism, collapse = " and "),
            Injury = paste0(Final.Diagnosis, collapse = " and "),
            Area = paste0(Body.Part, collapse = " and "),
            Time.Injured = paste0(Total.Time.Injured, collapse = " and ")) %>%
  separate(Dates.Final, c('Injury.1', 'Injury.2', 'Injury.3', 'Injury.4', 'Injury.5', 'Injury.6', 'Injury.7'), sep = ' and ') %>%
  mutate(Injury.1.Start = as.Date(Injury.1) - months(3),
         Injury.2.Start = ifelse(is.na(Injury.2), NA, Injury.1),
         Injury.3.Start = ifelse(is.na(Injury.3), NA, Injury.2),
         Injury.4.Start = ifelse(is.na(Injury.4), NA, Injury.3),
         Injury.5.Start = ifelse(is.na(Injury.4), NA, Injury.4),
         Injury.6.Start = ifelse(is.na(Injury.4), NA, Injury.5),
         Injury.7.Start = ifelse(is.na(Injury.4), NA, Injury.6)) %>%
  separate(Mechanism, c('Injury.1.Mech', 'Injury.2.Mech', 'Injury.3.Mech', 'Injury.4.Mech', 'Injury.5.Mech', 'Injury.6.Mech', 'Injury.7.Mech'), sep = ' and ') %>%
  separate(Injury, c('Injury.1.Diagnosis', 'Injury.2.Diagnosis', 'Injury.3.Diagnosis', 'Injury.4.Diagnosis', 'Injury.5.Diagnosis', 'Injury.6.Diagnosis', 'Injury.7.Diagnosis'), sep = ' and ') %>%
  separate(Time.Injured, c('Injury.1.Time', 'Injury.2.Time', 'Injury.3.Time', 'Injury.4.Time', 'Injury.5.Time', 'Injury.6.Time', 'Injury.7.Time'), sep = ' and ') %>%
  separate(Area, c('Injury.1.Area', 'Injury.2.Area', 'Injury.3.Area', 'Injury.4.Area', 'Injury.5.Area', 'Injury.6.Area', 'Injury.7.Area'), sep = ' and ')
```

#### Performance Data

**Nordic Data**

```{r}
#merges the last_injury_S to the performance_S_nordic by anon_id
merge_performance_L <- merge(last_injury_L, performance_L_nordic, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_performance_L <- merge_performance_L %>%
  mutate(Trend = ifelse(Trend == 'Neutral', 0, ifelse(Trend == 'Up', 1, -1)),
         Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    !is.na(Injury.5) & Date >= Injury.5.Start & Date <= Injury.5 ~ '5',
    !is.na(Injury.6) & Date >= Injury.6.Start & Date <= Injury.6 ~ '6',
    !is.na(Injury.7) & Date >= Injury.7.Start & Date <= Injury.7 ~ '7',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_performance_L <- merge_performance_L %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    Group == 5 ~ Injury.5.Diagnosis,
    Group == 6 ~ Injury.6.Diagnosis,
    Group == 7 ~ Injury.7.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    Group == 5 ~ Injury.5.Area,
    Group == 6 ~ Injury.6.Area,
    Group == 7 ~ Injury.7.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3 | Group == 4 | Group == 5 | Group == 6 | Group == 7, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Athlete.Bodyweight..kg., Maximum.Force, Average.Force, Impulse, Nordic.Left.MEAN, Nordic.Right.MEAN, Nordic.MEAN.Imbalance, Nordic.Left.MAX, Nordic.Right.MAX, Nordic.MAX.Imbalance, Trend, Nordic...Difference.from.First.Test, Maximum.Nordic.Bilateral.Mean, Relative.Maximum.Nordic.Bilateral.Mean, Position, Sport, Injury, Area, Was.Injured, Force.Diff.Norm, Imbalance.Diff.Norm)
```

```{r}
#creates a boxplot of maximum relative bilateral force across the soccer players
ggplot(merge_performance_L, aes(x = Relative.Maximum.Nordic.Bilateral.Mean, y = Was.Injured)) +
  geom_boxplot(fill = '#CFB87C', color = 'black') + 
  labs(title = 'Distribution of Maximum Relative Bilateral Force Across Lacrosse Players',
       y = 'Was the Player Injured',
       x = 'Maximum Relative Bilateral Force (N / kg)') +
  theme_bw()
```

**Hip Data**

```{r}
#merges the last_injury_L to the performance_L_nordic by anon_id
merge_hip_L <- merge(last_injury_L, performance_L_hip, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_hip_L <- merge_hip_L %>%
  mutate(Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    !is.na(Injury.5) & Date >= Injury.5.Start & Date <= Injury.5 ~ '5',
    !is.na(Injury.6) & Date >= Injury.6.Start & Date <= Injury.6 ~ '6',
    !is.na(Injury.7) & Date >= Injury.7.Start & Date <= Injury.7 ~ '7',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_hip_L <- merge_hip_L %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    Group == 5 ~ Injury.5.Diagnosis,
    Group == 6 ~ Injury.6.Diagnosis,
    Group == 7 ~ Injury.7.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    Group == 5 ~ Injury.5.Area,
    Group == 6 ~ Injury.6.Area,
    Group == 7 ~ Injury.7.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3 | Group == 4 | Group == 5 | Group == 6 | Group == 7, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Athlete.Bodyweight..kg., Maximum.Force, Average.Force, Impulse, Hip.Abd.Left.MEAN, Hip.Abd.Right.MEAN, Hip.Abduction.MEAN.Imbalance, Hip.Abd.Left.MAX, Hip.Abd.Right.MAX, Hip.Abduction.MAX.Imbalance, Hip.Add.Left.MEAN, Hip.Add.Right.MEAN, Hip.Adduction.MEAN.Imbalance, Hip.Add.Left.MAX, Hip.Add.Right.MAX, Hip.Adduction.MAX.Imbalance, Bilateral.Hip.Abduction.Adduction.Ratio, Position, Sport, Injury, Area, Was.Injured)
```

#### Nordbord Data

**CMJ Data**

```{r}
#merges the last_injury_B to the HJ_B by anon_id
merge_cmj_L <- merge(last_injury_L, l, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_cmj_L <- merge_cmj_L %>%
  mutate(Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    !is.na(Injury.5) & Date >= Injury.5.Start & Date <= Injury.5 ~ '5',
    !is.na(Injury.6) & Date >= Injury.6.Start & Date <= Injury.6 ~ '6',
    !is.na(Injury.7) & Date >= Injury.7.Start & Date <= Injury.7 ~ '7',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_cmj_L <- merge_cmj_L %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    Group == 5 ~ Injury.5.Diagnosis,
    Group == 6 ~ Injury.6.Diagnosis,
    Group == 7 ~ Injury.7.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    Group == 5 ~ Injury.5.Area,
    Group == 6 ~ Injury.6.Area,
    Group == 7 ~ Injury.7.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3 | Group == 4 | Group == 5 | Group == 6 | Group == 7, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Countermovement.Depth..cm., Peak.Power...BM..W.kg., Landing.RFD..N.s., Eccentric.Concentric.Mean.Force.Ratio, Peak.Landing.Force..Asym...N., Peak.Power..W., Concentric.RFD..N.s., Eccentric.Mean.Braking.Force..N., Concentric.Time.to.Peak.Force..s., Landing.Net.Peak.Force...BM..N.kg., Peak.Net.Takeoff.Force...BM..N.kg., Concentric.RPD...BM..W.s.kg., Force.at.Peak.Power..N., Eccentric.Mean.Deceleration.Force..N., Eccentric.Peak.Force..N., RSI.Modified..m.s., CMJ.Stiffness..Left...N.m., CMJ.Stiffness..Right...N.m., Eccentric.Asymmetry, Concentric.Asymmetry, Peak.Landing.Asymmetry, Injury, Area, Was.Injured, Sport, DSI, DSI.Bucket)
```

**HJ Data**

```{r}
#merges the last_injury_B to the HJ_B by anon_id
merge_hj_L <- merge(last_injury_L, HJ_L, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_hj_L <- merge_hj_L %>%
  mutate(Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    !is.na(Injury.5) & Date >= Injury.5.Start & Date <= Injury.5 ~ '5',
    !is.na(Injury.6) & Date >= Injury.6.Start & Date <= Injury.6 ~ '6',
    !is.na(Injury.7) & Date >= Injury.7.Start & Date <= Injury.7 ~ '7',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_hj_L <- merge_hj_L %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    Group == 5 ~ Injury.5.Diagnosis,
    Group == 6 ~ Injury.6.Diagnosis,
    Group == 7 ~ Injury.7.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    Group == 5 ~ Injury.5.Area,
    Group == 6 ~ Injury.6.Area,
    Group == 7 ~ Injury.7.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3 | Group == 4 | Group == 5 | Group == 6 | Group == 7, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Corrected.Standing.Weight..Kg., Mean.RSI..Flight.Contact.Time., Active.Stiffness..N.m., Best.Average.Force..N., Best.Average.Force..Asym...N., Best.Time.to.Peak.Force..ms., Best.Contact.Time..ms., Best.Flight.Time..ms., Best.Impulse..N.s., Best.Peak.Force..N., Best.Peak.Force..Asym...N., Mean.Average.Force..N., Mean.Average.Force..Asym...N., Mean.Landing.RFD..N.s., Mean.Landing.RFD..Asym...N.s., Stiffness.Fatigue...., Stiffness.Fatigue..Asym....., Max.Jump.Height..cm., Injury, Area, Was.Injured, Sport, HJ.RSI, Mean.Flight.Time..ms., Mean.Contact.Time..ms.)
```

**IMTP Data**

```{r}
#merges the last_injury_B to the HJ_B by anon_id
merge_imtp_L <- merge(last_injury_L, IMTP_L, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_imtp_L <- merge_imtp_L %>%
  mutate(Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    !is.na(Injury.5) & Date >= Injury.5.Start & Date <= Injury.5 ~ '5',
    !is.na(Injury.6) & Date >= Injury.6.Start & Date <= Injury.6 ~ '6',
    !is.na(Injury.7) & Date >= Injury.7.Start & Date <= Injury.7 ~ '7',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_imtp_L <- merge_imtp_L %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    Group == 5 ~ Injury.5.Diagnosis,
    Group == 6 ~ Injury.6.Diagnosis,
    Group == 7 ~ Injury.7.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    Group == 5 ~ Injury.5.Area,
    Group == 6 ~ Injury.6.Area,
    Group == 7 ~ Injury.7.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3 | Group == 4 | Group == 5 | Group == 6 | Group == 7, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Baseline.Force..N., Baseline.Force..Asym...N., Peak.Vertical.Force..N., Peak.Vertical.Force...BM..N.kg., Peak.Vertical.Force..Asym...N., RFD...50ms..N.s., RFD...50ms..Asym...N.s., RFD...100ms..N.s., RFD...100ms..Asym...N.s., RFD...150ms..N.s., RFD...150ms..Asym...N.s., RFD...200ms..N.s., RFD...200ms..Asym...N.s., Net.Peak.Vertical.Force..N.s., Net.Peak.Vertical.Force..Asym...N.s., Force.at.200ms...BM..N.kg., Absolute.Impulse.50ms..Ns., Absolute.Impulse.50ms..Asym...Ns., Absolute.Impulse.100ms..Ns., Absolute.Impulse.100ms..Asym...Ns., Absolute.Impulse.150ms..Ns., Absolute.Impulse.150ms..Asym...Ns., Absolute.Impulse.200ms..Ns., Absolute.Impulse.200ms..Asym...Ns., Injury, Area, Was.Injured, Sport)
```

### 4. Volleyball

```{r}
#selects variables of interest, filters for lower body injuries, and gets rid of duplicate observations
incid_v <- Incident_V %>%
  filter(Body.Part %in% lower_body) %>%
  dplyr::select("anon_id", "Position", "Date.of.Injury...Onset.of.symptoms", "Side", "Body.Part", "Tissue.Type", "Pathology.Type", "OSICS14.Code", "OSICS10.Code", "OSICS10.Diagnosis", "Final.Diagnosis", "Result.of.Sport.Participation", "Recurrence.of.Injury", "Injury.Prognosis", "General.Mechanism", "Specific.Mechanism", "FinalDiagnosisIncidentDate", "Total.Time.Injured", "Season.") %>%
  group_by(anon_id, Date.of.Injury...Onset.of.symptoms) %>%
  mutate(Total.Time.Injured = sum(Total.Time.Injured, na.rm = TRUE),
         Date = as.Date(Date.of.Injury...Onset.of.symptoms, format = '%m/%d/%Y'),
         Season. = ifelse(Season. == 'Pre-Season' | Season. == 'Summer Workouts' | Season. == 'Post-Season', 'Off-Season', Season.)) %>%
  ungroup() %>%
  group_by(across(everything())) %>%
  summarise(.groups = 'drop')
```

```{r, warning = FALSE}
#creates a dataset from the incident report that separates out all the dates for lower body injuries to classify observations based on their relation to lower body injuries: within 3 months prior to first injury, between first and second injury, ect.
last_injury_V <- incid_v %>%
  arrange(Date) %>%
  group_by(anon_id) %>%
  summarize(Dates.Final = paste0(Date, collapse = " and "),
            Mechanism = paste0(General.Mechanism, collapse = " and "),
            Injury = paste0(Final.Diagnosis, collapse = " and "),
            Area = paste0(Body.Part, collapse = " and "),
            Time.Injured = paste0(Total.Time.Injured, collapse = " and ")) %>%
  separate(Dates.Final, c('Injury.1', 'Injury.2', 'Injury.3', 'Injury.4', 'Injury.5', 'Injury.6', 'Injury.7'), sep = ' and ') %>%
  mutate(Injury.1.Start = as.Date(Injury.1) - months(3),
         Injury.2.Start = ifelse(is.na(Injury.2), NA, Injury.1),
         Injury.3.Start = ifelse(is.na(Injury.3), NA, Injury.2),
         Injury.4.Start = ifelse(is.na(Injury.4), NA, Injury.3),
         Injury.5.Start = ifelse(is.na(Injury.4), NA, Injury.4),
         Injury.6.Start = ifelse(is.na(Injury.4), NA, Injury.5),
         Injury.7.Start = ifelse(is.na(Injury.4), NA, Injury.6)) %>%
  separate(Mechanism, c('Injury.1.Mech', 'Injury.2.Mech', 'Injury.3.Mech', 'Injury.4.Mech', 'Injury.5.Mech', 'Injury.6.Mech', 'Injury.7.Mech'), sep = ' and ') %>%
  separate(Injury, c('Injury.1.Diagnosis', 'Injury.2.Diagnosis', 'Injury.3.Diagnosis', 'Injury.4.Diagnosis', 'Injury.5.Diagnosis', 'Injury.6.Diagnosis', 'Injury.7.Diagnosis'), sep = ' and ') %>%
  separate(Time.Injured, c('Injury.1.Time', 'Injury.2.Time', 'Injury.3.Time', 'Injury.4.Time', 'Injury.5.Time', 'Injury.6.Time', 'Injury.7.Time'), sep = ' and ') %>%
  separate(Area, c('Injury.1.Area', 'Injury.2.Area', 'Injury.3.Area', 'Injury.4.Area', 'Injury.5.Area', 'Injury.6.Area', 'Injury.7.Area'), sep = ' and ')
```

#### Performance Data

**Nordic Data**

```{r}
#merges the last_injury_S to the performance_S_nordic by anon_id
merge_performance_V <- merge(last_injury_V, performance_V_nordic, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_performance_V <- merge_performance_V %>%
  mutate(Trend = ifelse(Trend == 'Neutral', 0, ifelse(Trend == 'Up', 1, -1)),
         Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    !is.na(Injury.5) & Date >= Injury.5.Start & Date <= Injury.5 ~ '5',
    !is.na(Injury.6) & Date >= Injury.6.Start & Date <= Injury.6 ~ '6',
    !is.na(Injury.7) & Date >= Injury.7.Start & Date <= Injury.7 ~ '7',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_performance_V <- merge_performance_V %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    Group == 5 ~ Injury.5.Diagnosis,
    Group == 6 ~ Injury.6.Diagnosis,
    Group == 7 ~ Injury.7.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    Group == 5 ~ Injury.5.Area,
    Group == 6 ~ Injury.6.Area,
    Group == 7 ~ Injury.7.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3 | Group == 4 | Group == 5 | Group == 6 | Group == 7, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Athlete.Bodyweight..kg., Maximum.Force, Average.Force, Impulse, Nordic.Left.MEAN, Nordic.Right.MEAN, Nordic.MEAN.Imbalance, Nordic.Left.MAX, Nordic.Right.MAX, Nordic.MAX.Imbalance, Trend, Nordic...Difference.from.First.Test, Maximum.Nordic.Bilateral.Mean, Relative.Maximum.Nordic.Bilateral.Mean, Position, Sport, Injury, Area, Was.Injured, Force.Diff.Norm, Imbalance.Diff.Norm)
```

```{r}
#creates a boxplot of maximum relative bilateral force across the soccer players
ggplot(merge_performance_V, aes(x = Relative.Maximum.Nordic.Bilateral.Mean, y = Was.Injured)) +
  geom_boxplot(fill = '#CFB87C', color = 'black') + 
  labs(title = 'Distribution of Maximum Relative Bilateral Force Across Lacrosse Players',
       y = 'Was the Player Injured',
       x = 'Maximum Relative Bilateral Force (N / kg)') +
  theme_bw()
```

**Hip Data**

```{r}
#merges the last_injury_V to the performance_V_nordic by anon_id
merge_hip_V <- merge(last_injury_V, performance_V_hip, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_hip_V <- merge_hip_V %>%
  mutate(Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    !is.na(Injury.5) & Date >= Injury.5.Start & Date <= Injury.5 ~ '5',
    !is.na(Injury.6) & Date >= Injury.6.Start & Date <= Injury.6 ~ '6',
    !is.na(Injury.7) & Date >= Injury.7.Start & Date <= Injury.7 ~ '7',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_hip_V <- merge_hip_V %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    Group == 5 ~ Injury.5.Diagnosis,
    Group == 6 ~ Injury.6.Diagnosis,
    Group == 7 ~ Injury.7.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    Group == 5 ~ Injury.5.Area,
    Group == 6 ~ Injury.6.Area,
    Group == 7 ~ Injury.7.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3 | Group == 4 | Group == 5 | Group == 6 | Group == 7, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Athlete.Bodyweight..kg., Maximum.Force, Average.Force, Impulse, Hip.Abd.Left.MEAN, Hip.Abd.Right.MEAN, Hip.Abduction.MEAN.Imbalance, Hip.Abd.Left.MAX, Hip.Abd.Right.MAX, Hip.Abduction.MAX.Imbalance, Hip.Add.Left.MEAN, Hip.Add.Right.MEAN, Hip.Adduction.MEAN.Imbalance, Hip.Add.Left.MAX, Hip.Add.Right.MAX, Hip.Adduction.MAX.Imbalance, Bilateral.Hip.Abduction.Adduction.Ratio, Position, Sport, Injury, Area, Was.Injured)
```

#### Nordbord Data

**CMJ Data**

```{r}
#merges the last_injury_B to the HJ_B by anon_id
merge_cmj_V <- merge(last_injury_V, v, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_cmj_V <- merge_cmj_V %>%
  mutate(Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    !is.na(Injury.5) & Date >= Injury.5.Start & Date <= Injury.5 ~ '5',
    !is.na(Injury.6) & Date >= Injury.6.Start & Date <= Injury.6 ~ '6',
    !is.na(Injury.7) & Date >= Injury.7.Start & Date <= Injury.7 ~ '7',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_cmj_V <- merge_cmj_V %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    Group == 5 ~ Injury.5.Diagnosis,
    Group == 6 ~ Injury.6.Diagnosis,
    Group == 7 ~ Injury.7.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    Group == 5 ~ Injury.5.Area,
    Group == 6 ~ Injury.6.Area,
    Group == 7 ~ Injury.7.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3 | Group == 4 | Group == 5 | Group == 6 | Group == 7, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Countermovement.Depth..cm., Peak.Power...BM..W.kg., Landing.RFD..N.s., Eccentric.Concentric.Mean.Force.Ratio, Peak.Landing.Force..Asym...N., Peak.Power..W., Concentric.RFD..N.s., Eccentric.Mean.Braking.Force..N., Concentric.Time.to.Peak.Force..s., Landing.Net.Peak.Force...BM..N.kg., Peak.Net.Takeoff.Force...BM..N.kg., Concentric.RPD...BM..W.s.kg., Force.at.Peak.Power..N., Eccentric.Mean.Deceleration.Force..N., Eccentric.Peak.Force..N., RSI.Modified..m.s., CMJ.Stiffness..Left...N.m., CMJ.Stiffness..Right...N.m., Eccentric.Asymmetry, Concentric.Asymmetry, Peak.Landing.Asymmetry, Injury, Area, Was.Injured, Sport, DSI, DSI.Bucket)
```

**HJ Data**

```{r}
#merges the last_injury_B to the HJ_B by anon_id
merge_hj_V <- merge(last_injury_V, HJ_V, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_hj_V <- merge_hj_V %>%
  mutate(Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    !is.na(Injury.5) & Date >= Injury.5.Start & Date <= Injury.5 ~ '5',
    !is.na(Injury.6) & Date >= Injury.6.Start & Date <= Injury.6 ~ '6',
    !is.na(Injury.7) & Date >= Injury.7.Start & Date <= Injury.7 ~ '7',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_hj_V <- merge_hj_V %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    Group == 5 ~ Injury.5.Diagnosis,
    Group == 6 ~ Injury.6.Diagnosis,
    Group == 7 ~ Injury.7.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    Group == 5 ~ Injury.5.Area,
    Group == 6 ~ Injury.6.Area,
    Group == 7 ~ Injury.7.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3 | Group == 4 | Group == 5 | Group == 6 | Group == 7, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Corrected.Standing.Weight..Kg., Mean.RSI..Flight.Contact.Time., Active.Stiffness..N.m., Best.Average.Force..N., Best.Average.Force..Asym...N., Best.Time.to.Peak.Force..ms., Best.Contact.Time..ms., Best.Flight.Time..ms., Best.Impulse..N.s., Best.Peak.Force..N., Best.Peak.Force..Asym...N., Mean.Average.Force..N., Mean.Average.Force..Asym...N., Mean.Landing.RFD..N.s., Mean.Landing.RFD..Asym...N.s., Stiffness.Fatigue...., Stiffness.Fatigue..Asym....., Max.Jump.Height..cm., Injury, Area, Was.Injured, Sport, HJ.RSI, Mean.Flight.Time..ms., Mean.Contact.Time..ms.)
```

**IMTP Data**

```{r}
#merges the last_injury_B to the HJ_B by anon_id
merge_imtp_V <- merge(last_injury_V, IMTP_V, by = c('anon_id'), all = TRUE)

#creates a variable called Group that groups based on date within injury intervals and outputs 'After' if the date is after all injuries, and then these are omitted
merge_imtp_V <- merge_imtp_V %>%
  mutate(Group = case_when(
    is.na(Injury.1) | Date < Injury.1.Start ~ '0',
    !is.na(Injury.1) & Date >= Injury.1.Start & Date <= Injury.1 ~ '1',
    !is.na(Injury.2) & Date >= Injury.2.Start & Date <= Injury.2 ~ '2',
    !is.na(Injury.3) & Date >= Injury.3.Start & Date <= Injury.3 ~ '3',
    !is.na(Injury.4) & Date >= Injury.4.Start & Date <= Injury.4 ~ '4',
    !is.na(Injury.5) & Date >= Injury.5.Start & Date <= Injury.5 ~ '5',
    !is.na(Injury.6) & Date >= Injury.6.Start & Date <= Injury.6 ~ '6',
    !is.na(Injury.7) & Date >= Injury.7.Start & Date <= Injury.7 ~ '7',
    TRUE ~ 'After')) %>%
  filter(Group != 'After')

#condenses observations based on group and player summarizing means of variables of interest
merge_imtp_V <- merge_imtp_V %>%
  mutate(Injury = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Diagnosis,
    Group == 2 ~ Injury.2.Diagnosis,
    Group == 3 ~ Injury.3.Diagnosis,
    Group == 4 ~ Injury.4.Diagnosis,
    Group == 5 ~ Injury.5.Diagnosis,
    Group == 6 ~ Injury.6.Diagnosis,
    Group == 7 ~ Injury.7.Diagnosis,
    TRUE ~ 'After'
  ),
  Area = case_when(
    Group == 0 ~ 'None',
    Group == 1 ~ Injury.1.Area,
    Group == 2 ~ Injury.2.Area,
    Group == 3 ~ Injury.3.Area,
    Group == 4 ~ Injury.4.Area,
    Group == 5 ~ Injury.5.Area,
    Group == 6 ~ Injury.6.Area,
    Group == 7 ~ Injury.7.Area,
    TRUE ~ 'After'
  )) %>%
  mutate(Was.Injured = ifelse(Group == 1 | Group == 2 | Group == 3 | Group == 4 | Group == 5 | Group == 6 | Group == 7, 'Yes', Group)) %>%
  dplyr::select(anon_id, Date, Baseline.Force..N., Baseline.Force..Asym...N., Peak.Vertical.Force..N., Peak.Vertical.Force...BM..N.kg., Peak.Vertical.Force..Asym...N., RFD...50ms..N.s., RFD...50ms..Asym...N.s., RFD...100ms..N.s., RFD...100ms..Asym...N.s., RFD...150ms..N.s., RFD...150ms..Asym...N.s., RFD...200ms..N.s., RFD...200ms..Asym...N.s., Net.Peak.Vertical.Force..N.s., Net.Peak.Vertical.Force..Asym...N.s., Force.at.200ms...BM..N.kg., Absolute.Impulse.50ms..Ns., Absolute.Impulse.50ms..Asym...Ns., Absolute.Impulse.100ms..Ns., Absolute.Impulse.100ms..Asym...Ns., Absolute.Impulse.150ms..Ns., Absolute.Impulse.150ms..Asym...Ns., Absolute.Impulse.200ms..Ns., Absolute.Impulse.200ms..Asym...Ns., Injury, Area, Was.Injured, Sport)
```

### Merging All Together

```{r}
library(pROC)
```

#### Performance Data

**Nordic Data**

```{r}
#creating a dataset containing performance data accross all sports
performance_all_injury <- rbind(merge_performance_B, merge_performance_S, merge_performance_L, merge_performance_V) %>%
  mutate(Thresh = ifelse(Relative.Maximum.Nordic.Bilateral.Mean >= 5, 'Yes', 'No'),
         Sport.2 = ifelse(Sport == 'Basketball' | Sport == 'Volleyball', 'Court', 'Field'),
         Was.Injured = ifelse(Was.Injured == 'Yes', 'Yes', 'No'))
```

```{r}
#creates a density plot that compares a metric across the different sports
ggplot(data = performance_all_injury %>% filter(Area %in% c('Ankle', 'None')), aes(Impulse, fill = Was.Injured)) + 
  geom_density(alpha = 0.5) +
  scale_fill_manual(values = c('#CFB87C', '#000000')) +
  labs(title = 'Nordic Impulse vs Lower Body Injury',
       x = 'Impulse',
       y = 'Density',
       fill = 'Lower Body Injury') +
  theme_bw()
```

```{r}
t.test(Impulse ~ Was.Injured, data = performance_all_injury, alternative = 'greater')
t.test(Impulse ~ Was.Injured, data = merge_performance_B, alternative = 'greater')
t.test(Impulse ~ Was.Injured, data = merge_performance_S, alternative = 'greater')
t.test(Impulse ~ Was.Injured, data = merge_performance_L, alternative = 'greater')
t.test(Impulse ~ Was.Injured, data = merge_performance_V, alternative = 'greater')
```

There is statistical evidence of a difference in mean impulse between those that suffered lower body injury and those that did not (all sports together). However, basketball and volleyball by themselves do not, with volleyball even having higher average impulse in those that got injured. Soccer and lacrosse both are statistically significant in differences with lacrosse being very extreme. 

```{r}
roc_obj <- roc(response = performance_all_injury$Was.Injured, predictor = performance_all_injury$Impulse, direction = ">")

plot(roc_obj, print.auc = TRUE, col = "#CFB87C", main = "ROC Curve for Impulse")
```

```{r}
roc_coords <- coords(roc_obj, x = "best", best.method = "youden", ret = c("threshold", "sensitivity", "specificity"))

print(roc_coords)
```

```{r}
t.test(Nordic.MAX.Imbalance ~ Was.Injured, data = performance_all_injury, alternative = 'less')
t.test(Nordic.MAX.Imbalance ~ Was.Injured, data = merge_performance_B, alternative = 'less')
t.test(Nordic.MAX.Imbalance ~ Was.Injured, data = merge_performance_S, alternative = 'less')
t.test(Nordic.MAX.Imbalance ~ Was.Injured, data = merge_performance_L, alternative = 'less')
t.test(Nordic.MAX.Imbalance ~ Was.Injured, data = merge_performance_V, alternative = 'less')
```

There is statistical evidence of a difference in max imbalance between those that suffered lower body injury and those that did not (all sports together). However, basketball, volleyball, and soccer by themselves do not. Lacrosse did have a very statistically significant difference, however. 

```{r}
roc_obj <- roc(response = performance_all_injury$Was.Injured, predictor = performance_all_injury$Nordic.MAX.Imbalance, direction = "<")

plot(roc_obj, print.auc = TRUE, col = "#CFB87C", main = "ROC Curve for Impulse")
```

```{r}
roc_coords <- coords(roc_obj, x = "best", best.method = "youden", ret = c("threshold", "sensitivity", "specificity"))

print(roc_coords)
```

**Hip Data**

```{r}
#creating a dataset containing performance data accross all sports
hip_all_injury <- rbind(merge_hip_B, merge_hip_S, merge_hip_L, merge_hip_V) %>%
  mutate(Avg.Abd.Mean = (Hip.Abd.Left.MEAN + Hip.Abd.Right.MEAN) / 2,
         Avg.Add.Mean = (Hip.Add.Left.MEAN + Hip.Add.Right.MEAN) / 2,
         Avg.Abd.Max = (Hip.Abd.Left.MAX + Hip.Abd.Right.MAX) / 2,
         Avg.Add.Max = (Hip.Add.Left.MAX + Hip.Add.Right.MAX) / 2,
         Relative.Abd.Mean = Avg.Abd.Mean / Athlete.Bodyweight..kg.,
         Relative.Add.Mean = Avg.Add.Mean / Athlete.Bodyweight..kg.,
         Relative.Abd.Max = Avg.Abd.Max / Athlete.Bodyweight..kg.,
         Relative.Add.Max = Avg.Add.Max / Athlete.Bodyweight..kg.,
         Sport.2 = ifelse(Sport == 'Basketball' | Sport == 'Volleyball', 'Court', 'Field'),
         Was.Injured = ifelse(Was.Injured == 'Yes', 'Yes', 'No'))
```

```{r}
ggplot(data = hip_all_injury %>% filter(Area %in% c('None', 'Ankle')), aes(Avg.Add.Mean, fill = Was.Injured)) + 
  geom_density(alpha = 0.5) +
  scale_fill_manual(values = c('#CFB87C', '#000000')) +
  labs(title = 'Hip Abduction Average Force vs Lower Body Injury',
       x = 'Average Bilateral Force (N)',
       y = 'Density',
       fill = 'Lower Body Injury') +
  facet_wrap(~Sport.2) +
  theme_bw()
```

```{r}
t.test(Impulse ~ Was.Injured, data = hip_all_injury, alternative = 'less')
t.test(Impulse ~ Was.Injured, data = merge_hip_B, alternative = 'less')
t.test(Impulse ~ Was.Injured, data = merge_hip_S, alternative = 'less')
t.test(Impulse ~ Was.Injured, data = merge_hip_L, alternative = 'less')
t.test(Impulse ~ Was.Injured, data = merge_hip_V, alternative = 'less')
```

Interestingly, there is statistical evidence of a difference in mean impulse between those that suffered lower body injury and those that did not (all sports together), but the impulse is higher in injured group. However, soccer and lacrosse by themselves do not. Basketball and volleyball both are statistically significant (almost) in differences with basketball being more extreme. 

```{r}
t.test(Maximum.Force ~ Was.Injured, data = hip_all_injury)
t.test(Maximum.Force ~ Was.Injured, data = merge_hip_B)
t.test(Maximum.Force ~ Was.Injured, data = merge_hip_S)
t.test(Maximum.Force ~ Was.Injured, data = merge_hip_L)
t.test(Maximum.Force ~ Was.Injured, data = merge_hip_V)
```

There is statistical evidence of a difference in mean maximum force for just basketball and volleyball, but the mean maximum force for basketball is lower in injured group while the mean is higher in the injured group for volleyball. 

```{r}
t.test(Avg.Abd.Mean ~ Was.Injured, data = hip_all_injury)
t.test(Avg.Abd.Mean ~ Was.Injured, data = hip_all_injury %>% filter(Sport == 'Basketball'))
t.test(Avg.Abd.Mean ~ Was.Injured, data = hip_all_injury %>% filter(Sport == 'Soccer'))
t.test(Avg.Abd.Mean ~ Was.Injured, data = hip_all_injury %>% filter(Sport == 'Lacrosse'))
t.test(Avg.Abd.Mean ~ Was.Injured, data = hip_all_injury %>% filter(Sport == 'Volleyball'))
```

The average abduction mean is significant for basketball and almost for lacrosse. 

#### Nordbord Data

**CMJ Data**

```{r}
#creating a dataset containing performance data accross all sports
cmj_all_injury <- rbind(merge_cmj_B, merge_cmj_S, merge_cmj_L, merge_cmj_V) %>%
  mutate(Sport.2 = ifelse(Sport == 'Basketball' | Sport == 'Volleyball', 'Court', 'Field'),
         Was.Injured = ifelse(Was.Injured == 'Yes', 'Yes', 'No'))
```

```{r}
table(cmj_all_injury$DSI.Bucket, cmj_all_injury$Was.Injured)
```

The overall proportion of injuries within Ballistic Strength Training is 0.1630094, Concurrent Training is 0.2533333, and Maximal Strength Training is 0.2527473.

```{r}
table(merge_cmj_B$DSI.Bucket, merge_cmj_B$Was.Injured)
table(merge_cmj_S$DSI.Bucket, merge_cmj_S$Was.Injured)
table(merge_cmj_L$DSI.Bucket, merge_cmj_L$Was.Injured)
table(merge_cmj_V$DSI.Bucket, merge_cmj_V$Was.Injured)
```

Basketball:
* Ballistic Strength Training: 0.1900312
* Concurrent Training: 0.137931
* Maximal Strength Training: 0.40625
Soccer:
* Ballistic Strength Training: 0.2142857
* Concurrent Training: 0.2867925
* Maximal Strength Training: 0.3684211
Lacrosse:
* Ballistic Strength Training: 0.3333333
* Concurrent Training: 0.2222222
* Maximal Strength Training: 0.1290323
Volleyball:
* Ballistic Strength Training: 0.1461039
* Concurrent Training: 0

```{r}
#basketball matrix for injury vs DSI bucket
injury_matrix_b <- matrix(c(260, 61,
                          25, 4,
                          19, 13), 
                        nrow = 3, byrow = TRUE)

rownames(injury_matrix_b) <- c("Ballistic", "Concurrent", "Maximal")
colnames(injury_matrix_b) <- c("Not.Injured", "Injured")

#soccer matrix for injury vs DSI bucket
injury_matrix_s <- matrix(c(11, 3,
                          189, 76,
                          36, 21), 
                        nrow = 3, byrow = TRUE)

rownames(injury_matrix_s) <- c("Ballistic", "Concurrent", "Maximal")
colnames(injury_matrix_s) <- c("Not.Injured", "Injured")

#lacrosse matrix for injury vs DSI bucket
injury_matrix_l <- matrix(c(4, 2,
                          119, 34,
                          81, 12), 
                        nrow = 3, byrow = TRUE)

rownames(injury_matrix_l) <- c("Ballistic", "Concurrent", "Maximal")
colnames(injury_matrix_l) <- c("Not.Injured", "Injured")

#volleyball matrix for injury vs DSI bucket
injury_matrix_v <- matrix(c(526, 90,
                          3, 0), 
                        nrow = 2, byrow = TRUE)

rownames(injury_matrix_v) <- c("Ballistic", "Concurrent")
colnames(injury_matrix_v) <- c("Not.Injured", "Injured")
```

```{r}
fisher.test(injury_matrix_b)
fisher.test(injury_matrix_s)
fisher.test(injury_matrix_l)
fisher.test(injury_matrix_v)
```

```{r}
ggplot(data = cmj_all_injury %>% filter(Area %in% c('Ankle', 'None')), aes(RSI.Modified..m.s., fill = Was.Injured)) + 
  geom_density(alpha = 0.5) +
  scale_fill_manual(values = c('#CFB87C', '#000000')) +
  labs(title = 'DSI vs Lower Body Injury',
       x = 'DSI',
       y = 'Density',
       fill = 'Lower Body Injury',
       caption = 'Field Sports') +
  facet_wrap(~Sport.2) + 
  theme_bw()
```

```{r}
t.test(Landing.Net.Peak.Force...BM..N.kg. ~ Was.Injured, data = cmj_all_injury)
t.test(Landing.Net.Peak.Force...BM..N.kg. ~ Was.Injured, data = merge_cmj_B)
t.test(Landing.Net.Peak.Force...BM..N.kg. ~ Was.Injured, data = merge_cmj_S)
t.test(Landing.Net.Peak.Force...BM..N.kg. ~ Was.Injured, data = merge_cmj_L)
t.test(Landing.Net.Peak.Force...BM..N.kg. ~ Was.Injured, data = merge_cmj_V)
```

There is statistical evidence of a difference in landing net force with bw between those that suffered lower body injury and those that did not (all sports together). However, for individual sports only soccer is significant but very much so with higher strength in the injured group. 

```{r}
t.test(RSI.Modified..m.s. ~ Was.Injured, data = cmj_all_injury, alternative = 'less')
t.test(RSI.Modified..m.s. ~ Was.Injured, data = merge_cmj_B, alternative = 'less')
t.test(RSI.Modified..m.s. ~ Was.Injured, data = merge_cmj_S, alternative = 'less')
t.test(RSI.Modified..m.s. ~ Was.Injured, data = merge_cmj_L, alternative = 'less')
t.test(RSI.Modified..m.s. ~ Was.Injured, data = merge_cmj_V, alternative = 'less')
```

There is statistical evidence of a difference in rsi modified between those that suffered lower body injury and those that did not (all sports together). In all sports those that were injured had a statistically significantly higher rsi modified. 

```{r}
t.test(Countermovement.Depth..cm. ~ Was.Injured, data = cmj_all_injury)
t.test(Countermovement.Depth..cm. ~ Was.Injured, data = merge_cmj_B)
t.test(Countermovement.Depth..cm. ~ Was.Injured, data = merge_cmj_S)
t.test(Countermovement.Depth..cm. ~ Was.Injured, data = merge_cmj_L)
t.test(Countermovement.Depth..cm. ~ Was.Injured, data = merge_cmj_V)
```

There is statistical evidence of a difference in countermovement depth for all sports but volleyball. In lacrosse and basketball the mean depth for those that suffered injury is not as deep as those that did not suffer injury. However for soccer the depth for those who got injured is deeper than those that did not get injured.  

```{r}
t.test(Force.at.Peak.Power..N. ~ Was.Injured, data = cmj_all_injury)
t.test(Force.at.Peak.Power..N. ~ Was.Injured, data = merge_cmj_B)
t.test(Force.at.Peak.Power..N. ~ Was.Injured, data = merge_cmj_S)
t.test(Force.at.Peak.Power..N. ~ Was.Injured, data = merge_cmj_L)
t.test(Force.at.Peak.Power..N. ~ Was.Injured, data = merge_cmj_V)
```

There is statistical evidence of a difference in force at peak power for all sports but basketball. In all three of these sports the force at peak power is greater in the injured group in comparison to the uninjured group.  

```{r}
t.test(Concentric.RPD...BM..W.s.kg. ~ Was.Injured, data = cmj_all_injury)
t.test(Concentric.RPD...BM..W.s.kg. ~ Was.Injured, data = merge_cmj_B)
t.test(Concentric.RPD...BM..W.s.kg. ~ Was.Injured, data = merge_cmj_S)
t.test(Concentric.RPD...BM..W.s.kg. ~ Was.Injured, data = merge_cmj_L)
t.test(Concentric.RPD...BM..W.s.kg. ~ Was.Injured, data = merge_cmj_V)
```

There is statistical evidence of a difference in concentric RPD with bw for all sports. In all four of these sports the concentric RPD with bw is greater in the injured group in comparison to the uninjured group. 

```{r}
t.test(DSI ~ Was.Injured, data = cmj_all_injury %>% filter(Sport.2 == 'Field'))
t.test(DSI ~ Was.Injured, data = merge_cmj_B)
t.test(DSI ~ Was.Injured, data = merge_cmj_S)
t.test(DSI ~ Was.Injured, data = merge_cmj_L)
t.test(DSI ~ Was.Injured, data = merge_cmj_V)
```

There is statistical evidence of a difference in DSI for all sports. In only the field sports however is this significant (soccer and lacrosse), with the DSI being lower in those groups. 

```{r}
roc_obj <- roc(response = merge_cmj_S$Was.Injured, predictor = merge_cmj_S$DSI, direction = ">")

plot(roc_obj, print.auc = TRUE, col = "#CFB87C", main = "ROC Curve for Training Load")
```

```{r}
roc_coords <- coords(roc_obj, x = "best", best.method = "youden", ret = c("threshold", "sensitivity", "specificity"))

print(roc_coords)
```

```{r}
roc_obj <- roc(response = merge_cmj_L$Was.Injured, predictor = merge_cmj_L$DSI, direction = ">")

plot(roc_obj, print.auc = TRUE, col = "#CFB87C", main = "ROC Curve for Training Load")
```

```{r}
roc_coords <- coords(roc_obj, x = "best", best.method = "youden", ret = c("threshold", "sensitivity", "specificity"))

print(roc_coords)
```

**HJ Data**

```{r}
#creating a dataset containing performance data accross all sports
hj_all_injury <- rbind(merge_hj_B, merge_hj_S, merge_hj_L, merge_hj_V) %>%
  mutate(Sport.2 = ifelse(Sport == 'Basketball' | Sport == 'Volleyball', 'Court', 'Field'),
         Was.Injured = ifelse(Was.Injured == 'Yes', 'Yes', 'No'),
         Ankle = ifelse(Area == 'Ankle', 'Yes', 'No'),
         Knee = ifelse(Area == 'Knee', 'Yes', 'No'))

field_ankle <- hj_all_injury %>%
  filter(Sport.2 == 'Field' & Ankle == 'Yes')
```

%>% filter(Area %in% c('Ankle', 'None'))

```{r}
ggplot(data = hj_all_injury %>% filter(Area %in% c('Ankle', 'None')), aes(Mean.Flight.Time..ms., fill = Was.Injured)) + 
  geom_density(alpha = 0.5) +
  scale_fill_manual(values = c('#CFB87C', '#000000')) +
  labs(title = 'Hop Jump RSI vs Lower Body Injury',
       x = 'Hop Jump RSI',
       y = 'Density',
       fill = 'Lower Body Injury') +
  facet_wrap(~Sport.2) +
  scale_x_continuous(breaks = seq(0, 7, 0.2)) + 
  theme_bw()
```

```{r}
t.test(Best.Impulse..N.s. ~ Was.Injured, data = hj_all_injury)
t.test(Best.Impulse..N.s. ~ Was.Injured, data = merge_hj_B)
t.test(Best.Impulse..N.s. ~ Was.Injured, data = merge_hj_S)
t.test(Best.Impulse..N.s. ~ Was.Injured, data = merge_hj_L)
```

There is statistical evidence of a difference in best impulse between those that suffered lower body injury and those that did not (all sports together). Basketball and lacrosse were significant with lower impulse in the injured group but basketball only had four observations in the injured group and all the same person. Volleyball only has one observation total in the injured category. 

```{r}
t.test(Best.Flight.Time..ms. ~ Was.Injured, data = hj_all_injury)
t.test(Best.Flight.Time..ms. ~ Was.Injured, data = merge_hj_B)
t.test(Best.Flight.Time..ms. ~ Was.Injured, data = merge_hj_S)
t.test(Best.Flight.Time..ms. ~ Was.Injured, data = merge_hj_L)
```

There is statistical evidence of a difference in best impulse between those that suffered lower body injury and those that did not (all sports together). Basketball is very significant but once again very few observations, and soccer is almost significant with a lower best flight time for those who suffered injury. 

```{r}
t.test(Stiffness.Fatigue..Asym..... ~ Was.Injured, data = hj_all_injury)
t.test(Stiffness.Fatigue..Asym..... ~ Was.Injured, data = merge_hj_B)
t.test(Stiffness.Fatigue..Asym..... ~ Was.Injured, data = merge_hj_S)
t.test(Stiffness.Fatigue..Asym..... ~ Was.Injured, data = merge_hj_L)
```

There is statistical evidence of a difference in stiffness asymmetry between those that suffered lower body injury and those that did not in basketball and lacrosse with asymmetry being greater in injured group. 

```{r}
t.test(HJ.RSI ~ Was.Injured, data = hj_all_injury)
t.test(HJ.RSI ~ Was.Injured, data = merge_hj_B)
t.test(HJ.RSI ~ Was.Injured, data = merge_hj_S)
t.test(HJ.RSI ~ Was.Injured, data = merge_hj_L)
```

There is statistical evidence of a difference in stiffness asymmetry between those that suffered lower body injury and those that did not in basketball and lacrosse with asymmetry being greater in injured group. 

**IMTP Data**

```{r}
#creating a dataset containing performance data accross all sports
imtp_all_injury <- rbind(merge_imtp_B, merge_imtp_S, merge_imtp_L, merge_imtp_V) %>%
  mutate(Sport.2 = ifelse(Sport == 'Basketball' | Sport == 'Volleyball', 'Court', 'Field'),
         Was.Injured = ifelse(Was.Injured == 'Yes', 'Yes', 'No'),
         Thresh = ifelse(Peak.Vertical.Force..Asym...N. < -2.4025, 1, 0))
```

```{r}
table(imtp_all_injury$Thresh, imtp_all_injury$Was.Injured)
```

```{r}
ggplot(data = imtp_all_injury, aes(Net.Peak.Vertical.Force..Asym...N.s., fill = Was.Injured)) + 
  geom_density(alpha = 0.5) +
  scale_fill_manual(values = c('#CFB87C', '#000000')) +
  labs(title = 'Peak Vertical Force Asymmetry vs Lower Body Injury',
       x = 'Peak Vertical Force Asymmetry',
       y = 'Density',
       fill = 'Lower Body Injury',
       caption = 'All Players') +
  geom_vline(xintercept = -2.4025, color = 'red', linetype = 'dashed') +
#  facet_wrap(~Sport) +
  theme_bw()
```

```{r}
t.test(Peak.Vertical.Force..Asym...N. ~ Was.Injured, data = imtp_all_injury)
t.test(Peak.Vertical.Force..Asym...N. ~ Was.Injured, data = merge_imtp_S)
t.test(Peak.Vertical.Force..Asym...N. ~ Was.Injured, data = merge_imtp_L)
t.test(Peak.Vertical.Force..Asym...N. ~ Was.Injured, data = merge_imtp_V)
```

Only one person that represents the injury group in both soccer and lacrosse, but difference in peak vertical force asymmetry is significant for all sports with asymmetry being lower for injured groups. 

```{r}
roc_obj <- roc(response = merge_imtp_V$Was.Injured, predictor = merge_imtp_V$Peak.Vertical.Force..Asym...N., direction = ">")

plot(roc_obj, print.auc = TRUE, col = "#CFB87C", main = "ROC Curve for Training Load")
```

```{r}
roc_coords <- coords(roc_obj, x = "best", best.method = "youden", ret = c("threshold", "sensitivity", "specificity"))

print(roc_coords)
```

```{r}
t.test(RFD...100ms..N.s. ~ Was.Injured, data = imtp_all_injury)
t.test(RFD...100ms..N.s. ~ Was.Injured, data = merge_imtp_S)
t.test(RFD...100ms..N.s. ~ Was.Injured, data = merge_imtp_L)
t.test(RFD...100ms..N.s. ~ Was.Injured, data = merge_imtp_V)
```

Volleyball is significant with a lower value for RFD at 100 ms in the injured group in comparison to the healthy group. 

# Question 2: Strength Trends Across Sports


```{r}
library(grid)
library(png)
library(cowplot)
library(magick)
```

## Incident Rates

**Basketball**
Ankle: 8 injuries out of 30 lower body
Knee: 11 injuries out of 30 lower body (1 ACL)
Thigh: 1 injury out of 30 lower body
No calf, 1 achiles tendon
**Soccer**
Ankle: 18 injuries out of 92 lower body
Knee: 28 injuries out of 92 lower body (1 ACL)
Thigh: 18 injuries out of 92 lower body (4 HSI)
**Lacrosse**
Ankle: 8 injuries out of 45 lower body
Knee: 16 injuries out of 45 lower body (4 ACL)
Thigh: 6 injuries out of 45 lower body (3 HSI)
**Volleyball**
Ankle: 5 injuries out of 29 lower body
Knee: 10 injuries out of 29 lower body (1 ACL)
Thigh: 5 injuries out of 29 lower body (3 HSI)

## Forcedecks

### 1. CMJ Data

```{r}
#creating a dataset containing all information for CMJ
cmj <- rbind(b, s, l, v) %>%
  mutate(Sport.2 = ifelse(Sport == 'Basketball' | Sport == 'Volleyball', 'Court', 'Field')) %>%
  filter(Jump.Height..Imp.Mom...cm. < 100)

#summarizes important metrics
cmj %>%
  group_by(Sport) %>%
  summarize(`DSI` = mean(DSI),
            `Modified RSI` = mean(RSI.Modified..m.s.),
            `Jump Height` = mean(Jump.Height..Imp.Mom...cm.))
```

```{r}
#creates a density plot for maximum force across sports
ggplot(cmj, aes(x = RSI.Modified..m.s., color = Sport, fill = Sport)) + 
  geom_density(alpha = 0.4) + 
  scale_fill_manual(values = c('#CFB87C', '#60D272', '#FF736F', '#565A5C')) +
  scale_color_manual(values = c('#CFB87C', '#60D272', '#FF736F', '#565A5C')) +
  labs(title = 'Distribution of Modified RSI Across Sports',
       x = 'Modified RSI (m/s)',
       y = 'Density') +
  scale_x_continuous(breaks = seq(from = 0, to = 100, by = 0.05)) +
  theme_bw()
```

```{r}
#creates a density plot for maximum force across sports
ggplot(cmj, aes(x = DSI, color = Sport.2, fill = Sport.2)) + 
  geom_density(alpha = 0.5) + 
  scale_fill_manual(values = c('#CFB87C', '#000000')) +
  scale_color_manual(values = c('#CFB87C', '#000000')) +
  labs(title = 'Distribution of DSI Across Sports',
       x = 'DSI',
       y = 'Density',
       fill = 'Sport Type',
       color = 'Sport Type') +
  scale_x_continuous(breaks = seq(from = 0, to = 100, by = 0.1)) +
  theme_bw()
```

```{r}
img <- image_read("C:/Users/cazb4905/Documents/T2P2-data-analysis-2025/jh_wlx.png")
img_grob <- rasterGrob(img, interpolate = TRUE)
img_plot <- ggdraw() + draw_grob(img_grob, x = 0, y = 0, width = 1, height = 1)

p <- ggplot(l, aes(x = Jump.Height..Imp.Mom...cm.)) + 
  geom_density(fill = '#CFB87C') +
  labs(title = 'Distribution of Jump Height',
       x = 'Jump Height (cm)',
       y = 'Density',
       caption = 'CU Womens Lacrosse') +
  geom_vline(xintercept = median(l$Jump.Height..Imp.Mom...cm.), linetype = 'solid') +
  geom_vline(xintercept = c(quantile(l$Jump.Height..Imp.Mom...cm., probs = c(0.01, 0.25, 0.75, 0.99))), linetype = 'dashed') + 
  scale_x_continuous(breaks = seq(from = 0, to = 100, by = 5)) + 
  theme_bw()

combined <- plot_grid(p, img_plot, 
                      rel_widths = c(1.5, 1), 
                      nrow = 1,       # <- horizontal layout
                      align = "h")    # <- align vertically 

combined
```

```{r}
quantile(l$Jump.Height..Imp.Mom...cm., probs = c(0.25, 0.5, 0.75))
```

```{r}
b['Year'] <- as.factor(year(b$Date))
b['Month'] <- as.factor(month(b$Date))

b2 <- b %>%
  group_by(Year, Month) %>%
  summarize(Force.at.Peak.Power..N. = mean(Force.at.Peak.Power..N.), .groups = 'drop') %>%
  mutate(Date = as.Date(paste(b2$Year, b2$Month, "01", sep = "-")))

#creates a density plot for maximum force across sports
ggplot(b2, aes(x = Date, y = Force.at.Peak.Power..N.)) + 
  geom_line() + 
  labs(title = 'Distribution of Force at Peak Power Across Year',
       x = 'Force at Peak Power (N)',
       y = 'Density') +
  theme_bw()
```

```{r}
#performs a Welch's T-test for difference of means
t.test(Peak.Net.Takeoff.Force...BM..N.kg. ~ Sport.2, data = cmj)
t.test(Landing.Net.Peak.Force...BM..N.kg. ~ Sport.2, data = cmj)
t.test(Force.at.Peak.Power..N. ~ Sport.2, data = cmj)
t.test(RSI.Modified..m.s. ~ Sport.2, data = cmj)
t.test(DSI ~ Sport.2, data = cmj)
```

Most differences are very significant between court and field sports. 

All sports are statistically signficantly away from each other. Volleyball <<< Basketball <<< Soccer <<< Lacrosse

```{r}
t.test(Jump.Height..Imp.Mom...cm. ~ Sport, data = cmj %>% filter(Sport %in% c('Basketball', 'Soccer')))
```

### 1. HJ Data

```{r}
#creating a dataset containing all information for CMJ
hj <- rbind(HJ_B, HJ_S, HJ_L, HJ_V) %>%
  mutate(Sport.2 = ifelse(Sport == 'Basketball' | Sport == 'Volleyball', 'Court', 'Field'))

hj %>%
  group_by(Sport) %>%
  summarize(`RSI` = mean(HJ.RSI),
            `Contact Time` = mean(Mean.Contact.Time..ms.))
```

```{r}
#creates a density plot for maximum force across sports
ggplot(hj, aes(x = HJ.RSI, color = Sport, fill = Sport)) + 
  geom_density(alpha = 0.4) + 
  scale_fill_manual(values = c('#CFB87C', '#60D272', '#FF736F', '#565A5C')) +
  scale_color_manual(values = c('#CFB87C', '#60D272', '#FF736F', '#565A5C')) +
  labs(title = 'Distribution of Hop Jump RSI Across Sports',
       x = 'Hop Jump RSI (m/s)',
       y = 'Density') +
  scale_x_continuous(breaks = seq(from = 0, to = 7, by = 0.2)) + 
  theme_bw()
```

```{r}
#creates a density plot for maximum force across sports
ggplot(hj, aes(x = Mean.Contact.Time..ms., color = Sport.2, fill = Sport.2)) + 
  geom_density(alpha = 0.5) + 
  scale_fill_manual(values = c('#CFB87C', '#000000')) +
  scale_color_manual(values = c('#CFB87C', '#000000')) +
  labs(title = 'Distribution of Mean Contact Time Across Sports',
       x = 'Mean Contact Time (s)',
       y = 'Density',
       fill = 'Sport Type',
       color = 'Sport Type') +
  scale_x_continuous(breaks = seq(from = 0, to = 7, by = 0.04)) + 
  theme_bw()
```

```{r}
img <- image_read("C:/Users/cazb4905/Documents/T2P2-data-analysis-2025/hjcontact_wlx.png")
img_grob <- rasterGrob(img, interpolate = TRUE)
img_plot <- ggdraw() + draw_grob(img_grob, x = 0, y = 0, width = 1, height = 1)

p <- ggplot(HJ_L, aes(x = Mean.Contact.Time..ms.)) + 
  geom_density(fill = '#CFB87C') +
  labs(title = 'Distribution of Mean Contact Time',
       x = 'Mean Contact Time (s)',
       y = 'Density',
       caption = 'CU Womens Lacrosse') +
  geom_vline(xintercept = median(HJ_L$Mean.Contact.Time..ms.), linetype = 'solid') +
  geom_vline(xintercept = c(quantile(HJ_L$Mean.Contact.Time..ms., probs = c(0.01, 0.25, 0.75, 0.99))), linetype = 'dashed') + 
  scale_x_continuous(breaks = seq(from = 0, to = 100, by = 0.04)) + 
  theme_bw()

combined <- plot_grid(p, img_plot, 
                      rel_widths = c(1.5, 1), 
                      nrow = 1,       # <- horizontal layout
                      align = "h")    # <- align vertically 

combined
```

```{r}
quantile(HJ_L$Mean.Contact.Time..ms., probs = c(0.25, 0.5, 0.75))
```

```{r}
t.test(Mean.Contact.Time..ms. ~ Sport, data = hj %>% filter(Sport %in% c('Lacrosse', 'Volleyball')))
```

## Performance Dataset

### 1. Nordic Data

```{r}
#creating a dataset containing performance data across all sports
performance_all_nordic <- rbind(performance_B_nordic, performance_S_nordic, performance_L_nordic, performance_V_nordic) %>%
  mutate(Thresh = ifelse(Relative.Maximum.Nordic.Bilateral.Mean >= 5, 'Yes', 'No'),
         Sport.2 = ifelse(Sport == 'Basketball' | Sport == 'Volleyball', 'Court', 'Field'))

#summarizes averages in most important variables by sport
performance_all_nordic %>%
  group_by(Sport) %>%
  summarise(`Average Maximum Nordic Bilateral Mean` = mean(Maximum.Nordic.Bilateral.Mean),
            `Average Relative Maximum Nordic Bilateral Mean` = mean(Relative.Maximum.Nordic.Bilateral.Mean),
            `Average Mean Imbalance` = mean(Nordic.MEAN.Imbalance),
            `Average Max Imbalance` = mean(Nordic.MAX.Imbalance))
```

```{r}
#creates a density plot for maximum force across sports
ggplot(performance_all_nordic, aes(x = Maximum.Nordic.Bilateral.Mean, color = Sport, fill = Sport)) + 
  geom_density(alpha = 0.4) + 
  scale_fill_manual(values = c('#CFB87C', '#60D272', '#FF736F', '#565A5C')) +
  scale_color_manual(values = c('#CFB87C', '#60D272', '#FF736F', '#565A5C')) +
  labs(title = 'Distribution of Maximum Nordic Force Across Sports',
       x = 'Maximum Bilateral Average Force (N)',
       y = 'Density') +
  scale_x_continuous(breaks = seq(from = 0, to = 600, by = 50)) + 
  theme_bw()
```

```{r}
#creates a density plot for maximum bilateral force across sport type
ggplot(performance_all_nordic, aes(x = Maximum.Nordic.Bilateral.Mean, color = Sport.2, fill = Sport.2)) + 
  geom_density(alpha = 0.5) + 
  scale_fill_manual(values = c('#CFB87C', '#000000')) +
  scale_color_manual(values = c('#CFB87C', '#000000')) +
  labs(title = 'Distribution of Maximum Nordic Force Across Sports',
       x = 'Maximum Bilateral Average Force (N)',
       y = 'Density',
       fill = 'Sport Type',
       color = 'Sport Type') +
  scale_x_continuous(breaks = seq(from = 0, to = 600, by = 50)) + 
  theme_bw()
```

```{r}
field_all['Year'] <- (year(field_all$Date))
field_all['Month'] <- (month(field_all$Date))

field_all2 <- field_all %>%
  mutate(Month.2 = case_when(
    1 <= Month & Month <= 3 ~ 1,
    4 <= Month & Month <= 6 ~ 4,
    7 <= Month & Month <= 9 ~ 7,
    TRUE ~ 10
  )) %>%
  group_by(Year, Month.2) %>%
  summarize(Maximum.Nordic.Bilateral.Mean = mean(Maximum.Nordic.Bilateral.Mean), .groups = 'drop') %>%
  mutate(Date = as.Date(paste(field_all2$Year, field_all2$Month.2, "01", sep = "-")))

#creates a density plot for maximum force across sports
ggplot(field_all2, aes(x = Date, y = Maximum.Nordic.Bilateral.Mean)) + 
  geom_line(color = '#666666') + 
  labs(title = 'Maximum Nordic Bilateral Force Over Time',
       x = 'Average Maximum Nordic Bilateral Force (N)',
       y = 'Density',
       caption = 'CU Field Sports') +
  scale_x_date(date_breaks = '6 months') +
  theme_bw()
```

```{r}
img <- image_read("C:/Users/cazb4905/Documents/T2P2-data-analysis-2025/nordic_wlx.png")
img_grob <- rasterGrob(img, interpolate = TRUE)
img_plot <- ggdraw() + draw_grob(img_grob, x = 0, y = 0, width = 1, height = 1)

p <- ggplot(performance_L_nordic, aes(x = Maximum.Nordic.Bilateral.Mean)) + 
  geom_density(fill = '#CFB87C') +
  labs(title = 'Distribution of Maximum Nordic Force',
       x = 'Maximum Bilateral Average Force (N)',
       y = 'Density',
       caption = 'CU Womens Lacrosse') +
  geom_vline(xintercept = median(performance_L_nordic$Maximum.Nordic.Bilateral.Mean), linetype = 'solid') +
  geom_vline(xintercept = c(quantile(performance_L_nordic$Maximum.Nordic.Bilateral.Mean, probs = c(0.01, 0.25, 0.75, 0.99))), linetype = 'dashed') + 
  scale_x_continuous(breaks = seq(from = 0, to = 1000, by = 50)) + 
  theme_bw()

combined <- plot_grid(p, img_plot, 
                      rel_widths = c(1.5, 1), 
                      nrow = 1,       # <- horizontal layout
                      align = "h")    # <- align vertically 

combined
```

The large outliers are ID_69 in womens lacrosse and ID_3 in womens soccer. ID_69 did not appear in the incident report at all. ID_3 appeared 3 times in the incident report with Right Knee Pain/Injury Not otherwise specified - 05/08/2024, Left Quadriceps strain/tear - 03/06/2024, Right Gluteus medius/minimus strain - 10/02/2024. The observation for performance strength was 02/03/2025 which indicates it occured after all of her injuries. Both athletes also have a handful of other observations that fit into the center of the distribution.

```{r}
quantile(performance_L_nordic$Maximum.Nordic.Bilateral.Mean, probs = c(0.25, 0.5, 0.75))
```

```{r}
ggplot(performance_V_nordic, aes(x = Maximum.Nordic.Bilateral.Mean)) + 
  geom_density(fill = '#CFB87C') +
  labs(title = 'Distribution of Maximum Nordic Bilateral Force',
       x = 'Maximum Nordic Bilateral Mean (N)',
       y = 'Density',
       caption = 'CU Womens Volleyball') +
  geom_vline(xintercept = median(performance_V_nordic$Maximum.Nordic.Bilateral.Mean), linetype = 'solid') +
  geom_vline(xintercept = c(quantile(performance_V_nordic$Maximum.Nordic.Bilateral.Mean, probs = c(0.01, 0.25, 0.75, 0.99))), linetype = 'dashed') + 
  theme_bw()
```

```{r}
#could use effectsize
library(effectsize)

result <- t.test(Maximum.Nordic.Bilateral.Mean ~ Sport.2, data = performance_all_nordic)
cohens_d(Maximum.Nordic.Bilateral.Mean ~ Sport.2, data = performance_all_nordic)
```

```{r}
#performs a Welch's T-test for difference of means
t.test(Maximum.Nordic.Bilateral.Mean ~ Sport.2, data = performance_all_nordic, alternative = 'greater')
t.test(Relative.Maximum.Nordic.Bilateral.Mean ~ Sport.2, data = performance_all_nordic, alternative = 'less')
t.test(Nordic.MEAN.Imbalance ~ Sport.2, data = performance_all_nordic)
t.test(Impulse ~ Sport.2, data = performance_all_nordic, alternative = 'greater')
t.test(Force.Diff.Norm ~ Sport.2, data = performance_all_nordic, alternative = 'greater')
```

There is a lot of statistical evidence for a difference in the means of court sports vs field sports in maximum nordic bilateral mean force. There is less but still statistically significant evidence for a difference in the average imbalance and max imbalance between sport types with field sports typically having more imbalance. 

```{r}
#performs a Welch's T-test for difference of means within court sports
t.test(Maximum.Nordic.Bilateral.Mean ~ Sport, data = court_all)
t.test(Relative.Maximum.Nordic.Bilateral.Mean ~ Sport, data = court_all)
t.test(Nordic.MEAN.Imbalance ~ Sport, data = court_all)
t.test(Impulse ~ Sport, data = court_all)
t.test(Force.Diff.Norm ~ Sport, data = court_all)
```

There is a very small difference between these two sports, with basketball being slightly stronger, but the p-value is almost significant at the 0.05 level. No statistical signficance in terms of imbalance. 

```{r}
#performs a Welch's T-test for difference of means within court sports
t.test(Maximum.Nordic.Bilateral.Mean ~ Sport, data = field_all)
t.test(Relative.Maximum.Nordic.Bilateral.Mean ~ Sport, data = field_all)
t.test(Nordic.MEAN.Imbalance ~ Sport, data = field_all)
t.test(Impulse ~ Sport, data = field_all)
t.test(Force.Diff.Norm ~ Sport, data = field_all)
```

There is a lot of statistical evidence that there is a difference in the means of maximum nordic bilateral mean force between the field sports with soccer having a significantly higher mean than lacrosse. There is statistical evidence of a difference in imbalance with lacrosse having significantly more mean and max imbalance compared to soccer but most likely also basketball and volleyball. 

```{r}
t.test(Nordic.MEAN.Imbalance ~ Sport, data = performance_all_nordic %>% filter(Sport %in% c('Volleyball', 'Basketball')))
```

```{r}
#anova test for differences
anova_result <- aov(Nordic.MAX.Imbalance ~ Sport, data = performance_all_nordic)
summary(anova_result)
```

Using the anova test there is slight statistical evidence of a difference in mean imbalance between sports and more for max imbalance between sports. 

### 2. Hip Data

```{r}
#creating a dataset containing performance hip data across all sports
performance_all_hip <- rbind(performance_B_hip, performance_S_hip, performance_L_hip, performance_V_hip) %>%
  mutate(Avg.Abd.Mean = (Hip.Abd.Left.MEAN + Hip.Abd.Right.MEAN) / 2,
         Avg.Add.Mean = (Hip.Add.Left.MEAN + Hip.Add.Right.MEAN) / 2,
         Avg.Abd.Max = (Hip.Abd.Left.MAX + Hip.Abd.Right.MAX) / 2,
         Avg.Add.Max = (Hip.Add.Left.MAX + Hip.Add.Right.MAX) / 2,
         Relative.Abd.Mean = Avg.Abd.Mean / Athlete.Bodyweight..kg.,
         Relative.Add.Mean = Avg.Add.Mean / Athlete.Bodyweight..kg.,
         Relative.Abd.Max = Avg.Abd.Max / Athlete.Bodyweight..kg.,
         Relative.Add.Max = Avg.Add.Max / Athlete.Bodyweight..kg.,
         Sport.2 = ifelse(Sport == 'Basketball' | Sport == 'Volleyball', 'Court', 'Field'))

#summarizes averages for variables of interest within each sport 
performance_all_hip %>%
  group_by(Sport) %>%
  summarise(`Average Abd. Mean` = mean(Avg.Abd.Mean),
            `Average Add. Mean` = mean(Avg.Add.Mean),
            `Average Abd. Max` = mean(Avg.Abd.Max),
            `Average Add. Max` = mean(Avg.Add.Max),
            `Average Rel. Abd. Mean` = mean(Relative.Abd.Mean),
            `Average Rel. Add. Mean` = mean(Relative.Add.Mean),
            `Average Rel. Abd. Max` = mean(Relative.Abd.Max),
            `Average Rel. Add. Max` = mean(Relative.Add.Max))
```

```{r}
hip_B <- performance_B_hip %>%
  mutate(Avg.Abd.Max = (Hip.Abd.Left.MAX + Hip.Abd.Right.MAX) / 2,
         Avg.Add.Max = (Hip.Add.Left.MAX + Hip.Add.Right.MAX) / 2)

hip_S <- performance_S_hip %>%
  mutate(Avg.Abd.Max = (Hip.Abd.Left.MAX + Hip.Abd.Right.MAX) / 2,
         Avg.Add.Max = (Hip.Add.Left.MAX + Hip.Add.Right.MAX) / 2)

hip_L <- performance_L_hip %>%
  mutate(Avg.Abd.Max = (Hip.Abd.Left.MAX + Hip.Abd.Right.MAX) / 2,
         Avg.Add.Max = (Hip.Add.Left.MAX + Hip.Add.Right.MAX) / 2)

hip_V <- performance_V_hip %>%
  mutate(Avg.Abd.Max = (Hip.Abd.Left.MAX + Hip.Abd.Right.MAX) / 2,
         Avg.Add.Max = (Hip.Add.Left.MAX + Hip.Add.Right.MAX) / 2)
```

```{r}
#creates a density plot of hip abduction across the 4 sports
ggplot(performance_all_hip, aes(x = Avg.Add.Max, fill = Sport, color = Sport)) +
  geom_density(alpha = 0.4) + 
  scale_fill_manual(values = c('#CFB87C', '#60D272', '#FF736F', '#565A5C')) +
  scale_color_manual(values = c('#CFB87C', '#60D272', '#FF736F', '#565A5C')) +
  labs(title = 'Distribution of Maximum Average Adduction Force Across Sports',
       x = 'Maximum Average Adduction Force (N)',
       y = 'Density') +
  scale_x_continuous(breaks = seq(0, 1000, 50)) +
  theme_bw()
```

```{r}
#creates a density plot for maximum bilateral force across sport type
ggplot(performance_all_hip, aes(x = Avg.Abd.Max, color = Sport.2, fill = Sport.2)) + 
  geom_density(alpha = 0.5) + 
  scale_fill_manual(values = c('#CFB87C', '#000000')) +
  scale_color_manual(values = c('#CFB87C', '#000000')) +
  labs(title = 'Distribution of Maximum Average Abduction Force Across Sports',
       x = 'Maximum Average Abduction Force (N)',
       y = 'Density',
       fill = 'Sport Type',
       color = 'Sport Type') +
  scale_x_continuous(breaks = seq(0, 1000, 50)) +
  theme_bw()
```

```{r}
img <- image_read("C:/Users/cazb4905/Documents/T2P2-data-analysis-2025/abd_wlx.png")
img_grob <- rasterGrob(img, interpolate = TRUE)
img_plot <- ggdraw() + draw_grob(img_grob, x = 0, y = 0, width = 1, height = 1)

p <- ggplot(hip_V, aes(x = Avg.Abd.Max)) + 
  geom_density(fill = '#CFB87C') +
  labs(title = 'Distribution of Maximum Average Abduction Force Across Sports',
       x = 'Maximum Average Abduction Force (N)',
       y = 'Density',
       caption = 'CU Womens Volleyball') +
  geom_vline(xintercept = median(hip_V$Avg.Abd.Max), linetype = 'solid') +
  geom_vline(xintercept = c(quantile(hip_V$Avg.Abd.Max, probs = c(0.01, 0.25, 0.75, 0.99))), linetype = 'dashed') + 
  scale_x_continuous(breaks = seq(from = 0, to = 1000, by = 50)) + 
  theme_bw()

combined <- plot_grid(p, img_plot, 
                      rel_widths = c(1.5, 1), 
                      nrow = 1,       # <- horizontal layout
                      align = "h")    # <- align vertically 

combined
```

```{r}
quantile(hip_L$Avg.Abd.Max, probs = c(0.25, 0.5, 0.75))
```

```{r}
#performs a Welch's T-test for difference of means
t.test(Avg.Abd.Max ~ Sport.2, data = performance_all_hip, alternative = 'greater')
t.test(Avg.Add.Max ~ Sport.2, data = performance_all_hip, alternative = 'greater')
t.test(Relative.Abd.Max ~ Sport.2, data = performance_all_hip, alternative = 'greater')
t.test(Relative.Add.Max ~ Sport.2, data = performance_all_hip, alternative = 'greater')
```

There is a statistically significant difference in the means values of average adduction and abduction max between the court and field sports. This is also true for the relative adduction and abduction max, although slightly less significant. The same applies for the mean abduction/adduction stats as well. 

```{r}
#creates a subset of just the court sports
court_all_hip <- performance_all_hip %>%
  filter(Sport.2 == 'Court')

#performs a Welch's T-test for difference of means within court sports
t.test(Avg.Abd.Max ~ Sport, data = court_all_hip)
t.test(Avg.Add.Max ~ Sport, data = court_all_hip)
t.test(Relative.Abd.Max ~ Sport, data = court_all_hip)
t.test(Relative.Add.Max ~ Sport, data = court_all_hip)
```

There is a statistically significant difference in the means of average abduction max with basketball being higher and relative adduction max with volleyball being higher. Also important to note that average adduction maxs are almost identical between the sports and have a p-value of 0.9671. Volleyball is greater in terms of relative force in both. 

```{r}
#creates a subset of just the court sports
field_all_hip <- performance_all_hip %>%
  filter(Sport.2 == 'Field')

#performs a Welch's T-test for difference of means within court sports
t.test(Avg.Abd.Max ~ Sport, data = field_all_hip)
t.test(Avg.Add.Max ~ Sport, data = field_all_hip)
t.test(Relative.Abd.Max ~ Sport, data = field_all_hip)
t.test(Relative.Add.Max ~ Sport, data = field_all_hip)
```

Most are almost significant with the difference in average adduction max being very significant. Soccer is greater in both strength forces on average and the relative adduction but lacross is stronger on average in the relative abduction. 

```{r}
#anova test for differences
anova_result <- aov(Bilateral.Hip.Abduction.Adduction.Ratio ~ Sport, data = performance_all_hip)
summary(anova_result)
```

Using anova test there is no statistical evidence of a difference in means between sports for average/max hip adduction imbalance or bilateral hip abduction adduction ratio. There is however very slight statistical evidence of a difference in means between the sports for average/max hip abduction imbalance. 

```{r}
t.test(Relative.Abd.Max ~ Sport, data = performance_all_hip %>% filter(Sport %in% c('Lacrosse', 'Soccer')))
```
